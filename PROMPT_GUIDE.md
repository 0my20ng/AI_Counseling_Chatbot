# 프롬프트 설계 가이드

## 📋 개요

AI 상담 챗봇의 프롬프트는 체계적으로 분리되어 관리됩니다:
- **시스템 프롬프트**: AI의 역할, 지침, 제약사항 정의
- **유저 프롬프트**: 대화 맥락과 분석 정보 제공

## 🎯 프롬프트 설계 철학

### 1. 명확성 (Clarity)
- AI의 역할을 구체적으로 정의
- 해야 할 것과 하지 말아야 할 것을 명확히 구분
- 예시를 통한 구체적 가이드 제공

### 2. 맥락성 (Contextualization)
- 현재 대화 단계에 맞는 지침 제공
- 이전 대화 기록 활용
- 감정 분석 결과 반영

### 3. 안전성 (Safety)
- 위기 상황 대응 프로토콜 명시
- 의료적 진단/처방 금지
- 전문가 의뢰 기준 제시

### 4. 공감성 (Empathy)
- 따뜻하고 비판단적인 톤 강조
- 내담자 감정의 타당성 인정
- 지지적 태도 유지

## 📝 프롬프트 구조

### 시스템 프롬프트 (buildSystemPrompt)

```javascript
시스템 프롬프트 구조:
├── 역할 정의
│   ├── 핵심 가치
│   └── 상담 목표
├── 상담 지침
│   ├── 응답 스타일
│   ├── 대화 기법
│   ├── 단계별 접근
│   ├── 위험 상황 대응
│   ├── 금지 사항
│   └── 전문가 의뢰 시점
├── 현재 컨텍스트
│   ├── 세션 정보
│   └── 감지된 이슈
└── 품질 체크리스트
```

#### 주요 섹션 설명

**1. 역할 정의**
```markdown
# 당신의 역할
당신은 전문적이고 공감적인 심리상담사 AI입니다.
```
→ AI가 자신의 정체성을 명확히 인식하도록 함

**2. 핵심 가치**
- 공감과 경청
- 비판단적 태도
- 안전한 공간
- 전문성

→ 모든 응답의 기준이 되는 가치관 제시

**3. 대화 기법**
- 반영적 경청
- 개방형 질문
- 감정 탐색
- 강점 찾기

→ 구체적인 상담 기법 명시

**4. 단계별 접근**
```javascript
현재 대화 단계: ${phase}
// opening: 라포 형성
// middle: 문제 탐색
// deep: 통찰 및 대안
```
→ 대화 진행도에 따른 차별화된 지침

**5. 위험 상황 대응**
```markdown
⚠️ 다음 신호가 감지되면 즉시 대응:
- 자살 사고나 자해 언급
- 극심한 절망감
...
```
→ 안전 최우선 원칙

**6. 금지 사항 vs 대안**
```markdown
❌ 절대 하지 말 것:
- 의학적 진단 제공
- 약물 복용 권유
...

✅ 대신 할 것:
- "전문의 상담을 받아보시는 것이..."
- 감정의 타당성 인정
...
```
→ 명확한 경계 설정

### 유저 프롬프트 (buildUserPrompt)

```javascript
유저 프롬프트 구조:
├── 대화 맥락
│   └── 최근 5개 대화 기록
├── 현재 메시지 분석
│   ├── 감정 상태
│   ├── 키워드 카테고리
│   ├── 위험 신호
│   └── 감정 강도
├── 내담자 메시지
└── 응답 작성 가이드
```

#### 예시

```
## 최근 대화 맥락

### 대화 1
내담자: "요즘 너무 우울해요..."
상담사: "힘든 시간을 보내고 계시는군요..."

### 대화 2
내담자: "아무것도 하고 싶지 않아요."
상담사: "그런 무기력감이 느껴지시는군요..."

## 현재 메시지 분석
- 전반적 감정: 부정적
- 감지된 키워드 카테고리:
  * 우울감 관련
  * 스트레스 관련
- 감정 강도: 매우 높음 (즉각적 지지 필요)

## 내담자의 현재 메시지
"더 이상 살고 싶지 않아요..."

---

⚠️ 위험 신호 감지
→ 즉각적이고 신중한 대응 필요
```

## 🎨 프롬프트 커스터마이징

### 대화 단계별 프롬프트 조정

```javascript
// opening 단계 (1-2회 대화)
"초기 단계: 라포 형성에 집중
- 내담자가 편안하게 느끼도록
- 주요 호소 문제 파악
- 너무 깊이 파고들지 않음"

// middle 단계 (3-6회 대화)  
"중기 단계: 문제의 본질 탐색
- 패턴과 맥락 파악
- 감정과 생각의 연결
- 구체적 예시 질문"

// deep 단계 (7회 이상)
"심화 단계: 통찰과 대안 모색
- 깊은 통찰 제공
- 대처 방법 탐색
- 변화 가능성 논의"
```

### 감정 강도별 프롬프트 조정

```javascript
if (intensity === 'high') {
    "감정 강도가 매우 높습니다.
    → 즉각적 지지와 안정화 필요
    → 위기 개입 고려"
}
```

### 키워드 카테고리별 프롬프트

```javascript
if (keywords.includes('depression')) {
    "우울감 관련 표현 감지
    → 자살 위험성 평가
    → PHQ-9 검사 제안 고려"
}
```

## 🚨 위기 개입 프롬프트

특수한 상황에서 사용되는 전용 프롬프트:

```javascript
buildCrisisInterventionPrompt(userInput)
```

### 구조
1. 즉각적 안전 확인
2. 우려 표현
3. 전문 도움 강력 권유
4. 즉각적 지지
5. 추가 안전 계획

### 예시 응답
```
"지금 안전한 상태이신가요? 

당신의 고통이 느껴지고 정말 걱정됩니다. 
하지만 이런 상황에서는 전문가의 즉각적인 
도움이 필요합니다.

지금 바로 생명의전화(1393)에 
연락해주시겠어요? 
24시간 상담이 가능합니다.

당신은 혼자가 아닙니다."
```

## 📊 평가 모드 프롬프트

### 검사 진행 프롬프트
```javascript
buildAssessmentSystemPrompt()
```
- 표준화 유지 강조
- 중립적 태도
- 격려 제공

### 결과 해석 프롬프트
```javascript
buildAssessmentInterpretationPrompt(type, score, responses)
```
- 비낙인화
- 구체적 피드백
- 희망 메시지

## 💡 프롬프트 개선 팁

### 1. 구체성 높이기
❌ "공감적으로 응답하세요"
✅ "내담자의 감정을 반영하며 '~라고 느끼시는군요'와 같은 표현 사용"

### 2. 예시 제공
```markdown
### 좋은 응답 예시:
"정말 힘든 시간을 보내고 계시는군요..."

### 피해야 할 응답:
"너무 우울해하지 마세요. 긍정적으로..."
```

### 3. 제약사항 명확히
```markdown
❌ 절대 금지:
- 의학적 진단
- 약물 권유

✅ 대신 할 것:
- 전문가 상담 권유
- 감정 인정
```

### 4. 맥락 정보 풍부하게
- 대화 횟수
- 감정 패턴
- 주요 테마
- 위험 신호

## 🔧 프롬프트 테스트

### 체크리스트
- [ ] 역할이 명확한가?
- [ ] 지침이 구체적인가?
- [ ] 금지사항이 분명한가?
- [ ] 예시가 충분한가?
- [ ] 안전 프로토콜이 있는가?
- [ ] 맥락 정보가 풍부한가?

### A/B 테스트 예시
```javascript
// Version A: 간단한 프롬프트
"당신은 상담사입니다. 공감적으로 답하세요."

// Version B: 상세한 프롬프트
"당신은 전문 상담사입니다.
1. 감정 반영하기
2. 개방형 질문하기  
3. 1-2개 질문만
4. 비판단적 태도"

→ Version B가 일관성 있는 고품질 응답 생성
```

## 📚 참고 자료

### 상담 기법
- 동기강화상담 (Motivational Interviewing)
- 인지행동치료 (CBT)
- 해결중심단기치료 (SFBT)

### 프롬프트 엔지니어링
- Few-shot Learning
- Chain-of-Thought
- Role Prompting

### 안전성
- Crisis Intervention Protocols
- Suicide Risk Assessment
- Duty to Warn

## 🎯 다음 단계

1. **프롬프트 A/B 테스트**
   - 다양한 버전 비교
   - 응답 품질 측정

2. **사용자 피드백 수집**
   - 만족도 조사
   - 개선 포인트 파악

3. **지속적 개선**
   - 새로운 케이스 반영
   - 프롬프트 라이브러리 확장

4. **다국어 지원**
   - 번역 품질 유지
   - 문화적 차이 고려