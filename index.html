<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ìƒë‹´ ì±—ë´‡ - ë§ˆìŒì˜ ë™ë°˜ì</title>
    <style>
        /* =================================
           ê¸°ë³¸ ìŠ¤íƒ€ì¼ë§ ë° ë¦¬ì…‹
        ================================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* =================================
           ë©”ì¸ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼
        ================================= */
        .container {
            width: 100%;
            max-width: 800px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 700px;
        }

        /* =================================
           í—¤ë” ì˜ì—­ ìŠ¤íƒ€ì¼
        ================================= */
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        /* ì˜¨ë¼ì¸ ìƒíƒœ í‘œì‹œ ì¸ë””ì¼€ì´í„° */
        .status-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* ì˜¨ë¼ì¸ ìƒíƒœ í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* =================================
           ì±„íŒ… ì˜ì—­ ìŠ¤íƒ€ì¼
        ================================= */
        .chat-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆ */
        .message {
            display: flex;
            gap: 10px;
            animation: fadeIn 0.5s ease-in;
        }

        /* ë©”ì‹œì§€ ë‚˜íƒ€ë‚˜ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ì‚¬ìš©ì ë©”ì‹œì§€ëŠ” ì˜¤ë¥¸ìª½ ì •ë ¬ */
        .message.user {
            flex-direction: row-reverse;
        }

        /* ë©”ì‹œì§€ ë§í’ì„  ìŠ¤íƒ€ì¼ */
        .message-bubble {
            max-width: 70%;
            padding: 15px 20px;
            border-radius: 20px;
            word-wrap: break-word;
            position: relative;
        }

        /* ë´‡ ë©”ì‹œì§€ ë§í’ì„  */
        .message.bot .message-bubble {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            color: #333;
            border-bottom-left-radius: 5px;
        }

        /* ì‚¬ìš©ì ë©”ì‹œì§€ ë§í’ì„  */
        .message.user .message-bubble {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-bottom-right-radius: 5px;
        }

        /* ì•„ë°”íƒ€ ìŠ¤íƒ€ì¼ */
        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .bot-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .user-avatar {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        /* =================================
           ì…ë ¥ ì˜ì—­ ìŠ¤íƒ€ì¼
        ================================= */
        .input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .input-field {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
        }

        /* ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ ì‹œ ìŠ¤íƒ€ì¼ */
        .input-field:focus {
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        /* ì „ì†¡ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .send-button {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .send-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* =================================
           ê°ì • í‘œì‹œ ë° UI ìš”ì†Œ ìŠ¤íƒ€ì¼
        ================================= */
        
        /* ê°ì • ë¶„ì„ ê²°ê³¼ í‘œì‹œ */
        .emotion-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 10px;
            background: rgba(79, 172, 254, 0.1);
            border-radius: 15px;
            font-size: 14px;
        }

        .emotion-icon {
            font-size: 20px;
        }

        /* íƒ€ì´í•‘ ì¤‘ í‘œì‹œ */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #666;
            font-style: italic;
        }

        .typing-dots {
            display: flex;
            gap: 3px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #666;
            border-radius: 50%;
            animation: typing 1.5s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        /* íƒ€ì´í•‘ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        /* ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼ë“¤ */
        .quick-responses {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .quick-response {
            padding: 8px 16px;
            background: rgba(79, 172, 254, 0.1);
            border: 1px solid rgba(79, 172, 254, 0.3);
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #4facfe;
        }

        .quick-response:hover {
            background: rgba(79, 172, 254, 0.2);
            transform: translateY(-2px);
        }

        /* ì œì•ˆì‚¬í•­ ì¹´ë“œ */
        .suggestion-card {
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 15px;
            border-left: 4px solid #ff8a65;
        }

        .suggestion-title {
            font-weight: 600;
            color: #d84315;
            margin-bottom: 8px;
        }

        /* ê°œì¸ì •ë³´ ë³´í˜¸ ê³µì§€ */
        .privacy-notice {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            color: #2e7d32;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* í™˜ì˜ í™”ë©´ */
        .welcome-screen {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .welcome-icon {
            font-size: 60px;
            margin-bottom: 20px;
            color: #4facfe;
        }

        /* =================================
           ëª¨ë°”ì¼ ë°˜ì‘í˜• ìŠ¤íƒ€ì¼
        ================================= */
        @media (max-width: 600px) {
            .container {
                height: 100vh;
                border-radius: 0;
                margin: 0;
            }
            
            .message-bubble {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="container">
        <!-- í—¤ë” ì˜ì—­ -->
        <div class="header">
            <h1>ğŸ¤– AI ìƒë‹´ ì±—ë´‡</h1>
            <p>ë§ˆìŒì˜ ë™ë°˜ìê°€ ë˜ì–´ë“œë¦¬ê² ìŠµë‹ˆë‹¤</p>
            <!-- ì˜¨ë¼ì¸ ìƒíƒœ í‘œì‹œ -->
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span>ì˜¨ë¼ì¸</span>
            </div>
        </div>

        <!-- ì±„íŒ… ì˜ì—­ -->
        <div class="chat-container" id="chatContainer">
            <!-- ê°œì¸ì •ë³´ ë³´í˜¸ ê³µì§€ -->
            <div class="privacy-notice">
                ğŸ”’ ê°œì¸ì •ë³´ ë³´í˜¸: ëª¨ë“  ëŒ€í™”ëŠ” ìµëª…ìœ¼ë¡œ ì²˜ë¦¬ë˜ë©° ì•ˆì „í•˜ê²Œ ë³´í˜¸ë©ë‹ˆë‹¤.
            </div>
            
            <!-- í™˜ì˜ í™”ë©´ -->
            <div class="welcome-screen">
                <div class="welcome-icon">ğŸ’™</div>
                <h2>ì•ˆë…•í•˜ì„¸ìš”!</h2>
                <p>ì €ëŠ” ì—¬ëŸ¬ë¶„ì˜ ë§ˆìŒì„ ë“¤ì–´ì£¼ëŠ” AI ìƒë‹´ì‚¬ì…ë‹ˆë‹¤.<br>
                í¸ì•ˆí•˜ê²Œ í˜„ì¬ ìƒí™©ì´ë‚˜ ê³ ë¯¼ì„ ë§ì”€í•´ ì£¼ì„¸ìš”.</p>
            </div>
        </div>

        <!-- ì…ë ¥ ì˜ì—­ -->
        <div class="input-container">
            <input 
                type="text" 
                class="input-field" 
                id="messageInput" 
                placeholder="ì§€ê¸ˆ ì–´ë–¤ ê¸°ë¶„ì´ì‹ ê°€ìš”? í¸í•˜ê²Œ ë§ì”€í•´ ì£¼ì„¸ìš”..."
                maxlength="500"
            >
            <button class="send-button" id="sendButton">â¤</button>
        </div>
    </div>

    <script>
        /**
         * AI ìƒë‹´ ì±—ë´‡ ë©”ì¸ í´ë˜ìŠ¤
         * ê¸°íšì„œì˜ ëª¨ë“  ì£¼ìš” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ëŠ” í•µì‹¬ í´ë˜ìŠ¤
         */
        class AICounselingChatbot {
            constructor() {
                // DOM ìš”ì†Œë“¤ ì°¸ì¡°
                this.chatContainer = document.getElementById('chatContainer');
                this.messageInput = document.getElementById('messageInput');
                this.sendButton = document.getElementById('sendButton');
                
                // ëŒ€í™” ìƒíƒœ ê´€ë¦¬ ê°ì²´
                this.conversationState = {
                    stage: 'initial',        // ëŒ€í™” ë‹¨ê³„: initial â†’ exploring â†’ analyzing â†’ recommending
                    emotionHistory: [],      // ê°ì • ë¶„ì„ ê¸°ë¡
                    concerns: [],           // íŒŒì•…ëœ ê³ ë¯¼/ê´€ì‹¬ì‚¬ë“¤
                    sessionCount: 0         // ëŒ€í™” ì„¸ì…˜ íšŸìˆ˜
                };
                
                this.isTyping = false;      // ë´‡ì´ íƒ€ì´í•‘ ì¤‘ì¸ì§€ ì—¬ë¶€
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™” ë° ì‚¬ìš©ì ì¸ì‚¬
                this.initializeEventListeners();
                this.greetUser();
            }

            /**
             * ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™”
             * ì „ì†¡ ë²„íŠ¼ í´ë¦­ ë° ì—”í„°í‚¤ ì…ë ¥ ì²˜ë¦¬
             */
            initializeEventListeners() {
                // ì „ì†¡ ë²„íŠ¼ í´ë¦­ ì‹œ
                this.sendButton.addEventListener('click', () => this.sendMessage());
                
                // ì…ë ¥ í•„ë“œì—ì„œ ì—”í„°í‚¤ ì…ë ¥ ì‹œ (Shift+EnterëŠ” ì œì™¸)
                this.messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });
            }

            /**
             * ì´ˆê¸° ì¸ì‚¬ ë©”ì‹œì§€ í‘œì‹œ
             * 1ì´ˆ í›„ í™˜ì˜ ë©”ì‹œì§€ì™€ ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼ë“¤ì„ ë³´ì—¬ì¤Œ
             */
            async greetUser() {
                await this.delay(1000);
                this.addBotMessage(
                    "ì•ˆë…•í•˜ì„¸ìš”! ì˜¤ëŠ˜ ì €ì—ê²Œ ì°¾ì•„ì™€ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. ğŸŒŸ\n\n" +
                    "ì €ëŠ” ì—¬ëŸ¬ë¶„ì´ í˜„ì¬ ê²ªê³  ê³„ì‹  ìƒí™©ì„ ì •ë¦¬í•˜ê³  ì´í•´í•˜ëŠ” ë° ë„ì›€ì„ ë“œë¦¬ëŠ” AI ìƒë‹´ì‚¬ì…ë‹ˆë‹¤.\n\n" +
                    "ì§€ê¸ˆ ì–´ë–¤ ê¸°ë¶„ì´ì‹ ê°€ìš”? ë˜ëŠ” ìµœê·¼ì— ì–´ë–¤ ì¼ë“¤ì´ ìˆìœ¼ì…¨ëŠ”ì§€ í¸í•˜ê²Œ ë§ì”€í•´ ì£¼ì„¸ìš”.",
                    ['ê¸°ë¶„ì´ ì¢‹ì§€ ì•Šì•„ìš”', 'ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ê³  ìˆì–´ìš”', 'í˜¼ë€ìŠ¤ëŸ¬ì›Œìš”', 'ê´œì°®ì€ í¸ì´ì—ìš”']
                );
            }

            /**
             * ë©”ì‹œì§€ ì „ì†¡ ì²˜ë¦¬
             * ì‚¬ìš©ì ì…ë ¥ì„ ë°›ì•„ í™”ë©´ì— í‘œì‹œí•˜ê³  ë´‡ ì‘ë‹µ ìƒì„±
             */
            async sendMessage() {
                const message = this.messageInput.value.trim();
                if (!message || this.isTyping) return;

                // ì‚¬ìš©ì ë©”ì‹œì§€ í™”ë©´ì— ì¶”ê°€
                this.addUserMessage(message);
                this.messageInput.value = '';
                this.sendButton.disabled = true;

                // ë´‡ ì‘ë‹µ ì²˜ë¦¬
                await this.processBotResponse(message);
                this.sendButton.disabled = false;
            }

            /**
             * ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ í™”ë©´ì— ì¶”ê°€
             * @param {string} message - ì‚¬ìš©ìê°€ ì…ë ¥í•œ ë©”ì‹œì§€
             */
            addUserMessage(message) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message user';
                messageDiv.innerHTML = `
                    <div class="avatar user-avatar">ğŸ‘¤</div>
                    <div class="message-bubble">${this.escapeHtml(message)}</div>
                `;
                this.chatContainer.appendChild(messageDiv);
                this.scrollToBottom();
            }

            /**
             * ë´‡ ë©”ì‹œì§€ë¥¼ í™”ë©´ì— ì¶”ê°€
             * @param {string} message - ë´‡ì´ ë³´ë‚¼ ë©”ì‹œì§€
             * @param {Array} quickResponses - ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼ë“¤ (ì„ íƒì‚¬í•­)
             */
            addBotMessage(message, quickResponses = []) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message bot';
                
                // ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼ë“¤ HTML ìƒì„±
                let quickResponsesHtml = '';
                if (quickResponses.length > 0) {
                    quickResponsesHtml = `
                        <div class="quick-responses">
                            ${quickResponses.map(response => 
                                `<div class="quick-response" onclick="chatbot.selectQuickResponse('${response}')">${response}</div>`
                            ).join('')}
                        </div>
                    `;
                }

                messageDiv.innerHTML = `
                    <div class="avatar bot-avatar">ğŸ¤–</div>
                    <div class="message-bubble">
                        ${this.escapeHtml(message).replace(/\n/g, '<br>')}
                        ${quickResponsesHtml}
                    </div>
                `;
                this.chatContainer.appendChild(messageDiv);
                this.scrollToBottom();
            }

            /**
             * ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼ í´ë¦­ ì²˜ë¦¬
             * @param {string} response - ì„ íƒëœ ë¹ ë¥¸ ì‘ë‹µ í…ìŠ¤íŠ¸
             */
            selectQuickResponse(response) {
                this.messageInput.value = response;
                this.sendMessage();
            }

            /**
             * ë´‡ ì‘ë‹µ ìƒì„± ë° ì²˜ë¦¬
             * ê°ì • ë¶„ì„, í‚¤ì›Œë“œ ì¶”ì¶œ, ëŒ€í™” ë‹¨ê³„ë³„ ì‘ë‹µ ìƒì„±
             * @param {string} userMessage - ì‚¬ìš©ì ë©”ì‹œì§€
             */
            async processBotResponse(userMessage) {
                this.showTypingIndicator();
                
                // ê°ì • ë¶„ì„ ì‹¤í–‰ (í‚¤ì›Œë“œ ê¸°ë°˜ ê°„ë‹¨í•œ ë¶„ì„)
                const emotion = this.analyzeEmotion(userMessage);
                this.conversationState.emotionHistory.push(emotion);
                
                // ê³ ë¯¼/ê´€ì‹¬ì‚¬ í‚¤ì›Œë“œ ì¶”ì¶œ
                const concerns = this.extractConcerns(userMessage);
                this.conversationState.concerns.push(...concerns);

                // íƒ€ì´í•‘ ì‹œë®¬ë ˆì´ì…˜ (2ì´ˆ ëŒ€ê¸°)
                await this.delay(2000);
                this.removeTypingIndicator();

                let response = '';
                let quickResponses = [];
                let showEmotion = false;

                // ëŒ€í™” ë‹¨ê³„ë³„ ì‘ë‹µ ìƒì„±
                switch (this.conversationState.stage) {
                    case 'initial':
                        // ì´ˆê¸° ë‹¨ê³„: ì²« ì‘ë‹µ ë° ê°ì • í™•ì¸
                        response = this.generateInitialResponse(userMessage, emotion);
                        quickResponses = this.getInitialQuickResponses(emotion);
                        this.conversationState.stage = 'exploring';
                        showEmotion = true;
                        break;
                    
                    case 'exploring':
                        // íƒìƒ‰ ë‹¨ê³„: ìƒí™© íŒŒì•… ë° ê¹Šì´ ìˆëŠ” ì§ˆë¬¸
                        response = this.generateExploringResponse(userMessage, emotion);
                        quickResponses = this.getExploringQuickResponses();
                        if (this.conversationState.sessionCount >= 3) {
                            this.conversationState.stage = 'analyzing';
                        }
                        showEmotion = true;
                        break;
                    
                    case 'analyzing':
                        // ë¶„ì„ ë‹¨ê³„: ì§€ê¸ˆê¹Œì§€ì˜ ëŒ€í™” ë‚´ìš© ì •ë¦¬ ë° ë¶„ì„
                        response = this.generateAnalyzingResponse();
                        this.conversationState.stage = 'recommending';
                        break;
                    
                    case 'recommending':
                        // ì¶”ì²œ ë‹¨ê³„: ë§ì¶¤í˜• ì¡°ì–¸ ë° í›„ì† ì¡°ì¹˜ ì œì•ˆ
                        response = this.generateRecommendationResponse();
                        break;
                }

                // ì‘ë‹µ ë©”ì‹œì§€ í™”ë©´ì— ì¶”ê°€
                this.addBotMessage(response, quickResponses);
                
                // ê°ì • ë¶„ì„ ê²°ê³¼ í‘œì‹œ
                if (showEmotion) {
                    this.showEmotionIndicator(emotion);
                }

                this.conversationState.sessionCount++;
            }

            /**
             * ê°ì • ë¶„ì„ í•¨ìˆ˜
             * í‚¤ì›Œë“œ ë§¤ì¹­ì„ í†µí•œ ê¸°ë³¸ì ì¸ ê°ì • ë¶„ì„
             * @param {string} message - ë¶„ì„í•  ë©”ì‹œì§€
             * @returns {string} - ë¶„ì„ëœ ê°ì • ('ìŠ¬í””', 'ë¶ˆì•ˆ', 'ë¶„ë…¸', 'ìŠ¤íŠ¸ë ˆìŠ¤', 'ì¤‘ë¦½')
             */
            analyzeEmotion(message) {
                const emotions = {
                    'ìŠ¬í””': ['ìŠ¬í”„', 'ìš°ìš¸', 'í˜ë“¤', 'ì™¸ë¡œ', 'ê´´ë¡œ', 'ì•„í”„', 'ëˆˆë¬¼'],
                    'ë¶ˆì•ˆ': ['ë¶ˆì•ˆ', 'ê±±ì •', 'ë‘ë ¤', 'ë¬´ì„œ', 'ê¸´ì¥', 'ì´ˆì¡°'],
                    'ë¶„ë…¸': ['í™”ë‚˜', 'ì§œì¦', 'ì–µìš¸', 'ë¶„í•˜', 'ì—´ë°›', 'ë‹µë‹µ'],
                    'ìŠ¤íŠ¸ë ˆìŠ¤': ['ìŠ¤íŠ¸ë ˆìŠ¤', 'ì••ë°•', 'ë¶€ë‹´', 'í”¼ê³¤', 'ì§€ì³']
                };

                // ê° ê°ì •ì˜ í‚¤ì›Œë“œê°€ ë©”ì‹œì§€ì— í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
                for (const [emotion, keywords] of Object.entries(emotions)) {
                    if (keywords.some(keyword => message.includes(keyword))) {
                        return emotion;
                    }
                }
                return 'ì¤‘ë¦½';
            }

            /**
             * ê´€ì‹¬ì‚¬/ê³ ë¯¼ í‚¤ì›Œë“œ ì¶”ì¶œ
             * @param {string} message - ë¶„ì„í•  ë©”ì‹œì§€
             * @returns {Array} - ì¶”ì¶œëœ ê´€ì‹¬ì‚¬ ë°°ì—´
             */
            extractConcerns(message) {
                const concernKeywords = {
                    'ì¸ê°„ê´€ê³„': ['ì¹œêµ¬', 'ê°€ì¡±', 'ì—°ì¸', 'ë™ë£Œ', 'ìƒì‚¬', 'ê°ˆë“±'],
                    'ì—…ë¬´/í•™ì—…': ['ì¼', 'ì§ì¥', 'í•™êµ', 'ê³µë¶€', 'ì‹œí—˜', 'ì„±ì '],
                    'ê±´ê°•': ['ëª¸', 'ê±´ê°•', 'ì•„í”„', 'ë³‘', 'ì¹˜ë£Œ'],
                    'ë¯¸ë˜': ['ë¯¸ë˜', 'ì§„ë¡œ', 'ì·¨ì—…', 'ê²°í˜¼', 'ê³„íš']
                };

                const concerns = [];
                for (const [concern, keywords] of Object.entries(concernKeywords)) {
                    if (keywords.some(keyword => message.includes(keyword))) {
                        concerns.push(concern);
                    }
                }
                return concerns;
            }

            /**
             * ì´ˆê¸° ë‹¨ê³„ ì‘ë‹µ ìƒì„±
             * ê°ì •ì— ë”°ë¥¸ ë§ì¶¤í˜• ì²« ì‘ë‹µ
             * @param {string} message - ì‚¬ìš©ì ë©”ì‹œì§€
             * @param {string} emotion - ë¶„ì„ëœ ê°ì •
             * @returns {string} - ìƒì„±ëœ ì‘ë‹µ
             */
            generateInitialResponse(message, emotion) {
                const responses = {
                    'ìŠ¬í””': "ë§ˆìŒì´ ë§ì´ ì•„í”„ì‹  ê²ƒ ê°™ì•„ìš”. ì´ëŸ° ê°ì •ì„ ëŠë¼ì‹œëŠ” ê²ƒì´ ìì—°ìŠ¤ëŸ½ìŠµë‹ˆë‹¤. ì–´ë–¤ ìƒí™©ì—ì„œ ì´ëŸ° ê¸°ë¶„ì´ ë“œì…¨ëŠ”ì§€ ì¡°ê¸ˆ ë” ìì„¸íˆ ë§ì”€í•´ ì£¼ì‹¤ ìˆ˜ ìˆì„ê¹Œìš”?",
                    'ë¶ˆì•ˆ': "ë¶ˆì•ˆí•œ ë§ˆìŒì´ ë“œì‹œëŠ”êµ°ìš”. ê·¸ëŸ° ê°ì •ì´ ì–¸ì œë¶€í„° ì‹œì‘ë˜ì—ˆëŠ”ì§€, íŠ¹ë³„íˆ ì–´ë–¤ ìƒí™©ì—ì„œ ë” ì‹¬í•´ì§€ëŠ”ì§€ ë§ì”€í•´ ì£¼ì„¸ìš”.",
                    'ë¶„ë…¸': "í™”ê°€ ë‚˜ì‹  ìƒí™©ì„ ì´í•´í•  ìˆ˜ ìˆì–´ìš”. ë¶„ë…¸ëŠ” ìì—°ìŠ¤ëŸ¬ìš´ ê°ì •ì…ë‹ˆë‹¤. ì–´ë–¤ ì¼ì´ ìˆì—ˆëŠ”ì§€ ì²œì²œíˆ ë§ì”€í•´ ì£¼ì„¸ìš”.",
                    'ìŠ¤íŠ¸ë ˆìŠ¤': "ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë§ì´ ë°›ê³  ê³„ì‹œëŠ”êµ°ìš”. í˜„ì¬ ê°€ì¥ ë¶€ë‹´ë˜ëŠ” ê²ƒì´ ë¬´ì—‡ì¸ì§€ í•¨ê»˜ ì •ë¦¬í•´ë³¼ê¹Œìš”?"
                };
                
                return responses[emotion] || "í˜„ì¬ ìƒí™©ì„ ì¢€ ë” êµ¬ì²´ì ìœ¼ë¡œ ë§ì”€í•´ ì£¼ì‹œë©´ ë„ì›€ì´ ë  ê²ƒ ê°™ì•„ìš”. ì–´ë–¤ ì¼ë“¤ì´ ìˆìœ¼ì…¨ë‚˜ìš”?";
            }

            /**
             * íƒìƒ‰ ë‹¨ê³„ ì‘ë‹µ ìƒì„±
             * ìƒí™©ì„ ë” ê¹Šì´ íŒŒì•…í•˜ê¸° ìœ„í•œ ì§ˆë¬¸ë“¤
             * @param {string} message - ì‚¬ìš©ì ë©”ì‹œì§€
             * @param {string} emotion - ë¶„ì„ëœ ê°ì •
             * @returns {string} - ìƒì„±ëœ ì‘ë‹µ
             */
            generateExploringResponse(message, emotion) {
                const responses = [
                    "ë§ì”€í•´ ì£¼ì‹  ë‚´ìš©ì„ ì˜ ë“¤ì—ˆìŠµë‹ˆë‹¤. ì´ëŸ° ìƒí™©ì—ì„œ ê·¸ëŸ° ê°ì •ì„ ëŠë¼ì‹œëŠ” ê²ƒì´ ì¶©ë¶„íˆ ì´í•´ë©ë‹ˆë‹¤.",
                    "ìƒí™©ì„ ë” ì˜ ì´í•´í•˜ê¸° ìœ„í•´ ë¬¼ì–´ë³´ê³  ì‹¶ì€ ê²ƒì´ ìˆì–´ìš”. í‰ì†Œì—ëŠ” ì´ëŸ° ë¬¸ì œë¥¼ ì–´ë–»ê²Œ í•´ê²°í•˜ì…¨ë‚˜ìš”?",
                    "ì§€ê¸ˆê¹Œì§€ ë§ì”€í•´ ì£¼ì‹  ê²ƒë“¤ì„ ì¢…í•©í•´ë³´ë©´ì„œ, ì´ ìƒí™©ì—ì„œ ê°€ì¥ ì–´ë ¤ìš´ ë¶€ë¶„ì´ ë¬´ì—‡ì¸ì§€ ì •ë¦¬í•´ë³¼ê¹Œìš”?"
                ];
                
                return responses[this.conversationState.sessionCount % responses.length];
            }

            /**
             * ë¶„ì„ ë‹¨ê³„ ì‘ë‹µ ìƒì„±
             * ì§€ê¸ˆê¹Œì§€ì˜ ëŒ€í™” ë‚´ìš©ì„ ì¢…í•©í•˜ì—¬ ìƒí™© ì •ë¦¬
             * @returns {string} - ìƒì„±ëœ ë¶„ì„ ì‘ë‹µ
             */
            generateAnalyzingResponse() {
                const mainConcerns = [...new Set(this.conversationState.concerns)];
                const dominantEmotion = this.getMostFrequentEmotion();
                
                let analysis = "ì§€ê¸ˆê¹Œì§€ ëŒ€í™”ë¥¼ í†µí•´ íŒŒì•…í•œ ë‚´ìš©ì„ ì •ë¦¬í•´ë“œë¦´ê²Œìš”.\n\n";
                
                if (mainConcerns.length > 0) {
                    analysis += `ì£¼ìš” ê´€ì‹¬ì‚¬: ${mainConcerns.join(', ')}\n`;
                }
                
                analysis += `ê°ì • ìƒíƒœ: ${dominantEmotion}\n\n`;
                analysis += "ì´ëŸ° ìƒí™©ì—ì„œ ìŠ¤ìŠ¤ë¡œë¥¼ ëŒë³´ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ëª‡ ê°€ì§€ ë„ì›€ì´ ë  ë§Œí•œ ë°©ë²•ë“¤ì„ ì œì•ˆí•´ë“œë¦´ê²Œìš”.";
                
                return analysis;
            }

            /**
             * ì¶”ì²œ ë‹¨ê³„ ì‘ë‹µ ìƒì„±
             * ë§ì¶¤í˜• ì¡°ì–¸ ë° ì „ë¬¸ ìƒë‹´ ì—°ê³„ ì œì•ˆ
             * @returns {string} - ìƒì„±ëœ ì¶”ì²œ ì‘ë‹µ
             */
            generateRecommendationResponse() {
                return "ğŸŒŸ ê°œì¸ë§ì¶¤ ì œì•ˆì‚¬í•­\n\n" +
                       "1. ê°ì • ì¼ê¸° ì“°ê¸°: ë§¤ì¼ ì¡°ê¸ˆì”© ê°ì •ì„ ê¸°ë¡í•´ë³´ì„¸ìš”\n" +
                       "2. ê·œì¹™ì ì¸ ìš´ë™ì´ë‚˜ ì‚°ì±…\n" +
                       "3. ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì‚¬ëŒê³¼ì˜ ëŒ€í™”\n\n" +
                       "ë” ì „ë¬¸ì ì¸ ë„ì›€ì´ í•„ìš”í•˜ì‹œë‹¤ë©´ ê·¼ì²˜ ìƒë‹´ì„¼í„°ë¥¼ ì•ˆë‚´í•´ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì–´ë–»ê²Œ ìƒê°í•˜ì„¸ìš”?";
            }

            /**
             * ì´ˆê¸° ë‹¨ê³„ ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼ ìƒì„±
             * @param {string} emotion - ë¶„ì„ëœ ê°ì •
             * @returns {Array} - ë¹ ë¥¸ ì‘ë‹µ ì˜µì…˜ë“¤
             */
            getInitialQuickResponses(emotion) {
                const responses = {
                    'ìŠ¬í””': ['ë” ìì„¸íˆ ë§í•˜ê³  ì‹¶ì–´ìš”', 'í˜¼ì ìˆê³  ì‹¶ì–´ìš”', 'ëˆ„êµ°ê°€ì™€ ì´ì•¼ê¸°í•˜ê³  ì‹¶ì–´ìš”'],
                    'ë¶ˆì•ˆ': ['ê³„ì† ê±±ì •ë¼ìš”', 'ì ì„ ì˜ ëª» ììš”', 'ì§‘ì¤‘ì´ ì•ˆ ë¼ìš”'],
                    'ë¶„ë…¸': ['ì •ë§ í™”ê°€ ë‚˜ìš”', 'ì–µìš¸í•´ìš”', 'ì–´ë–»ê²Œ í•´ì•¼ í• ì§€ ëª¨ë¥´ê² ì–´ìš”'],
                    'ìŠ¤íŠ¸ë ˆìŠ¤': ['ë„ˆë¬´ ë°”ë¹ ìš”', 'ì••ë°•ê°ì´ ì‹¬í•´ìš”', 'íœ´ì‹ì´ í•„ìš”í•´ìš”']
                };
                return responses[emotion] || ['ë” ë§í•˜ê³  ì‹¶ì–´ìš”', 'ì¡°ì–¸ì´ í•„ìš”í•´ìš”', 'ì˜ ëª¨ë¥´ê² ì–´ìš”'];
            }

            /**
             * íƒìƒ‰ ë‹¨ê³„ ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼ ìƒì„±
             * @returns {Array} - ë¹ ë¥¸ ì‘ë‹µ ì˜µì…˜ë“¤
             */
            getExploringQuickResponses() {
                return ['ë§ì•„ìš”', 'ì•„ë‹ˆì—ìš”, ë‹¤ë¥¸ ê²ƒ ê°™ì•„ìš”', 'ì¢€ ë” ìƒê°í•´ë³¼ê²Œìš”', 'ë„ì›€ì´ í•„ìš”í•´ìš”'];
            }

            /**
             * ê°€ì¥ ë¹ˆë²ˆí•œ ê°ì • ì°¾ê¸°
             * ê°ì • ê¸°ë¡ì—ì„œ ê°€ì¥ ë§ì´ ë‚˜íƒ€ë‚œ ê°ì •ì„ ë°˜í™˜
             * @returns {string} - ê°€ì¥ ë¹ˆë²ˆí•œ ê°ì •
             */
            getMostFrequentEmotion() {
                const emotionCount = {};
                this.conversationState.emotionHistory.forEach(emotion => {
                    emotionCount[emotion] = (emotionCount[emotion] || 0) + 1;
                });
                
                return Object.keys(emotionCount).reduce((a, b) => 
                    emotionCount[a] > emotionCount[b] ? a : b
                ) || 'ì¤‘ë¦½';
            }

            /**
             * ê°ì • ë¶„ì„ ê²°ê³¼ í‘œì‹œ
             * ë§ˆì§€ë§‰ ë´‡ ë©”ì‹œì§€ì— ê°ì • ì¸ë””ì¼€ì´í„° ì¶”ê°€
             * @param {string} emotion - í‘œì‹œí•  ê°ì •
             */
            showEmotionIndicator(emotion) {
                const emotionIcons = {
                    'ìŠ¬í””': 'ğŸ˜¢',
                    'ë¶ˆì•ˆ': 'ğŸ˜°',
                    'ë¶„ë…¸': 'ğŸ˜ ',
                    'ìŠ¤íŠ¸ë ˆìŠ¤': 'ğŸ˜µ',
                    'ì¤‘ë¦½': 'ğŸ˜'
                };

                const lastMessage = this.chatContainer.lastElementChild;
                const emotionDiv = document.createElement('div');
                emotionDiv.className = 'emotion-indicator';
                emotionDiv.innerHTML = `
                    <span class="emotion-icon">${emotionIcons[emotion]}</span>
                    <span>ê°ì§€ëœ ê°ì •: ${emotion}</span>
                `;
                lastMessage.querySelector('.message-bubble').appendChild(emotionDiv);
            }

            /**
             * íƒ€ì´í•‘ ì¤‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ
             * ë´‡ì´ ì‘ë‹µì„ ìƒì„±í•˜ëŠ” ë™ì•ˆ íƒ€ì´í•‘ ì• ë‹ˆë©”ì´ì…˜ í‘œì‹œ
             */
            showTypingIndicator() {
                this.isTyping = true;
                const typingDiv = document.createElement('div');
                typingDiv.className = 'message bot typing-message';
                typingDiv.innerHTML = `
                    <div class="avatar bot-avatar">ğŸ¤–</div>
                    <div class="message-bubble">
                        <div class="typing-indicator">
                            <span>ìƒë‹´ì‚¬ê°€ ì…ë ¥ ì¤‘</span>
                            <div class="typing-dots">
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                            </div>
                        </div>
                    </div>
                `;
                this.chatContainer.appendChild(typingDiv);
                this.scrollToBottom();
            }

            /**
             * íƒ€ì´í•‘ ì¤‘ ì¸ë””ì¼€ì´í„° ì œê±°
             */
            removeTypingIndicator() {
                this.isTyping = false;
                const typingMessage = this.chatContainer.querySelector('.typing-message');
                if (typingMessage) {
                    typingMessage.remove();
                }
            }

            /**
             * ì±„íŒ… ì»¨í…Œì´ë„ˆë¥¼ ë§¨ ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤
             * ìƒˆ ë©”ì‹œì§€ê°€ ì¶”ê°€ë  ë•Œë§ˆë‹¤ ìë™ìœ¼ë¡œ ìŠ¤í¬ë¡¤
             */
            scrollToBottom() {
                this.chatContainer.scrollTop = this.chatContainer.scrollHeight;
            }

            /**
             * HTML ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬
             * XSS ê³µê²© ë°©ì§€ë¥¼ ìœ„í•´ ì‚¬ìš©ì ì…ë ¥ì˜ HTML íƒœê·¸ë¥¼ ì´ìŠ¤ì¼€ì´í”„
             * @param {string} text - ì´ìŠ¤ì¼€ì´í”„í•  í…ìŠ¤íŠ¸
             * @returns {string} - ì´ìŠ¤ì¼€ì´í”„ëœ í…ìŠ¤íŠ¸
             */
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            /**
             * ì§€ì—° í•¨ìˆ˜
             * íƒ€ì´í•‘ ì‹œë®¬ë ˆì´ì…˜ ë“±ì— ì‚¬ìš©ë˜ëŠ” ë¹„ë™ê¸° ì§€ì—°
             * @param {number} ms - ì§€ì—° ì‹œê°„(ë°€ë¦¬ì´ˆ)
             * @returns {Promise} - ì§€ì—° Promise
             */
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        /**
         * ì „ì—­ ë³€ìˆ˜ ë° ì´ˆê¸°í™”
         * í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ì±—ë´‡ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
         */
        let chatbot;
        document.addEventListener('DOMContentLoaded', () => {
            chatbot = new AICounselingChatbot();
        });
