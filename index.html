<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ìƒë‹´ ì±—ë´‡ - ì „ë¬¸ ì‹¬ë¦¬ ìƒë‹´ ì‹œìŠ¤í…œ</title>
    <style>
        /* =================================
           ê¸°ë³¸ ìŠ¤íƒ€ì¼ë§ ë° ë¦¬ì…‹
        ================================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        /* =================================
           ë©”ì¸ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼
        ================================= */
        .container {
            width: 100%;
            max-width: 900px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 80vh;
            min-height: 600px;
        }

        /* =================================
           ì„¤ì • íŒ¨ë„ ìŠ¤íƒ€ì¼
        ================================= */
        .settings-panel {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            display: none;
        }

        .settings-panel.show {
            display: block;
        }

        .api-config {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .api-config select,
        .api-config input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
        }

        .api-config input[type="password"] {
            flex: 1;
            min-width: 200px;
        }

        .save-config-btn {
            background: #4facfe;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        .save-config-btn:hover {
            background: #3d8bfe;
        }

        .api-status {
            margin-top: 10px;
            padding: 8px;
            border-radius: 6px;
            font-size: 12px;
        }

        .api-status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .api-status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* =================================
           í—¤ë” ì˜ì—­ ìŠ¤íƒ€ì¼
        ================================= */
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            position: relative;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 3px;
        }

        .header p {
            font-size: 13px;
            opacity: 0.9;
        }

        .settings-toggle {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .settings-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* ì„¸ì…˜ ì •ë³´ ë° ìƒíƒœ í‘œì‹œ */
        .session-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            font-size: 12px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .session-id {
            font-family: monospace;
            opacity: 0.8;
        }

        /* ìƒíƒœ í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* =================================
           ì±„íŒ… ì˜ì—­ ìŠ¤íƒ€ì¼
        ================================= */
        .chat-container {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆ */
        .message {
            display: flex;
            gap: 12px;
            animation: fadeIn 0.5s ease-in;
        }

        /* ë©”ì‹œì§€ ë‚˜íƒ€ë‚˜ëŠ” ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ì‚¬ìš©ì ë©”ì‹œì§€ëŠ” ì˜¤ë¥¸ìª½ ì •ë ¬ */
        .message.user {
            flex-direction: row-reverse;
        }

        /* ë©”ì‹œì§€ ë§í’ì„  ìŠ¤íƒ€ì¼ */
        .message-bubble {
            max-width: 75%;
            padding: 16px 20px;
            border-radius: 18px;
            word-wrap: break-word;
            position: relative;
            line-height: 1.5;
        }

        /* ë´‡ ë©”ì‹œì§€ ë§í’ì„  */
        .message.bot .message-bubble {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #333;
            border-bottom-left-radius: 6px;
            border: 1px solid #dee2e6;
        }

        /* ì‚¬ìš©ì ë©”ì‹œì§€ ë§í’ì„  */
        .message.user .message-bubble {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border-bottom-right-radius: 6px;
        }

        /* ì‹œìŠ¤í…œ ë©”ì‹œì§€ */
        .message.system .message-bubble {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            color: #856404;
            border: 1px solid #ffeaa7;
            text-align: center;
            max-width: 90%;
            margin: 0 auto;
        }

        /* ì•„ë°”íƒ€ ìŠ¤íƒ€ì¼ */
        .avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .bot-avatar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .user-avatar {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .system-avatar {
            background: linear-gradient(135deg, #ffa726 0%, #fb8c00 100%);
            color: white;
        }

        /* =================================
           íŠ¹ìˆ˜ UI ì»´í¬ë„ŒíŠ¸ ìŠ¤íƒ€ì¼
        ================================= */

        /* ëª¨ë“œ ì„ íƒ ì¹´ë“œ */
        .mode-selection {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .mode-card {
            flex: 1;
            min-width: 200px;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: white;
        }

        .mode-card:hover {
            border-color: #4facfe;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.2);
        }

        .mode-card.selected {
            border-color: #4facfe;
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
        }

        .mode-card h3 {
            color: #4facfe;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .mode-card p {
            color: #666;
            font-size: 14px;
            line-height: 1.4;
        }

        /* í‰ê°€ ì§ˆë¬¸ ì¹´ë“œ */
        .assessment-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border: 2px solid #4facfe;
            border-radius: 15px;
            padding: 25px;
            margin: 15px 0;
        }

        /* ì™„ë£Œëœ í‰ê°€ ì§ˆë¬¸ ìŠ¤íƒ€ì¼ */
        .assessment-card.completed .rating-option {
            cursor: not-allowed;
        }

        .assessment-card.completed .rating-option.selected {
            opacity: 1 !important;
        }

        .assessment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .question-number {
            background: #4facfe;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }

        .assessment-type {
            background: rgba(79, 172, 254, 0.1);
            color: #4facfe;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
        }

        .question-text {
            font-size: 16px;
            line-height: 1.6;
            color: #333;
            margin-bottom: 20px;
            font-weight: 500;
        }

        /* í‰ì  ì„ íƒ ë²„íŠ¼ */
        .rating-scale {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .rating-option {
            flex: 1;
            min-width: 120px;
            padding: 12px 8px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 13px;
            line-height: 1.3;
        }

        .rating-option:hover {
            border-color: #4facfe;
            background: rgba(79, 172, 254, 0.05);
        }

        .rating-option.selected {
            border-color: #4facfe;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            font-weight: 600;
        }

        .rating-number {
            display: block;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        /* ê°ì • ë¶„ì„ ê²°ê³¼ í‘œì‹œ */
        .emotion-analysis {
            background: linear-gradient(135deg, #e8f5e8 0%, #f0fff0 100%);
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
        }

        .emotion-analysis h4 {
            color: #2e7d32;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .emotion-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            border-bottom: 1px solid rgba(76, 175, 80, 0.2);
        }

        .emotion-item:last-child {
            border-bottom: none;
        }

        .emotion-bar {
            width: 100px;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            overflow: hidden;
        }

        .emotion-fill {
            height: 100%;
            background: linear-gradient(135deg, #4caf50 0%, #8bc34a 100%);
            transition: width 0.5s ease;
        }

        /* í‚¤ì›Œë“œ ë¶„ì„ */
        .keyword-analysis {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
        }

        .keyword-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .keyword-tag {
            background: rgba(255, 152, 0, 0.1);
            color: #e65100;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            border: 1px solid rgba(255, 152, 0, 0.3);
        }

        /* ê²°ê³¼ ìš”ì•½ ì¹´ë“œ */
        .summary-card {
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
            border: 2px solid #9c27b0;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }

        .summary-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .summary-header h3 {
            color: #7b1fa2;
            font-size: 20px;
        }

        .score-display {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            text-align: center;
        }

        .score-number {
            font-size: 36px;
            font-weight: bold;
            color: #7b1fa2;
            margin-bottom: 5px;
        }

        .score-interpretation {
            color: #666;
            font-size: 14px;
        }

        /* ê¶Œì¥ì‚¬í•­ ë¦¬ìŠ¤íŠ¸ */
        .recommendations {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 4px solid #2196f3;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
        }

        .recommendations h4 {
            color: #1976d2;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .recommendation-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
        }

        .recommendation-icon {
            background: #2196f3;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            flex-shrink: 0;
            margin-top: 2px;
        }

        /* ê°œì¸ì •ë³´ ë³´í˜¸ ê³µì§€ */
        .privacy-notice {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            color: #2e7d32;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
            font-style: italic;
            padding: 10px 0;
        }

        .typing-dots {
            display: flex;
            gap: 3px;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: #666;
            border-radius: 50%;
            animation: typing 1.5s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        /* ë¹ ë¥¸ ì‘ë‹µ ë²„íŠ¼ */
        .quick-responses {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .quick-response {
            padding: 10px 16px;
            background: rgba(79, 172, 254, 0.1);
            border: 1px solid rgba(79, 172, 254, 0.3);
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #4facfe;
        }

        .quick-response:hover {
            background: rgba(79, 172, 254, 0.2);
            transform: translateY(-2px);
        }

        /* =================================
           ì…ë ¥ ì˜ì—­ ìŠ¤íƒ€ì¼
        ================================= */
        .input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .input-field {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
            outline: none;
            transition: all 0.3s ease;
            resize: none;
            min-height: 50px;
            max-height: 100px;
        }

        .input-field:focus {
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .send-button {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .send-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* í™˜ì˜ í™”ë©´ */
        .welcome-screen {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .welcome-icon {
            font-size: 60px;
            margin-bottom: 20px;
            color: #4facfe;
        }

        /* =================================
           ëª¨ë°”ì¼ ë°˜ì‘í˜• ìŠ¤íƒ€ì¼
        ================================= */
        @media (max-width: 768px) {
            .container {
                height: 100vh;
                border-radius: 0;
                margin: 0;
            }
            
            .message-bubble {
                max-width: 85%;
            }

            .header-content {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .mode-selection {
                flex-direction: column;
            }

            .mode-card {
                min-width: auto;
            }

            .rating-scale {
                flex-direction: column;
            }

            .rating-option {
                min-width: auto;
            }

            .api-config {
                flex-direction: column;
                align-items: stretch;
            }

            .api-config input[type="password"] {
                min-width: auto;
            }
        }

        /* =================================
           ìœ í‹¸ë¦¬í‹° í´ë˜ìŠ¤
        ================================= */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="container">
        <!-- ì„¤ì • íŒ¨ë„ -->
        <div class="settings-panel" id="settingsPanel">
            <div class="api-config">
                <select id="aiProvider">
                    <option value="openai">OpenAI GPT</option>
                    <option value="google">Google Gemini</option>
                    <option value="local">ë¡œì»¬ ëª¨ë¸ (ë¬´ë£Œ)</option>
                </select>
                <input type="password" id="apiKey" placeholder="API í‚¤ ì…ë ¥ (ì„ íƒì‚¬í•­)">
                <button class="save-config-btn" onclick="chatbot.saveApiConfig()">ì €ì¥</button>
            </div>
            <div class="api-status" id="apiStatus">
                ì„¤ì •ì„ ì €ì¥í•˜ì—¬ AI ì—°ê²°ì„ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.
            </div>
        </div>

        <!-- í—¤ë” ì˜ì—­ -->
        <div class="header">
            <div class="header-content">
                <div>
                    <button class="settings-toggle" onclick="chatbot.toggleSettings()">âš™ï¸ AI ì„¤ì •</button>
                    <h1>ğŸ§  AI ì „ë¬¸ ìƒë‹´ ì±—ë´‡</h1>
                    <p>ìµëª… ë³´ì¥ â€¢ ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™” â€¢ ê°œì¸ì •ë³´ ë³´í˜¸</p>
                </div>
                <!-- ì„¸ì…˜ ì •ë³´ -->
                <div class="session-info">
                    <div class="status-indicator">
                        <div class="status-dot"></div>
                        <span>ì•ˆì „í•œ ì—°ê²°</span>
                    </div>
                    <div class="session-id" id="sessionId">ì„¸ì…˜: ë¡œë”©ì¤‘...</div>
                </div>
            </div>
        </div>

        <!-- ì±„íŒ… ì˜ì—­ -->
        <div class="chat-container" id="chatContainer">
            <!-- ê°œì¸ì •ë³´ ë³´í˜¸ ê³µì§€ -->
            <div class="privacy-notice">
                ğŸ”’ <strong>ê°œì¸ì •ë³´ ë³´í˜¸</strong>: ëª¨ë“  ëŒ€í™”ëŠ” ìµëª…í™”ë˜ì–´ ì„ì‹œ ì €ì¥ë˜ë©°, ìƒë‹´ ì¢…ë£Œ ì‹œ ìë™ ì‚­ì œë©ë‹ˆë‹¤.
            </div>
            
            <!-- í™˜ì˜ í™”ë©´ -->
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-icon">ğŸ¤</div>
                <h2>ìì—°ìŠ¤ëŸ¬ìš´ AI ìƒë‹´ì‚¬ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤</h2>
                <p>GPT, Gemini ë“± ìµœì‹  AI ëª¨ë¸ì„ í™œìš©í•œ<br>
                ê³µê°ì ì´ê³  ìì—°ìŠ¤ëŸ¬ìš´ ìƒë‹´ì„ ì œê³µí•©ë‹ˆë‹¤.</p>
                
                <!-- ìƒë‹´ ëª¨ë“œ ì„ íƒ -->
                <div class="mode-selection mt-20">
                    <div class="mode-card" onclick="chatbot.selectMode('conversation')">
                        <h3>ğŸ’¬ ììœ  ëŒ€í™” ìƒë‹´</h3>
                        <p>ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™”ë¥¼ í†µí•œ<br>ê°ì • ë¶„ì„ ë° ìƒë‹´</p>
                    </div>
                    <div class="mode-card" onclick="chatbot.selectMode('assessment')">
                        <h3>ğŸ“‹ í‘œì¤€ ì‹¬ë¦¬ê²€ì‚¬</h3>
                        <p>PHQ-9, GAD-7, PSS<br>í‘œì¤€í™”ëœ í‰ê°€</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì…ë ¥ ì˜ì—­ -->
        <div class="input-container">
            <textarea 
                class="input-field" 
                id="messageInput" 
                placeholder="í¸ì•ˆí•˜ê²Œ í˜„ì¬ ìƒí™©ì´ë‚˜ ê³ ë¯¼ì„ ë§ì”€í•´ ì£¼ì„¸ìš”..."
                maxlength="1000"
                rows="1"
            ></textarea>
            <button class="send-button" id="sendButton">â¤</button>
        </div>
    </div>

    <script>
        /**
         * í–¥ìƒëœ AI ìƒë‹´ ì±—ë´‡ í´ë˜ìŠ¤ - ìì—°ìŠ¤ëŸ¬ìš´ AI ì‘ë‹µ ì—°ë™
         */
        class EnhancedAICounselingChatbot {
            constructor() {
                // DOM ìš”ì†Œë“¤ ì°¸ì¡°
                this.chatContainer = document.getElementById('chatContainer');
                this.messageInput = document.getElementById('messageInput');
                this.sendButton = document.getElementById('sendButton');
                this.welcomeScreen = document.getElementById('welcomeScreen');
                this.sessionIdElement = document.getElementById('sessionId');
                this.settingsPanel = document.getElementById('settingsPanel');
                this.apiStatus = document.getElementById('apiStatus');
                
                // AI ì„¤ì •
                this.aiConfig = {
                    provider: 'local', // ê¸°ë³¸ê°’ì€ ë¡œì»¬ ëª¨ë¸
                    apiKey: null,
                    isConnected: false
                };
                
                // ì„¸ì…˜ ê´€ë¦¬
                this.session = {
                    id: this.generateSessionId(),
                    responses: [],
                    scores: {},
                    emotionalProfile: {},
                    conversationSummary: '',
                    createdAt: new Date().toISOString(),
                    mode: null
                };
                
                // ëŒ€í™” ìƒíƒœ ê´€ë¦¬
                this.conversationState = {
                    phase: 'greeting',
                    currentAssessmentType: null,
                    currentQuestionIndex: 0,
                    conversationHistory: [],
                    emotionalThemes: new Set(),
                    keyProblems: []
                };
                
                this.isTyping = false;
                
                // í‰ê°€ ë„êµ¬ ë°ì´í„°
                this.assessmentData = {
                    phq9: {
                        name: "PHQ-9 ìš°ìš¸ì¦ ì„ ë³„ê²€ì‚¬",
                        questions: [
                            "ì§€ë‚œ 2ì£¼ ë™ì•ˆ, ì¼ì„ í•˜ëŠ”ë° í¥ë¯¸ë‚˜ ì¦ê±°ì›€ì„ ê±°ì˜ ëŠë¼ì§€ ëª»í–ˆë‹¤",
                            "ì§€ë‚œ 2ì£¼ ë™ì•ˆ, ê¸°ë¶„ì´ ê°€ë¼ì•‰ê±°ë‚˜, ìš°ìš¸í•˜ê±°ë‚˜, ì ˆë§ì ì´ë¼ê³  ëŠê¼ˆë‹¤",
                            "ì§€ë‚œ 2ì£¼ ë™ì•ˆ, ì ë“¤ê¸° ì–´ë µê±°ë‚˜, ìë‹¤ê°€ ê¹¨ê±°ë‚˜, ë„ˆë¬´ ë§ì´ ì ì„ ì¤ë‹¤",
                            "ì§€ë‚œ 2ì£¼ ë™ì•ˆ, í”¼ê³¤í•˜ë‹¤ê³  ëŠê¼ˆê±°ë‚˜ ê¸°ìš´ì´ ê±°ì˜ ì—†ì—ˆë‹¤",
                            "ì§€ë‚œ 2ì£¼ ë™ì•ˆ, ì‹ìš•ì´ ë–¨ì–´ì¡Œê±°ë‚˜ ë„ˆë¬´ ë§ì´ ë¨¹ì—ˆë‹¤",
                            "ì§€ë‚œ 2ì£¼ ë™ì•ˆ, ìì‹ ì´ ë‚˜ìœ ì‚¬ëŒì´ë¼ê³  ëŠê¼ˆê±°ë‚˜, ì‹¤íŒ¨ìë¼ê³  ëŠê¼ˆê±°ë‚˜, ìì‹  ë•Œë¬¸ì— ìì‹ ì´ë‚˜ ê°€ì¡±ì´ ë¶ˆí–‰í•˜ê²Œ ë˜ì—ˆë‹¤ê³  ëŠê¼ˆë‹¤",
                            "ì§€ë‚œ 2ì£¼ ë™ì•ˆ, ì‹ ë¬¸ì„ ì½ê±°ë‚˜ í…”ë ˆë¹„ì „ì„ ë³´ëŠ” ê²ƒê³¼ ê°™ì€ ì¼ì— ì§‘ì¤‘í•˜ëŠ” ê²ƒì´ ì–´ë ¤ì› ë‹¤",
                            "ì§€ë‚œ 2ì£¼ ë™ì•ˆ, ë‹¤ë¥¸ ì‚¬ëŒë“¤ì´ ì£¼ëª©í•  ì •ë„ë¡œ í‰ì†Œë³´ë‹¤ ë§ê³¼ í–‰ë™ì´ ëŠë ¤ì¡Œê±°ë‚˜, ë˜ëŠ” ë°˜ëŒ€ë¡œ í‰ìƒì‹œë³´ë‹¤ ë§ì´ ì›€ì§ì—¬ì„œ ê°€ë§Œíˆ ì•‰ì•„ ìˆì„ ìˆ˜ ì—†ì—ˆë‹¤",
                            "ì§€ë‚œ 2ì£¼ ë™ì•ˆ, ìì‹ ì´ ì£½ëŠ” ê²ƒì´ ë” ë‚«ë‹¤ê³  ìƒê°í•˜ê±°ë‚˜ ìì‹ ì„ í•´ì¹  ìƒê°ì„ í–ˆë‹¤"
                        ]
                    },
                    gad7: {
                        name: "GAD-7 ë¶ˆì•ˆì¥ì•  ì„ ë³„ê²€ì‚¬",
                        questions: [
                            "ì§€ë‚œ 2ì£¼ ë™ì•ˆ, ì´ˆì¡°í•˜ê±°ë‚˜ ë¶ˆì•ˆí•˜ê±°ë‚˜ ì¡°ë§ˆì¡°ë§ˆí•˜ê²Œ ëŠê¼ˆë‹¤",
                            "ì§€ë‚œ 2ì£¼ ë™ì•ˆ, ê±±ì •í•˜ëŠ” ê²ƒì„ ë©ˆì¶”ê±°ë‚˜ ì¡°ì ˆí•  ìˆ˜ ì—†ì—ˆë‹¤",
                            "ì§€ë‚œ 2ì£¼ ë™ì•ˆ, ì—¬ëŸ¬ ê°€ì§€ ê²ƒë“¤ì„ ë„ˆë¬´ ë§ì´ ê±±ì •í–ˆë‹¤",
                            "ì§€ë‚œ 2ì£¼ ë™ì•ˆ, í¸í•˜ê²Œ ìˆê¸°ê°€ ì–´ë ¤ì› ë‹¤",
                            "ì§€ë‚œ 2ì£¼ ë™ì•ˆ, ë„ˆë¬´ ì•ˆì ˆë¶€ì ˆëª»í•´ì„œ ê°€ë§Œíˆ ìˆê¸°ê°€ í˜ë“¤ì—ˆë‹¤",
                            "ì§€ë‚œ 2ì£¼ ë™ì•ˆ, ì‰½ê²Œ ì§œì¦ì´ ë‚˜ê±°ë‚˜ ì„±ì„ ì˜ ëƒˆë‹¤",
                            "ì§€ë‚œ 2ì£¼ ë™ì•ˆ, ë¬´ì„œìš´ ì¼ì´ ìƒê¸¸ ê²ƒ ê°™ì•„ì„œ ë‘ë ¤ì› ë‹¤"
                        ]
                    },
                    stress: {
                        name: "ì§€ê°ëœ ìŠ¤íŠ¸ë ˆìŠ¤ ì²™ë„(PSS)",
                        questions: [
                            "ìµœê·¼ í•œ ë‹¬ ë™ì•ˆ, ì˜ˆìƒì¹˜ ëª»í•œ ì¼ ë•Œë¬¸ì— ê¸°ë¶„ì´ ìƒí•œ ì ì´ ì–¼ë§ˆë‚˜ ìì£¼ ìˆì—ˆë‚˜ìš”?",
                            "ìµœê·¼ í•œ ë‹¬ ë™ì•ˆ, ì¸ìƒì˜ ì¤‘ìš”í•œ ì¼ë“¤ì„ ì¡°ì ˆí•  ìˆ˜ ì—†ë‹¤ê³  ëŠë‚€ ì ì´ ì–¼ë§ˆë‚˜ ìì£¼ ìˆì—ˆë‚˜ìš”?",
                            "ìµœê·¼ í•œ ë‹¬ ë™ì•ˆ, ì‹ ê²½ì´ ì˜ˆë¯¼í•˜ê³  ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ëŠ”ë‹¤ê³  ëŠë‚€ ì ì´ ì–¼ë§ˆë‚˜ ìì£¼ ìˆì—ˆë‚˜ìš”?",
                            "ìµœê·¼ í•œ ë‹¬ ë™ì•ˆ, ìì‹ ì˜ ë¬¸ì œë“¤ì„ ì„±ê³µì ìœ¼ë¡œ ë‹¤ë£° ìˆ˜ ìˆë‹¤ê³  ëŠë‚€ ì ì´ ì–¼ë§ˆë‚˜ ìì£¼ ìˆì—ˆë‚˜ìš”?",
                            "ìµœê·¼ í•œ ë‹¬ ë™ì•ˆ, ì¸ìƒì´ ìì‹ ì˜ ëœ»ëŒ€ë¡œ ë˜ì–´ê°„ë‹¤ê³  ëŠë‚€ ì ì´ ì–¼ë§ˆë‚˜ ìì£¼ ìˆì—ˆë‚˜ìš”?",
                            "ìµœê·¼ í•œ ë‹¬ ë™ì•ˆ, ì–´ë ¤ìš´ ì¼ì„ íš¨ê³¼ì ìœ¼ë¡œ ëŒ€ì²˜í•  ìˆ˜ ìˆë‹¤ê³  ëŠë‚€ ì ì´ ì–¼ë§ˆë‚˜ ìì£¼ ìˆì—ˆë‚˜ìš”?",
                            "ìµœê·¼ í•œ ë‹¬ ë™ì•ˆ, ì¸ìƒì˜ ì¤‘ìš”í•œ ë³€í™”ë“¤ì„ í†µì œí•  ìˆ˜ ìˆë‹¤ê³  ëŠë‚€ ì ì´ ì–¼ë§ˆë‚˜ ìì£¼ ìˆì—ˆë‚˜ìš”?",
                            "ìµœê·¼ í•œ ë‹¬ ë™ì•ˆ, ì›í•˜ëŠ” ëŒ€ë¡œ ì¼ì´ í’€ë¦¬ì§€ ì•Šì•„ ì¢Œì ˆí•œ ì ì´ ì–¼ë§ˆë‚˜ ìì£¼ ìˆì—ˆë‚˜ìš”?",
                            "ìµœê·¼ í•œ ë‹¬ ë™ì•ˆ, ê°ì • ì¡°ì ˆì´ ì–´ë µë‹¤ê³  ëŠë‚€ ì ì´ ì–¼ë§ˆë‚˜ ìì£¼ ìˆì—ˆë‚˜ìš”?",
                            "ìµœê·¼ í•œ ë‹¬ ë™ì•ˆ, ìƒí™œ ì† ì‚¬ê±´ë“¤ì´ ë‚˜ë¥¼ ì••ë„í•œë‹¤ê³  ëŠë‚€ ì ì´ ì–¼ë§ˆë‚˜ ìì£¼ ìˆì—ˆë‚˜ìš”?"
                        ]
                    }
                };

                // í‰ê°€ ì²™ë„ ì„¤ëª…
                this.scaleDescriptions = {
                    0: "ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤",
                    1: "ë©°ì¹  ë™ì•ˆ ê·¸ë¬ë‹¤",
                    2: "ì¼ì£¼ì¼ ì´ìƒ ê·¸ë¬ë‹¤",
                    3: "ê±°ì˜ ë§¤ì¼ ê·¸ë¬ë‹¤"
                };

                // í‚¤ì›Œë“œ íŒ¨í„´ (ê°ì • ë° ìƒí™© ë¶„ì„ìš©) - ëŒ€í­ í™•ì¥
                this.keywordPatterns = {
                    depression: [
                        // ê¸°ë³¸ ìš°ìš¸ í‘œí˜„
                        "ìš°ìš¸", "ìŠ¬í””", "ì ˆë§", "ì˜ìš•ì—†", "í¥ë¯¸ì—†", "ì£½ê³ ì‹¶", "í—ˆë¬´", "ê³µí—ˆ", "ì™¸ë¡œ", "í˜¼ì",
                        "ë¬´ê°€ì¹˜", "ìì±…", "í”¼ê³¤", "ê¸°ìš´ì—†", "ë¬´ë ¥ê°", "ë‚™ë‹´", "í¬ë§ì—†", "ì‹¤ë§", "ë¬´ê¸°ë ¥", "ëˆˆë¬¼",
                        // í™•ì¥ëœ ìš°ìš¸ í‘œí˜„
                        "ë§‰ë§‰", "ê¹Šì€ í•œìˆ¨", "ìƒê°ë§Œí•´ë„", "ì˜ë¯¸ì—†", "ì•„ë¬´ê²ƒë„", "ì†Œìš©ì—†", "í¬ê¸°", "ì²´ë…",
                        "ìì¡´ê°", "ìì‹ ê°ì—†", "ì—´ë“±ê°", "ë¹„ê´€ì ", "ì–´ë‘ ", "ì¹¨ìš¸", "ë©í•˜", "ë¨¹ë¨¹", "ê°€ìŠ´ì´ë‹µë‹µ",
                        "ìš¸ì»¥", "ì„œëŸ¬ì›€", "ì“¸ì“¸", "ê³ ë…", "ê³ ë¦½", "ë‹¨ì ˆ", "ì†Œì™¸", "ë²„ë ¤ì§„", "ìŠí˜€ì§„",
                        "ë¬´ë„ˆì§", "ì¶”ë½", "ë°‘ë°”ë‹¥", "ë", "ë§ˆì§€ë§‰", "ëŒì´í‚¬ìˆ˜ì—†", "íšŒë³µë¶ˆê°€", "ì¹˜ìœ ë¶ˆê°€",
                        // ì‹ ì²´ì  ì¦ìƒ
                        "ì ëª»ì", "ì‹ìš•ì—†", "ë¬´ê±°ìš´ëª¸", "ëŠ˜ì–´ì§", "ì¶•ì²˜ì§", "ê¸°ë ¥ì—†", "ì—ë„ˆì§€ì—†", "í™œë ¥ì—†",
                        "ì§‘ì¤‘ì•ˆë¨", "ê¸°ì–µì•ˆë‚¨", "ê²°ì •ì¥ì• ", "ìš°ìœ ë¶€ë‹¨", "ë¯¸ë£¨ê¸°", "íšŒí”¼", "ë„í”¼", "ì€ë‘”",
                        // ì¸ì§€ì  í‘œí˜„
                        "ìê¾¸ìƒê°", "ë°˜ë³µìƒê°", "ê¼¬ë¦¬ë¬¼ê¸°", "ë¶€ì •ì ", "ë¹„íŒì ", "ì™„ë²½ì£¼ì˜", "ì‹¤íŒ¨ê°",
                        "ì£„ì±…ê°", "ì›ë§", "í›„íšŒ", "ìì±…", "ìê¸°í˜ì˜¤", "ìê¸°ë¶€ì •", "ìì•„ë¹„íŒ"
                    ],
                    anxiety: [
                        // ê¸°ë³¸ ë¶ˆì•ˆ í‘œí˜„
                        "ë¶ˆì•ˆ", "ê±±ì •", "ì´ˆì¡°", "ë‘ë ¤", "ê¸´ì¥", "ê³µí¬", "ë–¨ë¦¼", "ì‹¬ì¥", "ìˆ¨ì´ë§‰", "ê³µí™©",
                        "ë¶ˆí™•ì‹¤", "ì˜ˆë¯¼", "ê¸´ë°•", "ê¸´ì¥ê°", "ê·¼ì‹¬", "ê±±ì •ìŠ¤ëŸ¬ì›€", "ì••ë°•ê°", "ê¸´ì¥ë˜", "ë¶ˆí¸",
                        // í™•ì¥ëœ ë¶ˆì•ˆ í‘œí˜„
                        "ì¡°ë°”ì‹¬", "ì•ˆì ˆë¶€ì ˆ", "ëœëœ", "ë²Œë²Œ", "ì˜¤ê¸ˆì €ë¦¼", "ì‹ì€ë•€", "ì§„ë•€", "ì†ë–¨ë¦¼",
                        "ì‹¬ì¥ë°•ë™", "ê°€ìŠ´ë‘ê·¼", "ìˆ¨ê°€ì¨", "í˜¸í¡ê³¤ë€", "ì§ˆì‹", "ë‹µë‹µí•¨", "ëª©ë§‰í˜", "ëª©ì´ë¶“",
                        "ì–´ì§€ëŸ¬ì›€", "í˜„ê¸°ì¦", "ë¨¸ë¦¬ëµ", "ë©í•¨", "ì •ì‹ ì—†ìŒ", "ì§‘ì¤‘ì•ˆë¨", "ì‚°ë§Œí•¨",
                        // ìƒí™©ì  ë¶ˆì•ˆ
                        "ìµœì•…ì˜ìƒí™©", "ë§Œì•½ì—", "í˜¹ì‹œë‚˜", "ë¶ˆê¸¸í•œ", "ì˜ˆê°", "ì§•ì¡°", "ë¶ˆì•ˆê°", "ìœ„ê¸°ê°",
                        "ìœ„í—˜ì‹ í˜¸", "ê²½ê³ ", "ì•ŒëŒ", "ìŠ¤íŠ¸ë ˆìŠ¤", "ì••ë°•", "ë¶€ë‹´", "ì¤‘ì••ê°", "ê¸´ë°•í•¨",
                        "ì´‰ë°•í•¨", "ì‹œê¸‰í•¨", "ê¸‰í•¨", "ì„œë‘˜ëŸ¬", "ë¹¨ë¦¬", "ëŠ¦ì—ˆ", "ë†“ì¹¨", "ì‹¤ìˆ˜",
                        // ì‹ ì²´ ë°˜ì‘
                        "ë°°ì•„í””", "ì†ì“°ë¦¼", "ì†Œí™”ë¶ˆëŸ‰", "ë³€ë¹„", "ì„¤ì‚¬", "ì†ìš¸ë ", "êµ¬í† ", "ë©”ìŠ¤êº¼ì›€",
                        "ê·¼ìœ¡ê²½ì§", "ëª©ì–´ê¹¨", "ë’·ëª©", "ë‘í†µ", "í¸ë‘í†µ", "ëˆˆí”¼ë¡œ", "ëˆˆë–¨ë¦¼", "ì…ë§ˆë¦„",
                        // í–‰ë™ì  í‘œí˜„
                        "í™•ì¸", "ì¬í™•ì¸", "ë°˜ë³µ", "ê°•ë°•", "ì™„ë²½", "ê³„íš", "ì¤€ë¹„", "ëŒ€ë¹„", "ì˜ˆë°©",
                        "íšŒí”¼", "ë„ë§", "í”¼í•¨", "ë©€ë¦¬í•¨", "ê±°ë¶€", "ê±°ì ˆ", "ë¯¸ë£¸", "ì—°ê¸°"
                    ],
                    stress: [
                        // ê¸°ë³¸ ìŠ¤íŠ¸ë ˆìŠ¤ í‘œí˜„
                        "ìŠ¤íŠ¸ë ˆìŠ¤", "ì••ë°•", "í˜ë“¤", "ë²„ê±°", "ê°ë‹¹", "ë¶€ë‹´", "í”¼ë¡œ", "ì§€ì¹¨", "ê³¼ë¡œ", "ë²ˆì•„ì›ƒ",
                        "í”¼ê³¤", "ì§€ì¹˜", "ì†Œì§„", "ì´ˆê³¼ê·¼ë¬´", "í”¼ê³¤í•¨", "ì••ë„", "ì••ë„ë˜", "í•œê³„", "íƒˆì§„",
                        // í™•ì¥ëœ ìŠ¤íŠ¸ë ˆìŠ¤ í‘œí˜„
                        "ë²…ì°¨", "ê°ë‹¹ì•ˆë¨", "ì†ì—ì•ˆì¡í˜", "í†µì œë¶ˆê°€", "ì¡°ì ˆì•ˆë¨", "ê´€ë¦¬ì•ˆë¨", "ì²˜ë¦¬ì•ˆë¨",
                        "í•´ê²°ì•ˆë¨", "í’€ë¦¬ì§€ì•Š", "ì—‰í‚¨", "ë³µì¡", "ê¼¬ì¸", "ë‚œí•´", "ì–´ë ¤ì›€", "ê³¤ë€",
                        "ë§‰ë§‰í•¨", "ë‹µì—†ìŒ", "ì¶œêµ¬ì—†ìŒ", "ê¸¸ì—†ìŒ", "ë°©ë²•ì—†ìŒ", "í•´ë‹µì—†ìŒ", "ëŒ€ì•ˆì—†ìŒ",
                        // ì‹œê°„ ì••ë°•
                        "ì‹œê°„ì—†", "ì´‰ë°•", "ê¸‰í•¨", "ì„œë‘˜ëŸ¬", "ë¹¨ë¦¬", "ë°”ë¹ ", "ì •ì‹ ì—†", "ì«“ê¹€", "ë°€ë¦¼",
                        "ë°ë“œë¼ì¸", "ë§ˆê°", "ê¸°í•œ", "ì‹œí•œ", "ì œí•œ", "í•œì •", "ë¶€ì¡±", "ëª¨ìëŒ", "ë”¸ë¦¼",
                        // ì—…ë¬´/í•™ì—… ìŠ¤íŠ¸ë ˆìŠ¤
                        "ê³¼ì œ", "ìˆ™ì œ", "ì‹œí—˜", "í‰ê°€", "ì ìˆ˜", "ì„±ì ", "ìˆœìœ„", "ë“±ê¸‰", "ê²½ìŸ", "ë¹„êµ",
                        "ì‹¤ì ", "ì„±ê³¼", "ëª©í‘œ", "í• ë‹¹ëŸ‰", "ë…¸ë¥´ë§ˆ", "ê¸°ì¤€", "ìš”êµ¬ì‚¬í•­", "ì¡°ê±´", "ì˜ë¬´",
                        "ì±…ì„", "ì˜ë¬´", "ë¶€ë‹´", "ì••ë°•", "ê¸°ëŒ€", "ìš”êµ¬", "ì••ë ¥", "ê°•ìš”", "ê°•ì œ",
                        // ì‹ ì²´ì  í”¼ë¡œ
                        "ë…¹ì´ˆ", "íƒˆì§„", "ê¸°ë ¥ì†Œì§„", "ì—ë„ˆì§€ê³ ê°ˆ", "ë°°í„°ë¦¬ë°©ì „", "ì¶©ì „í•„ìš”", "íœ´ì‹í•„ìš”",
                        "ì¬ì¶©ì „", "íšŒë³µ", "ì¹˜ìœ ", "íë§", "ì‰¼", "ì ", "ìˆ˜ë©´", "í¸ì•ˆ", "ì•ˆì •"
                    ],
                    anger: [
                        // ê¸°ë³¸ ë¶„ë…¸ í‘œí˜„
                        "í™”", "ì§œì¦", "ë¶„ë…¸", "ì—´ë°›", "ë¹¡ì³", "ì†ìƒ", "ì–µìš¸", "ë¶„í•œ", "ì„±ì§ˆ", "í™”ë‚¨",
                        "ì›ë§", "ë¶ˆë§Œ", "ì§œì¦ë‚˜", "ë‹µë‹µ", "í­ë°œ", "í™”ê°€ì¹˜ë°€", "ë¶„ê°œ", "ì„±ì§ˆë‚˜", "ë¶„ë…¸ì¡°ì ˆ",
                        // í™•ì¥ëœ ë¶„ë…¸ í‘œí˜„
                        "ë¯¸ì¹˜ê² ", "ëŒê² ", "í™˜ì¥", "ì—´ë¶ˆ", "ë¹¡ì¹¨", "ëšœê»‘ì—´ë¦¼", "í­ë°œì§ì „", "í•œê³„ì ",
                        "ì°¸ì„ì„±", "ì¸ë‚´ì‹¬", "í•œê³„", "ë", "ê·¹í•œ", "ì ˆì •", "ì •ì ", "ìµœê³ ì¡°", "í”¼í¬",
                        "ìš¸ë¶„", "ë¶„í†µ", "ê²©ë¶„", "ê²©ë…¸", "ë…¸ë°œëŒ€ë°œ", "ë²„ëŸ­", "í­ë°œ", "í„°ì§", "ì†Œë¦¬",
                        // ê°ì • í‘œí˜„
                        "ì–µìš¸í•¨", "ë¶„í•¨", "ì›í†µí•¨", "í•œíƒ„", "í•œìŠ¤ëŸ¬ì›€", "ì†ìƒí•¨", "ì„œìš´í•¨", "ì‹¤ë§",
                        "ë°°ì‹ ê°", "ë¶ˆì‹ ", "ì˜ì‹¬", "ë¶ˆê³µí‰", "ë¶ˆí‰ë“±", "ì°¨ë³„", "í¸ê²¬", "ë¬´ì‹œ", "ë©¸ì‹œ",
                        "ê²½ë©¸", "ì¡°ë¡±", "ë¹„ì›ƒìŒ", "ëª¨ë…", "ëª¨ë©¸", "êµ´ìš•", "ì°½í”¼", "ìˆ˜ì¹˜", "ë¶€ë„ëŸ¬ì›€",
                        // ëŒ€ìƒë³„ ë¶„ë…¸
                        "ìƒì‚¬", "ë™ë£Œ", "ë¶€í•˜", "ì„ ë°°", "í›„ë°°", "ì¹œêµ¬", "ê°€ì¡±", "ë¶€ëª¨", "ìì‹", "ë°°ìš°ì",
                        "ì—°ì¸", "íƒ€ì¸", "ì‚¬íšŒ", "ì„¸ìƒ", "ì‹œìŠ¤í…œ", "ì œë„", "ê·œì¹™", "ë²•", "ì •ë¶€", "íšŒì‚¬",
                        // í–‰ë™ ì¶©ë™
                        "ë•Œë¦¬ê³ ì‹¶", "ë¶€ìˆ˜ê³ ì‹¶", "ì†Œë¦¬ì§€ë¥´ê³ ì‹¶", "ìš•í•˜ê³ ì‹¶", "ë„ë§ì¹˜ê³ ì‹¶", "ê·¸ë§Œë‘ê³ ì‹¶",
                        "í¬ê¸°í•˜ê³ ì‹¶", "ë²„ë¦¬ê³ ì‹¶", "ë˜ì§€ê³ ì‹¶", "ì°¨ë²„ë¦¬ê³ ì‹¶", "ë°•ì‚´ë‚´ê³ ì‹¶", "ë§ê°€ëœ¨ë¦¬ê³ ì‹¶"
                    ],
                    relationships: [
                        // ê¸°ë³¸ ê´€ê³„ í‘œí˜„
                        "ê°€ì¡±", "ì¹œêµ¬", "ì—°ì¸", "ë™ë£Œ", "ìƒì‚¬", "ë¶€ëª¨", "ìì‹", "ë°°ìš°ì", "ê°ˆë“±", "ë‹¤íˆ¼",
                        "ëŒ€í™”ë‹¨ì ˆ", "ì™•ë”°", "ë‹¨ì ˆ", "ì‚¬ì´ë©€ì–´ì§", "ë°°ì‹ ", "ì‹ ë¢°ë¬¸ì œ", "ì¹œë°€ê°", "ì˜¤í•´", "ê±°ì ˆ",
                        // í™•ì¥ëœ ê´€ê³„ í‘œí˜„
                        "ì†Œí†µ", "ëŒ€í™”", "ì´í•´", "ê³µê°", "ì§€ì§€", "ì§€ì›", "ë„ì›€", "í˜‘ë ¥", "í™”í•©", "ì¡°í™”",
                        "ê°ˆë“±", "ì¶©ëŒ", "ë§ˆì°°", "ë§ˆìŒìƒí•¨", "ì„œìš´í•¨", "ì„­ì„­í•¨", "ì•„ì‰¬ì›€", "ê·¸ë¦¬ì›€",
                        "ì™¸ë¡œì›€", "ê³ ë…", "ê³ ë¦½", "ì†Œì™¸", "ë°°ì œ", "ë”°ëŒë¦¼", "ë¬´ì‹œ", "í™€ëŒ€", "ëƒ‰ëŒ€",
                        // ê°€ì¡± ê´€ê³„
                        "ì—„ë§ˆ", "ì•„ë¹ ", "í˜•", "ëˆ„ë‚˜", "ì–¸ë‹ˆ", "ì˜¤ë¹ ", "ë™ìƒ", "í• ë¨¸ë‹ˆ", "í• ì•„ë²„ì§€",
                        "ì‹œë¶€ëª¨", "ì¥ì¸", "ì¥ëª¨", "ì‹œëŒ", "ì¹œì •", "í˜ˆìœ¡", "ê°€ì¡±ì‚¬ë‘", "ê°€ì¡±ê°ˆë“±",
                        "ì„¸ëŒ€ì°¨ì´", "ê°€ì¹˜ê´€ì°¨ì´", "ìœ¡ì•„", "ì–‘ìœ¡", "êµìœ¡", "í›ˆìœ¡", "ê´€ì‹¬", "ì• ì •",
                        // ì—°ì¸/ë¶€ë¶€ ê´€ê³„
                        "ì‚¬ë‘", "ì• ì •", "ë¡œë§¨ìŠ¤", "ë°ì´íŠ¸", "ë§Œë‚¨", "í—¤ì–´ì§", "ì´ë³„", "ê²°í˜¼", "ì´í˜¼",
                        "ë°”ëŒ", "ë¶ˆë¥œ", "ì™¸ë„", "ì§ˆíˆ¬", "ì‹œê¸°", "ì˜ì‹¬", "ë¶ˆì‹ ", "ë¯¿ìŒ", "ì‹ ë¢°",
                        "ì•½ì†", "ë§¹ì„¸", "ë‹¤ì§", "ê²°ì‹¬", "ë‹¤ì •", "ë‹¬ì½¤", "í–‰ë³µ", "ì¦ê±°ì›€", "ê¸°ì¨",
                        // ì¹œêµ¬ ê´€ê³„
                        "ìš°ì •", "ë™ë£Œ", "ì„ í›„ë°°", "ë™ê¸°", "ë™ì°½", "ì¹œëª©", "ëª¨ì„", "ë§Œë‚¨", "ì•½ì†",
                        "ë°°ì‹ ", "ì‹¤ë§", "ì‹ ë¢°", "ë¯¿ìŒ", "ì§€ì§€", "ì‘ì›", "ê²©ë ¤", "ìœ„ë¡œ", "ê³µê°",
                        // ì§ì¥ ê´€ê³„
                        "ìƒí•˜ê´€ê³„", "ìœ„ê³„ì§ˆì„œ", "ê¶Œë ¥", "ê¶Œìœ„", "ì§€ìœ„", "ì§ê¸‰", "ì§ì±…", "ì±…ì„",
                        "ì—…ë¬´í˜‘ë ¥", "íŒ€ì›Œí¬", "ì†Œí†µ", "ë³´ê³ ", "ì§€ì‹œ", "ëª…ë ¹", "ìš”ì²­", "ë¶€íƒ",
                        "ê°ˆë“±", "ê²½ìŸ", "ê²¬ì œ", "ì‹œê¸°", "ì§ˆíˆ¬", "í…ƒì„¸", "íŒŒë²Œ", "ì¤„ì„œê¸°", "ëˆˆì¹˜"
                    ],
                    work_school: [
                        // ê¸°ë³¸ ì—…ë¬´/í•™ì—… í‘œí˜„
                        "ì§ì¥", "íšŒì‚¬", "í•™êµ", "ì—…ë¬´", "ê³µë¶€", "ì‹œí—˜", "ì·¨ì—…", "ìŠ¹ì§„", "ì„±ì ", "ì§„ë¡œ",
                        "ê³¼ì œ", "í‰ê°€", "ë™ê¸°ë¶€ì—¬", "ì„±ê³¼ì••ë°•", "ì—…ë¬´ëŸ‰", "ì¡¸ì—…", "ì…ì‹œ", "ê²½ìŸ", "ì‹œê°„ì••ë°•",
                        // í™•ì¥ëœ ì—…ë¬´ í‘œí˜„
                        "ì¶œê·¼", "í‡´ê·¼", "ì•¼ê·¼", "ì£¼ë§ê·¼ë¬´", "ì´ˆê³¼ê·¼ë¬´", "ì”ì—…", "íŠ¹ê·¼", "êµëŒ€ê·¼ë¬´",
                        "í”„ë¡œì íŠ¸", "ë³´ê³ ì„œ", "íšŒì˜", "ë¯¸íŒ…", "í”„ë ˆì  í…Œì´ì…˜", "ë°œí‘œ", "ê¸°íš", "ì œì•ˆ",
                        "ì‹¤ì ", "ì„±ê³¼", "ëª©í‘œ", "ê³„íš", "ì „ëµ", "ë°©í–¥", "ë°©ì¹¨", "ì •ì±…", "ê·œì •",
                        "ìŠ¹ì§„", "í‰ê°€", "ì¸ì‚¬", "ë°°ì¹˜", "ì „ë³´", "ë°œë ¹", "ì„ëª…", "í•´ì„", "í‡´ì§",
                        // ì§ì¥ ìŠ¤íŠ¸ë ˆìŠ¤
                        "ìƒì‚¬", "ë¶€í•˜", "ë™ë£Œ", "ì„ ë°°", "í›„ë°°", "íŒ€ì¥", "ê³¼ì¥", "ë¶€ì¥", "ì„ì›",
                        "ê°ˆë“±", "ë§ˆì°°", "ë¶ˆí™”", "ê²¬ì œ", "í…ƒì„¸", "íŒŒë²Œ", "ì¤„ì„œê¸°", "ëˆˆì¹˜", "ì •ì¹˜",
                        "ì••ë°•", "ìŠ¤íŠ¸ë ˆìŠ¤", "ë¶€ë‹´", "ì±…ì„", "ì˜ë¬´", "í• ë‹¹", "ë…¸ë¥´ë§ˆ", "í• ë‹¹ëŸ‰",
                        // í•™ì—… ê´€ë ¨
                        "ìˆ˜ì—…", "ê°•ì˜", "ìˆ˜ê°•", "ê³¼ëª©", "í•™ì ", "í•™ë…„", "í•™ê¸°", "ë°©í•™", "ê°œê°•",
                        "ì‹œí—˜", "ì¤‘ê°„ê³ ì‚¬", "ê¸°ë§ê³ ì‚¬", "ëª¨ì˜ê³ ì‚¬", "ìˆ˜ëŠ¥", "ì…ì‹œ", "ëŒ€ì…", "ì·¨ì—…",
                        "ì„±ì ", "ì ìˆ˜", "ë“±ê¸‰", "ì„ì°¨", "ìˆœìœ„", "ê²½ìŸ", "ë¹„êµ", "ìš°ë“±", "ìš°ìˆ˜",
                        "ê³¼ì œ", "ìˆ™ì œ", "ë¦¬í¬íŠ¸", "ë°œí‘œ", "í† ë¡ ", "ì„¸ë¯¸ë‚˜", "í”„ë¡œì íŠ¸", "ì—°êµ¬",
                        // ì§„ë¡œ/ì·¨ì—…
                        "ì§„ë¡œ", "ì¥ë˜", "ë¯¸ë˜", "ê¿ˆ", "ëª©í‘œ", "ê³„íš", "ë¹„ì „", "í¬ë¶€", "ì•¼ë§",
                        "ì·¨ì—…", "êµ¬ì§", "ì±„ìš©", "ë©´ì ‘", "ì…ì‚¬", "ì§€ì›", "ì´ë ¥ì„œ", "ìì†Œì„œ",
                        "ìŠ¤í™", "ê²½ë ¥", "ê²½í—˜", "ìê²©ì¦", "ëŠ¥ë ¥", "ì‹¤ë ¥", "ì—­ëŸ‰", "ê¸°ìˆ ", "ì „ë¬¸ì„±"
                    ],
                    physical: [
                        // ê¸°ë³¸ ì‹ ì²´ í‘œí˜„
                        "ì•„í””", "í”¼ë¡œ", "ìˆ˜ë©´", "ì‹ìš•", "ë‘í†µ", "ì†Œí™”", "ëª¸ì‚´", "ì•„í”„", "ê±´ê°•", "ë³‘ì›",
                        "ê·¼ìœ¡í†µ", "í—ˆë¦¬í†µì¦", "í”¼ê³¤í•¨", "í”¼ë¡œê°", "ì–´ì§€ëŸ¼", "ì²´ë ¥ì €í•˜", "ì§ˆë³‘", "ì•½ë¬¼", "ìˆ˜ë©´ì¥ì• ",
                        // í™•ì¥ëœ ì‹ ì²´ í‘œí˜„
                        "ëª¸ë¬´ê±°ì›€", "ê¸°ë ¥ì—†ìŒ", "ì—ë„ˆì§€ì—†ìŒ", "í™œë ¥ì—†ìŒ", "ìƒê¸°ì—†ìŒ", "ì›ê¸°ì—†ìŒ",
                        "ì»¨ë””ì…˜ë‚œì¡°", "ëª¸ìƒíƒœ", "ê±´ê°•ìƒíƒœ", "ì²´ë ¥", "ë©´ì—­ë ¥", "ì €í•­ë ¥", "íšŒë³µë ¥",
                        // ìˆ˜ë©´ ê´€ë ¨
                        "ì ëª»ì ", "ë¶ˆë©´", "ë’¤ì²™ì„", "ìƒˆë²½ì—ê¹¸", "ì¼ì°ê¹¸", "ëŠ¦ì ", "ê³¼ìˆ˜ë©´", "ìˆ˜ë©´ë¶€ì¡±",
                        "ê¹Šì€ì ", "ì–•ì€ì ", "ì ë“¤ê¸°ì–´ë ¤ì›€", "ìˆ˜ë©´ë¦¬ë“¬", "ìˆ˜ë©´íŒ¨í„´", "ìˆ˜ë©´ì§ˆ", "ê¿ˆ",
                        "ì•…ëª½", "ì ê¼¬ëŒ€", "ì´ê°ˆì´", "ì½”ê³¨ì´", "ìˆ˜ë©´ë¬´í˜¸í¡", "ì ê¹¨ì›€", "ì¡¸ë¦¼", "ë‚˜ë¥¸í•¨",
                        // ì‹ìš•/ì†Œí™”
                        "ì‹ìš•ì—†ìŒ", "ê³¼ì‹", "í­ì‹", "ì‹ìš•ì¦ê°€", "ì²´ì¤‘", "ì‚´ì°œ", "ì‚´ë¹ ì§", "ë‹¤ì´ì–´íŠ¸",
                        "ì†Œí™”ë¶ˆëŸ‰", "ì†ì“°ë¦¼", "ìœ„ì—¼", "ì—­ë¥˜", "êµ¬í† ", "ë©”ìŠ¤êº¼ì›€", "ë³µí†µ", "ì„¤ì‚¬", "ë³€ë¹„",
                        // í†µì¦ ê´€ë ¨
                        "ë‘í†µ", "í¸ë‘í†µ", "ëª©í†µì¦", "ì–´ê¹¨í†µì¦", "í—ˆë¦¬í†µì¦", "ê´€ì ˆí†µ", "ê·¼ìœ¡í†µ",
                        "ì‹ ê²½í†µ", "ìƒë¦¬í†µ", "ì¹˜í†µ", "ë°°ì•“ì´", "ê°€ìŠ´í†µì¦", "í˜¸í¡ê³¤ë€", "ìˆ¨ê°€ì¨",
                        // ê¸°íƒ€ ì¦ìƒ
                        "í˜„ê¸°ì¦", "ì–´ì§€ëŸ¼", "ë©”ìŠ¤êº¼ì›€", "ìš¸ë ê±°ë¦¼", "êµ¬ì—­ê°", "í† í• ê²ƒê°™ìŒ",
                        "ì‹¬ì¥ë°•ë™", "ê°€ìŠ´ë‘ê·¼", "í˜ˆì••", "ë§¥ë°•", "ì²´ì˜¨", "ì—´", "ì˜¤í•œ", "ì¶¥ë‹¤",
                        "ë•€", "ì§„ë•€", "ì‹ì€ë•€", "íƒˆìˆ˜", "ê°ˆì¦", "ëª©ë§ˆë¦„", "ì…ë§ˆë¦„", "ì¹¨ë§ˆë¦„",
                        // ê°ê° ê´€ë ¨
                        "ì‹œì•¼íë¦¼", "ëˆˆí”¼ë¡œ", "ëˆˆë–¨ë¦¼", "ê·€ìš¸ë¦¼", "ì´ëª…", "ì²­ë ¥", "í›„ê°", "ë¯¸ê°",
                        "ì´‰ê°", "ê°ê°", "ë‘”ê°", "ì˜ˆë¯¼", "ë¯¼ê°", "ìê·¹", "ë°˜ì‘", "ì•Œë ˆë¥´ê¸°"
                    ],
                    loneliness: [
                        "í˜¼ì", "ì™¸ë¡œì›€", "ê³ ë…", "ê³ ë¦½", "ë‹¨ì ˆ", "ì†Œì™¸", "ë°°ì œ", "ë”°ëŒë¦¼", "ë¬´ì‹œ",
                        "í™€ë¡œ", "í˜¼ìì„œ", "ë‚˜ë§Œ", "ì•„ë¬´ë„", "ì—†ìŒ", "ë¹„ì–´ìˆìŒ", "ê³µí—ˆí•¨", "í—ˆë¬´í•¨",
                        "ì“¸ì“¸í•¨", "ì ë§‰", "ì •ì ", "ì¹¨ë¬µ", "ë¬´ìŒ", "ì¡°ìš©í•¨", "ì ìš”", "ê³ ìš”í•¨",
                        "ì‚¬ëŒì—†ìŒ", "ì—°ë½ì—†ìŒ", "ë§Œë‚¨ì—†ìŒ", "ëŒ€í™”ì—†ìŒ", "ì†Œí†µì—†ìŒ", "êµë¥˜ì—†ìŒ",
                        "ì¹œêµ¬ì—†ìŒ", "ê°€ì¡±ì—†ìŒ", "ì—°ì¸ì—†ìŒ", "ë™ë°˜ìì—†ìŒ", "íŒŒíŠ¸ë„ˆì—†ìŒ", "ìƒëŒ€ì—†ìŒ",
                        "ì´í•´ë°›ì§€ëª»í•¨", "ê³µê°ë°›ì§€ëª»í•¨", "ê´€ì‹¬ë°›ì§€ëª»í•¨", "ì‚¬ë‘ë°›ì§€ëª»í•¨", "ì¸ì •ë°›ì§€ëª»í•¨"
                    ],
                    self_esteem: [
                        "ìì¡´ê°", "ìì‹ ê°", "ìì•„", "ìê¸°", "ë‚˜", "ìŠ¤ìŠ¤ë¡œ", "ìë¦½", "ë…ë¦½",
                        "ìì¡´ì‹¬", "ìë¶€ì‹¬", "ìë‘", "ê¸ì§€", "ìë¶€", "ìì‹ ", "í™•ì‹ ", "ë¯¿ìŒ",
                        "ì—´ë“±ê°", "ìš°ì›”ê°", "ë¹„êµ", "í‰ê°€", "íŒë‹¨", "ê¸°ì¤€", "ì£ëŒ€", "ì²™ë„",
                        "ìê¸°í˜ì˜¤", "ìê¸°ë¶€ì •", "ìê¸°ë¹„í•˜", "ìê¸°ë¹„íŒ", "ìì±…", "ìê¸°ì„±ì°°",
                        "ìê¸°ê°œë°œ", "ìê¸°ê³„ë°œ", "ì„±ì¥", "ë°œì „", "í–¥ìƒ", "ê°œì„ ", "ë³€í™”", "ë³€í™”"
                    ],
                    fear: [
                        "ë‘ë ¤ì›€", "ê³µí¬", "ë¬´ì„œì›€", "ê²", "ê³µí¬ì‹¬", "ë‘ë ¤ì›Œ", "ë¬´ì„œì›Œ", "ê²ë‚˜",
                        "ë¶ˆì•ˆ", "ê±±ì •", "ì—¼ë ¤", "ê·¼ì‹¬", "ìš°ë ¤", "ìœ„í—˜", "ìœ„ê¸°", "ìœ„í˜‘", "ê²½ê³ ",
                        "ì‹¤íŒ¨", "ì¢Œì ˆ", "íŒ¨ë°°", "ì‹¤ìˆ˜", "ì˜ëª»", "í‹€ë¦¼", "ì˜¤ë¥˜", "ì°©ê°", "ì˜¤í•´",
                        "ê±°ì ˆ", "ê±°ë¶€", "ë°˜ëŒ€", "ë¶€ì •", "ë¹„íŒ", "ë¹„ë‚œ", "ìš•", "ë‚˜ìœë§", "ì•…í”Œ",
                        "ë¯¸ë˜", "ì•ì¼", "ë‚´ì¼", "ë‹¤ìŒ", "ë‚˜ì¤‘", "í›—ë‚ ", "ì¥ë˜", "ì¥ì°¨", "ì•ìœ¼ë¡œ"
                    ]
                };

                this.initializeSession();
                this.initializeEventListeners();
                this.loadSavedConfig();
            }

            /**
             * ì„¸ì…˜ ì´ˆê¸°í™”
             */
            initializeSession() {
                this.sessionIdElement.textContent = `ì„¸ì…˜: ${this.session.id}`;
                console.log('ìµëª… ì„¸ì…˜ ì‹œì‘:', this.session.id);
            }

            /**
             * ìµëª… ì„¸ì…˜ ID ìƒì„±
             */
            generateSessionId() {
                const timestamp = Date.now().toString();
                return this.hashString(timestamp).substring(0, 12);
            }

            /**
             * ê°„ë‹¨í•œ í•´ì‹œ í•¨ìˆ˜
             */
            hashString(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return Math.abs(hash).toString(16);
            }

            /**
             * ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™”
             */
            initializeEventListeners() {
                this.sendButton.addEventListener('click', () => this.sendMessage());
                
                this.messageInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                this.messageInput.addEventListener('input', () => {
                    this.messageInput.style.height = 'auto';
                    this.messageInput.style.height = this.messageInput.scrollHeight + 'px';
                });
            }

            /**
             * ì„¤ì • íŒ¨ë„ í† ê¸€
             */
            toggleSettings() {
                this.settingsPanel.classList.toggle('show');
            }

            /**
             * API ì„¤ì • ì €ì¥
             */
            async saveApiConfig() {
                const provider = document.getElementById('aiProvider').value;
                const apiKey = document.getElementById('apiKey').value;
                
                this.aiConfig.provider = provider;
                this.aiConfig.apiKey = apiKey || null;
                
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ (API í‚¤ëŠ” ì„¸ì…˜ì—ë§Œ)
                localStorage.setItem('aiProvider', provider);
                if (apiKey) {
                    sessionStorage.setItem('apiKey', apiKey);
                }
                
                // ì—°ê²° í…ŒìŠ¤íŠ¸
                await this.testApiConnection();
            }

            /**
             * ì €ì¥ëœ ì„¤ì • ë¡œë“œ
             */
            loadSavedConfig() {
                const savedProvider = localStorage.getItem('aiProvider');
                const savedApiKey = sessionStorage.getItem('apiKey');
                
                if (savedProvider) {
                    document.getElementById('aiProvider').value = savedProvider;
                    this.aiConfig.provider = savedProvider;
                }
                
                if (savedApiKey) {
                    document.getElementById('apiKey').value = savedApiKey;
                    this.aiConfig.apiKey = savedApiKey;
                    this.testApiConnection();
                }
            }

            /**
             * API ì—°ê²° í…ŒìŠ¤íŠ¸
             */
            async testApiConnection() {
                const statusElement = this.apiStatus;
                
                try {
                    statusElement.className = 'api-status';
                    statusElement.textContent = 'ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...';
                    
                    if (this.aiConfig.provider === 'local') {
                        this.aiConfig.isConnected = true;
                        statusElement.className = 'api-status connected';
                        statusElement.textContent = 'âœ… ë¡œì»¬ ëª¨ë¸ ì‚¬ìš© (ë¬´ë£Œ, ì œí•œì  ì„±ëŠ¥)';
                        return;
                    }
                    
                    if (!this.aiConfig.apiKey) {
                        statusElement.className = 'api-status error';
                        statusElement.textContent = 'âŒ API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤';
                        return;
                    }
                    
                    // ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ ìš”ì²­
                    const testResponse = await this.callAIAPI("ì•ˆë…•í•˜ì„¸ìš”", true);
                    
                    if (testResponse) {
                        this.aiConfig.isConnected = true;
                        statusElement.className = 'api-status connected';
                        statusElement.textContent = `âœ… ${this.aiConfig.provider.toUpperCase()} ì—°ê²° ì„±ê³µ`;
                    } else {
                        throw new Error('API ì‘ë‹µ ì—†ìŒ');
                    }
                    
                } catch (error) {
                    this.aiConfig.isConnected = false;
                    statusElement.className = 'api-status error';
                    statusElement.textContent = `âŒ ì—°ê²° ì‹¤íŒ¨: ${error.message}`;
                }
            }

            /**
             * AI API í˜¸ì¶œ (OpenAI, Google Gemini ë“±)
             */
            async callAIAPI(userMessage, isTest = false) {
                if (this.aiConfig.provider === 'local') {
                    return this.generateLocalResponse(userMessage, isTest);
                }
                
                try {
                    if (this.aiConfig.provider === 'openai') {
                        return await this.callOpenAI(userMessage, isTest);
                    } else if (this.aiConfig.provider === 'google') {
                        return await this.callGoogleGemini(userMessage, isTest);
                    }
                } catch (error) {
                    console.error('AI API í˜¸ì¶œ ì‹¤íŒ¨:', error);
                    // API ì‹¤íŒ¨ ì‹œ ë¡œì»¬ ëª¨ë¸ë¡œ í´ë°±
                    return this.generateLocalResponse(userMessage, isTest);
                }
            }

            /**
             * OpenAI API í˜¸ì¶œ
             */
            async callOpenAI(userMessage, isTest = false) {
                if (isTest) {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${this.aiConfig.apiKey}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-3.5-turbo',
                            messages: [{ role: 'user', content: 'í…ŒìŠ¤íŠ¸' }],
                            max_tokens: 50
                        })
                    });
                    
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    return 'ì—°ê²° ì„±ê³µ';
                }

                const systemPrompt = this.buildSystemPrompt();
                const conversationContext = this.buildConversationContext();
                
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.aiConfig.apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            { role: 'system', content: systemPrompt },
                            ...conversationContext,
                            { role: 'user', content: userMessage }
                        ],
                        max_tokens: 500,
                        temperature: 0.7
                    })
                });

                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                return data.choices[0].message.content;
            }

            /**
             * Google Gemini API í˜¸ì¶œ
             */
            async callGoogleGemini(userMessage, isTest = false) {
                if (isTest) {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${this.aiConfig.apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: 'í…ŒìŠ¤íŠ¸' }] }]
                        })
                    });
                    
                    if (!response.ok) throw new Error(`HTTP ${response.status}`);
                    return 'ì—°ê²° ì„±ê³µ';
                }

                const systemPrompt = this.buildSystemPrompt();
                const fullPrompt = `${systemPrompt}\n\nì‚¬ìš©ì: ${userMessage}\n\nìƒë‹´ì‚¬:`;
                
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${this.aiConfig.apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: fullPrompt }] }],
                        generationConfig: {
                            maxOutputTokens: 500,
                            temperature: 0.7
                        }
                    })
                });

                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            }

            /**
             * ë¡œì»¬ ëª¨ë¸ ì‘ë‹µ ìƒì„± (ëŒ€í­ ê°œì„ ëœ ë²„ì „)
             */
            generateLocalResponse(userMessage, isTest = false) {
                if (isTest) return 'ë¡œì»¬ ëª¨ë¸ ì‚¬ìš©';

                const keywords = this.extractKeywords(userMessage);
                const sentiment = this.analyzeSentiment(userMessage);
                const messageLength = userMessage.length;
                const conversationCount = this.conversationState.conversationHistory.length;
                
                // ëŒ€í™” ë‹¨ê³„ì— ë”°ë¥¸ ì‘ë‹µ ì¡°ì ˆ
                const conversationPhase = this.determineConversationPhase(conversationCount);
                
                // ê°ì •ë³„ ë‹¤ì–‘í•œ ì‘ë‹µ íŒ¨í„´ (ëŒ€í­ í™•ì¥)
                const responses = {
                    depression: {
                        opening: [
                            "ë§ˆìŒì´ ë§ì´ ë¬´ê±°ìš°ì‹  ê²ƒ ê°™ì•„ìš”. ì´ëŸ° ê°ì •ì„ í‘œí˜„í•´ì£¼ì…”ì„œ ê³ ë§™ìŠµë‹ˆë‹¤.",
                            "í˜ë“  ì‹œê°„ì„ ë³´ë‚´ê³  ê³„ì‹œëŠ”êµ°ìš”. ê·¸ëŸ° ë§ˆìŒì„ ëŠë¼ëŠ” ê²ƒ ìì²´ê°€ ìš©ê¸°ìˆëŠ” ì¼ì´ì—ìš”.",
                            "ìš°ìš¸í•œ ê°ì •ì´ ì§€ì†ë˜ê³  ìˆëŠ” ê²ƒ ê°™ì•„ìš”. í˜¼ì ê²¬ëŒë‚´ë ¤ í•˜ì§€ ë§ˆì„¸ìš”.",
                            "ì§€ê¸ˆ ëŠë¼ì‹œëŠ” ê°ì •ë“¤ì´ ì–¼ë§ˆë‚˜ í˜ë“ ì§€ ì´í•´í•´ìš”. ì¶©ë¶„íˆ ê·¸ëŸ´ ë§Œí•œ ìƒí™©ì¸ ê²ƒ ê°™ì•„ìš”.",
                            "ë§ˆìŒì˜ ì§ì´ ë¬´ê±°ì›Œ ë³´ì—¬ìš”. ì´ë ‡ê²Œ ì†”ì§í•˜ê²Œ ë§ì”€í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤."
                        ],
                        middle: [
                            "ì´ëŸ° ê°ì •ì´ ì–¸ì œë¶€í„° ì‹œì‘ë˜ì—ˆëŠ”ì§€ ê¸°ì–µë‚˜ì‹œë‚˜ìš”? íŠ¹ë³„í•œ ê³„ê¸°ê°€ ìˆì—ˆì„ê¹Œìš”?",
                            "ìš°ìš¸ê°ì´ í•˜ë£¨ ì¤‘ ì–¸ì œ ê°€ì¥ ì‹¬í•˜ê²Œ ëŠê»´ì§€ì‹œë‚˜ìš”? íŒ¨í„´ì´ ìˆëŠ”ì§€ ê¶ê¸ˆí•´ìš”.",
                            "ì§€ê¸ˆê¹Œì§€ ì´ëŸ° ê¸°ë¶„ì„ ê·¹ë³µí•´ë³´ë ¤ê³  ì–´ë–¤ ë…¸ë ¥ë“¤ì„ í•´ë³´ì…¨ë‚˜ìš”?",
                            "ê°€ì¡±ì´ë‚˜ ì¹œêµ¬ë“¤ì—ê²Œ ì´ëŸ° ë§ˆìŒì„ í„¸ì–´ë†“ì•„ë³´ì‹  ì ì´ ìˆìœ¼ì‹ ê°€ìš”?",
                            "í‰ì†Œ ê¸°ë¶„ì´ ì¢‹ì•˜ë˜ ë•Œë¥¼ ë– ì˜¬ë ¤ë³´ì‹œë©´ ì–´ë–¤ í™œë™ì„ í•˜ê³  ê³„ì…¨ë‚˜ìš”?"
                        ],
                        deep: [
                            "ì´ëŸ° ê°ì •ë“¤ì´ ì¼ìƒìƒí™œì— ì–´ë–¤ ì˜í–¥ì„ ë¯¸ì¹˜ê³  ìˆë‚˜ìš”? ì ì´ë‚˜ ì‹ì‚¬ëŠ” ì–´ë– ì‹ ê°€ìš”?",
                            "ìì‹ ì— ëŒ€í•´ ë¶€ì •ì ì¸ ìƒê°ì´ ë§ì•„ì§€ì…¨ë‚˜ìš”? ì–´ë–¤ ìƒê°ë“¤ì´ ìì£¼ ë“œì‹œëŠ”ì§€ìš”?",
                            "ë¯¸ë˜ì— ëŒ€í•œ í¬ë§ì´ë‚˜ ê³„íšì„ ì„¸ìš°ê¸° ì–´ë ¤ìš°ì‹ ê°€ìš”? ê·¸ëŸ° ë§ˆìŒ ì¶©ë¶„íˆ ì´í•´í•´ìš”.",
                            "í˜¹ì‹œ ì „ë¬¸ì ì¸ ë„ì›€ì„ ë°›ì•„ë³´ëŠ” ê²ƒì— ëŒ€í•´ ì–´ë–»ê²Œ ìƒê°í•˜ì‹œë‚˜ìš”?",
                            "ì§€ê¸ˆ ë‹¹ì¥ ê°€ì¥ í•„ìš”í•˜ë‹¤ê³  ëŠë¼ëŠ” ê²ƒì´ ìˆë‹¤ë©´ ë¬´ì—‡ì¼ê¹Œìš”?"
                        ]
                    },
                    anxiety: {
                        opening: [
                            "ë¶ˆì•ˆí•œ ë§ˆìŒì´ í¬ê²Œ ëŠê»´ì§€ê³  ê³„ì‹œëŠ”êµ°ìš”. ê·¸ëŸ° ê°ì •ì„ ì¸ì •í•˜ëŠ” ê²ƒë¶€í„° ì‹œì‘ì´ì—ìš”.",
                            "ê±±ì •ì´ ë§ìœ¼ì‹  ê²ƒ ê°™ì•„ìš”. ë§ˆìŒì´ í¸í•˜ì§€ ì•Šìœ¼ì‹œì£ ?",
                            "ë¶ˆì•ˆê°ì´ ì¼ìƒì„ í˜ë“¤ê²Œ ë§Œë“¤ê³  ìˆëŠ” ê²ƒ ê°™ì•„ìš”. ì–´ë–¤ ìƒí™©ì—ì„œ ë” ì‹¬í•´ì§€ë‚˜ìš”?",
                            "ê¸´ì¥ë˜ê³  ì˜ˆë¯¼í•´ì§€ëŠ” ë§ˆìŒì´ ëŠê»´ì ¸ìš”. ëª¸ë„ í•¨ê»˜ ê¸´ì¥ë˜ì–´ ìˆìœ¼ì‹¤ ê²ƒ ê°™ì•„ìš”.",
                            "ë§ˆìŒì´ ì¡°ê¸‰í•˜ê³  ì•ˆì ˆë¶€ì ˆí•˜ì‹  ê²ƒ ê°™ì•„ìš”. ê·¸ëŸ° ê°ì •ì´ ì–¼ë§ˆë‚˜ í˜ë“ ì§€ ì•Œì•„ìš”."
                        ],
                        middle: [
                            "ì–´ë–¤ ìƒí™©ì´ë‚˜ ìƒê°ì´ ë¶ˆì•ˆê°ì„ ë” í¬ê²Œ ë§Œë“œì‹œë‚˜ìš”?",
                            "ë¶ˆì•ˆí•  ë•Œ ëª¸ì—ì„œ ëŠê»´ì§€ëŠ” ì¦ìƒë“¤ì´ ìˆë‚˜ìš”? ì‹¬ì¥ ë°•ë™ì´ë‚˜ ìˆ¨ì‰¬ê¸°ëŠ” ì–´ë– ì‹ ê°€ìš”?",
                            "ë°¤ì— ì ë“¤ê¸° ì–´ë ¤ìš°ì‹œê±°ë‚˜ ìê¾¸ ê¹¨ì‹œëŠ” ì¼ì´ ìˆë‚˜ìš”?",
                            "ë¶ˆì•ˆí•œ ìƒê°ë“¤ì´ ë¨¸ë¦¬ì—ì„œ ë– ë‚˜ì§€ ì•Šì•„ì„œ ì§‘ì¤‘í•˜ê¸° ì–´ë ¤ìš°ì‹ ê°€ìš”?",
                            "ì˜ˆì „ì—ëŠ” ê´œì°®ì•˜ë˜ ì¼ë“¤ë„ ì§€ê¸ˆì€ ê±±ì •ë˜ì‹œë‚˜ìš”? ì–¸ì œë¶€í„° ê·¸ë¬ëŠ”ì§€ ê¸°ì–µë‚˜ì‹œë‚˜ìš”?"
                        ],
                        deep: [
                            "ê°€ì¥ ë‘ë ¤ì›Œí•˜ì‹œëŠ” ê²ƒì´ ì‹¤ì œë¡œ ì¼ì–´ë‚  ê°€ëŠ¥ì„±ì€ ì–¼ë§ˆë‚˜ ëœë‹¤ê³  ìƒê°í•˜ì„¸ìš”?",
                            "ë¶ˆì•ˆí•  ë•Œ ë„ì›€ì´ ë˜ëŠ” í˜¸í¡ë²•ì´ë‚˜ ì´ì™„ ë°©ë²•ì„ ì‹œë„í•´ë³´ì‹  ì ì´ ìˆë‚˜ìš”?",
                            "ì£¼ë³€ ì‚¬ëŒë“¤ì´ ë‹¹ì‹ ì˜ ë¶ˆì•ˆê°ì„ ì´í•´í•´ì£¼ê³  ìˆë‚˜ìš”? ì§€ì§€ë°›ê³  ê³„ì‹ ê°€ìš”?",
                            "ë¶ˆì•ˆê° ë•Œë¬¸ì— í”¼í•˜ê²Œ ë˜ëŠ” ìƒí™©ë“¤ì´ ëŠ˜ì–´ë‚˜ê³  ìˆë‚˜ìš”?",
                            "ì´ëŸ° ë¶ˆì•ˆê°ì„ ì „ë¬¸ê°€ì™€ ìƒë‹´í•´ë³´ëŠ” ê²ƒì— ëŒ€í•´ì„œëŠ” ì–´ë–»ê²Œ ìƒê°í•˜ì„¸ìš”?"
                        ]
                    },
                    stress: {
                        opening: [
                            "ë§ì€ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ê³  ê³„ì‹œëŠ” ê²ƒ ê°™ì•„ìš”. ì •ë§ í˜ë“œì…¨ì„ ê²ƒ ê°™ì•„ìš”.",
                            "ì••ë°•ê°ì´ ìƒë‹¹íˆ í¬ê²Œ ëŠê»´ì§€ì‹œëŠ”êµ°ìš”. ì–´ê¹¨ê°€ ë¬´ê±°ìš°ì‹¤ ê²ƒ ê°™ì•„ìš”.",
                            "ì—¬ëŸ¬ ê°€ì§€ ì¼ë“¤ì´ í•œêº¼ë²ˆì— ëª°ë ¤ì™€ì„œ ë¶€ë‹´ìŠ¤ëŸ¬ìš°ì‹  ê²ƒ ê°™ì•„ìš”.",
                            "ìŠ¤íŠ¸ë ˆìŠ¤ê°€ í•œê³„ì ì— ë‹¤ë‹¤ë¥¸ ê²ƒ ê°™ì•„ìš”. íœ´ì‹ì´ ì ˆì‹¤í•´ ë³´ì—¬ìš”.",
                            "ê°ë‹¹í•˜ê¸° ì–´ë ¤ìš´ ìƒí™©ë“¤ì´ ê³„ì†ë˜ê³  ìˆëŠ” ê²ƒ ê°™ì•„ìš”. ì •ë§ ìˆ˜ê³  ë§ìœ¼ì„¸ìš”."
                        ],
                        middle: [
                            "í˜„ì¬ ê°€ì¥ í° ìŠ¤íŠ¸ë ˆìŠ¤ ìš”ì¸ì´ ë¬´ì—‡ì¸ê°€ìš”? ì—¬ëŸ¬ ê°€ì§€ê°€ ê²¹ì³ìˆë‚˜ìš”?",
                            "ìŠ¤íŠ¸ë ˆìŠ¤ ë•Œë¬¸ì— ëª¸ì— ë‚˜íƒ€ë‚˜ëŠ” ì¦ìƒë“¤ì´ ìˆë‚˜ìš”? í”¼ë¡œê°ì´ë‚˜ ë‘í†µì€ ì–´ë– ì‹ ê°€ìš”?",
                            "ì´ëŸ° ìƒí™©ì´ ì–¼ë§ˆë‚˜ ì§€ì†ë˜ì—ˆë‚˜ìš”? ì–¸ì œë¶€í„° ì´ë ‡ê²Œ í˜ë“¤ì–´ì§€ì…¨ë‚˜ìš”?",
                            "ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ í•´ì†Œí•  ìˆ˜ ìˆëŠ” ì‹œê°„ì´ë‚˜ ë°©ë²•ì´ ìˆìœ¼ì‹ ê°€ìš”?",
                            "ì£¼ë³€ì—ì„œ ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆëŠ” ì‚¬ëŒì´ë‚˜ ìì›ì´ ìˆë‚˜ìš”?"
                        ],
                        deep: [
                            "ì§€ê¸ˆ ìƒí™©ì—ì„œ ê°€ì¥ ìš°ì„ ìˆœìœ„ë¥¼ ë‘ì–´ì•¼ í•  ê²ƒë“¤ì„ ì •ë¦¬í•´ë³´ì…¨ë‚˜ìš”?",
                            "ì™„ë²½í•˜ê²Œ í•˜ë ¤ê³  í•˜ì‹œëŠ” ì„±í–¥ì´ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë” í‚¤ìš°ê³  ìˆì§€ëŠ” ì•Šë‚˜ìš”?",
                            "ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ë¥¼ ìœ„í•´ ìƒí™œ íŒ¨í„´ì„ ë°”ê¿”ë³¼ ì—¬ì§€ê°€ ìˆì„ê¹Œìš”?",
                            "ì´ëŸ° ìŠ¤íŠ¸ë ˆìŠ¤ ìƒí™©ì´ ë°˜ë³µëœë‹¤ë©´ ì–´ë–¤ ëŒ€ì²˜ ë°©ë²•ì´ í•„ìš”í• ê¹Œìš”?",
                            "ì „ë¬¸ì ì¸ ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ ê¸°ë²•ì„ ë°°ì›Œë³´ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”?"
                        ]
                    },
                    anger: {
                        opening: [
                            "í™”ê°€ ë§ì´ ë‚˜ì…¨êµ°ìš”. ê·¸ëŸ° ê°ì •ì„ ëŠë¼ëŠ” ê²ƒë„ ìì—°ìŠ¤ëŸ¬ìš´ ë°˜ì‘ì´ì—ìš”.",
                            "ë¶„ë…¸ê°€ ì¹˜ë°€ì–´ ì˜¤ë¥´ê³  ê³„ì‹œëŠ” ê²ƒ ê°™ì•„ìš”. ì–µìš¸í•˜ê³  ë‹µë‹µí•˜ì‹œì£ ?",
                            "ì •ë§ í™”ê°€ ë‚˜ì‹¤ ë§Œí•œ ìƒí™©ì´ì—ˆì„ ê²ƒ ê°™ì•„ìš”. ì–´ë–¤ ì¼ì´ ìˆìœ¼ì…¨ë‚˜ìš”?",
                            "ê°ì •ì´ ë¶ë°›ì³ ì˜¤ë¥´ê³  ê³„ì‹œëŠ”êµ°ìš”. ê·¸ ë§ˆìŒ ì¶©ë¶„íˆ ì´í•´í•´ìš”.",
                            "ë¶„í•œ ë§ˆìŒì´ í¬ê²Œ ëŠê»´ì ¸ìš”. ì°¸ê¸° ì–´ë ¤ìš°ì…¨ì„ ê²ƒ ê°™ì•„ìš”."
                        ],
                        middle: [
                            "ì–´ë–¤ ìƒí™©ì—ì„œ ê°€ì¥ í™”ê°€ ë‚˜ì‹œë‚˜ìš”? êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–¤ ì¼ì´ì—ˆì„ê¹Œìš”?",
                            "í™”ê°€ ë‚  ë•Œ ëª¸ì—ì„œ ì–´ë–¤ ë³€í™”ë¥¼ ëŠë¼ì‹œë‚˜ìš”? ì‹¬ì¥ì´ ë¹¨ë¦¬ ë›°ê±°ë‚˜ ì†ì´ ë–¨ë¦¬ë‚˜ìš”?",
                            "ì´ëŸ° ë¶„ë…¸ê°ì´ ìì£¼ ìƒê¸°ì‹œë‚˜ìš”? ì•„ë‹ˆë©´ íŠ¹ë³„í•œ ìƒí™©ì—ì„œë§Œ ê·¸ëŸ¬ì‹œë‚˜ìš”?",
                            "í™”ê°€ ë‚œ í›„ì—ëŠ” ì–´ë–¤ ê¸°ë¶„ì´ ë“œì‹œë‚˜ìš”? í›„íšŒë˜ê±°ë‚˜ ë” ìš°ìš¸í•´ì§€ì‹œë‚˜ìš”?",
                            "ë¶„ë…¸ë¥¼ í‘œí˜„í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ê³ ë¯¼í•´ë³´ì‹  ì ì´ ìˆë‚˜ìš”?"
                        ],
                        deep: [
                            "ì´ëŸ° ë¶„ë…¸ì˜ ë°‘ë°”íƒ•ì—ëŠ” ì–´ë–¤ ê°ì •ì´ ìˆ¨ì–´ìˆë‹¤ê³  ìƒê°í•˜ì„¸ìš”? ìƒì²˜ë‚˜ ì‹¤ë§ê°ì¼ê¹Œìš”?",
                            "í™”ë¥¼ ê±´ê°•í•˜ê²Œ í‘œí˜„í•˜ê±°ë‚˜ í•´ì†Œí•˜ëŠ” ë°©ë²•ì„ ì°¾ì•„ë³´ì…¨ë‚˜ìš”?",
                            "ë¶„ë…¸ ë•Œë¬¸ì— ì¤‘ìš”í•œ ê´€ê³„ë“¤ì´ ì˜í–¥ì„ ë°›ê³  ìˆì§€ëŠ” ì•Šë‚˜ìš”?",
                            "ì´ëŸ° ê°ì •ë“¤ì„ ì¡°ì ˆí•˜ëŠ” ê²ƒì— ëŒ€í•´ ì „ë¬¸ì ì¸ ë„ì›€ì„ ë°›ì•„ë³´ì‹  ì ì´ ìˆë‚˜ìš”?",
                            "ë¶„ë…¸ë¥¼ ê¸ì •ì ì¸ ë³€í™”ì˜ ì—ë„ˆì§€ë¡œ ë°”ê¿€ ìˆ˜ ìˆëŠ” ë°©ë²•ì´ ìˆì„ê¹Œìš”?"
                        ]
                    },
                    relationships: {
                        opening: [
                            "ì¸ê°„ê´€ê³„ì—ì„œ ì–´ë ¤ì›€ì„ ê²ªê³  ê³„ì‹œëŠ”êµ°ìš”. ì‚¬ëŒê³¼ì˜ ê´€ê³„ëŠ” ì •ë§ ë³µì¡í•˜ì£ .",
                            "ì£¼ë³€ ì‚¬ëŒë“¤ê³¼ì˜ ê´€ê³„ì—ì„œ í˜ë“  ì¼ì´ ìˆìœ¼ì…¨ë‚˜ìš”? ë§ˆìŒì´ ìƒí•˜ì…¨ì„ ê²ƒ ê°™ì•„ìš”.",
                            "ì†Œì¤‘í•œ ì‚¬ëŒê³¼ì˜ ê´€ê³„ì— ë¬¸ì œê°€ ìƒê¸°ë©´ ì •ë§ í˜ë“¤ì£ . ì–´ë–¤ ìƒí™©ì´ì‹ ê°€ìš”?",
                            "ì‚¬ëŒë“¤ê³¼ì˜ ê´€ê³„ì—ì„œ ì†Œì™¸ê°ì´ë‚˜ ì™¸ë¡œì›€ì„ ëŠë¼ê³  ê³„ì‹œëŠ” ê²ƒ ê°™ì•„ìš”.",
                            "ê°ˆë“±ì´ë‚˜ ì˜¤í•´ë¡œ ì¸í•´ ê´€ê³„ê°€ ì–´ë ¤ì›Œì§„ ê²ƒ ê°™ì•„ìš”. ë§ˆìŒì´ ë§ì´ ì•„í”„ì‹¤ ê±°ì˜ˆìš”."
                        ],
                        middle: [
                            "ì–´ë–¤ ê´€ê³„ì—ì„œ ê°€ì¥ í° ì–´ë ¤ì›€ì„ ëŠë¼ì‹œë‚˜ìš”? ê°€ì¡±, ì¹œêµ¬, ë™ë£Œ ì¤‘ì—ì„œìš”?",
                            "ê·¸ ì‚¬ëŒê³¼ì˜ ê´€ê³„ì—ì„œ ì–´ë–¤ ë¶€ë¶„ì´ ê°€ì¥ í˜ë“œì‹œë‚˜ìš”?",
                            "ì„œë¡œ ë‹¤ë¥¸ ìƒê°ì´ë‚˜ ê°€ì¹˜ê´€ ë•Œë¬¸ì— ê°ˆë“±ì´ ìƒê¸°ëŠ” ê±´ê°€ìš”?",
                            "ì†Œí†µì—ì„œ ì–´ë ¤ì›€ì„ ëŠë¼ì‹œë‚˜ìš”? ë§ì´ ì˜ í†µí•˜ì§€ ì•ŠëŠ” ëŠë‚Œì´ì‹ ê°€ìš”?",
                            "ê·¸ ê´€ê³„ë¥¼ ê°œì„ í•˜ê¸° ìœ„í•´ ì–´ë–¤ ë…¸ë ¥ë“¤ì„ í•´ë³´ì…¨ë‚˜ìš”?"
                        ],
                        deep: [
                            "ê±´ê°•í•œ ê´€ê³„ë¥¼ ìœ ì§€í•˜ëŠ” ê²ƒì— ëŒ€í•´ ì–´ë–»ê²Œ ìƒê°í•˜ì„¸ìš”?",
                            "ê²½ê³„ë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒì´ í•„ìš”í•œ ê´€ê³„ëŠ” ì•„ë‹Œê°€ìš”?",
                            "ê·¸ ì‚¬ëŒê³¼ì˜ ê´€ê³„ì—ì„œ ë‹¹ì‹ ì´ ì§„ì • ì›í•˜ëŠ” ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?",
                            "ê´€ê³„ ê°œì„ ì„ ìœ„í•´ ì „ë¬¸ì ì¸ ìƒë‹´ì„ ë°›ì•„ë³´ëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”?",
                            "í˜¹ì€ ê·¸ ê´€ê³„ë¥¼ ì •ë¦¬í•˜ëŠ” ê²ƒë„ í•˜ë‚˜ì˜ ì„ íƒì¼ ìˆ˜ ìˆì–´ìš”. ì–´ë–»ê²Œ ìƒê°í•˜ì„¸ìš”?"
                        ]
                    },
                    work_school: {
                        opening: [
                            "ì§ì¥ì´ë‚˜ í•™êµì—ì„œ í˜ë“  ì¼ì´ ìˆìœ¼ì…¨êµ°ìš”. ì •ë§ ìŠ¤íŠ¸ë ˆìŠ¤ë°›ìœ¼ì…¨ì„ ê²ƒ ê°™ì•„ìš”.",
                            "ì—…ë¬´ë‚˜ í•™ì—… ë¶€ë‹´ì´ í¬ê²Œ ëŠê»´ì§€ê³  ê³„ì‹œëŠ” ê²ƒ ê°™ì•„ìš”.",
                            "ì§ì¥/í•™êµ í™˜ê²½ì—ì„œ ì–´ë ¤ì›€ì„ ê²ªê³  ê³„ì‹œëŠ”êµ°ìš”. ì–´ë–¤ ìƒí™©ì¸ê°€ìš”?",
                            "ì„±ê³¼ë‚˜ í‰ê°€ì— ëŒ€í•œ ì••ë°•ê°ì´ í¬ì‹  ê²ƒ ê°™ì•„ìš”.",
                            "ì§„ë¡œë‚˜ ë¯¸ë˜ì— ëŒ€í•œ ê³ ë¯¼ì´ ë§ìœ¼ì‹  ê²ƒ ê°™ì•„ìš”. ë§ˆìŒì´ ë³µì¡í•˜ì‹œê² ì–´ìš”."
                        ],
                        middle: [
                            "ê°€ì¥ í° ìŠ¤íŠ¸ë ˆìŠ¤ ìš”ì¸ì´ ì—…ë¬´ëŸ‰ì¸ê°€ìš”, ì•„ë‹ˆë©´ ì¸ê°„ê´€ê³„ì¸ê°€ìš”?",
                            "í˜„ì¬ ìƒí™©ì´ ì–¸ì œë¶€í„° ì‹œì‘ë˜ì—ˆë‚˜ìš”? íŠ¹ë³„í•œ ë³€í™”ê°€ ìˆì—ˆë‚˜ìš”?",
                            "ë™ë£Œë‚˜ ìƒì‚¬, ì„ ìƒë‹˜ê³¼ì˜ ê´€ê³„ëŠ” ì–´ë– ì‹ ê°€ìš”?",
                            "ì¼ê³¼ ì‚¶ì˜ ê· í˜•ì„ ë§ì¶”ê¸° ì–´ë ¤ìš°ì‹ ê°€ìš”?",
                            "ì´ëŸ° ìƒí™©ì´ ê°œì„ ë  ê°€ëŠ¥ì„±ì´ ìˆë‹¤ê³  ë³´ì‹œë‚˜ìš”?"
                        ],
                        deep: [
                            "í˜„ì¬ í•˜ê³  ê³„ì‹  ì¼ì´ ë‹¹ì‹ ì˜ ê°€ì¹˜ê´€ê³¼ ë§ë‹¤ê³  ìƒê°í•˜ì„¸ìš”?",
                            "ì¥ê¸°ì ì¸ ì»¤ë¦¬ì–´ ê³„íšì´ë‚˜ ëª©í‘œê°€ ìˆìœ¼ì‹ ê°€ìš”?",
                            "í™˜ê²½ì„ ë°”ê¾¸ëŠ” ê²ƒ(ì´ì§, ì „í•™ ë“±)ì„ ê³ ë ¤í•´ë³´ì…¨ë‚˜ìš”?",
                            "ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë¦¬ë‚˜ ì‹œê°„ ê´€ë¦¬ ê¸°ìˆ ì„ ë°°ì›Œë³´ì‹œëŠ” ê±´ ì–´ë–¨ê¹Œìš”?",
                            "ì „ë¬¸ì ì¸ ì»¤ë¦¬ì–´ ìƒë‹´ì„ ë°›ì•„ë³´ì‹œëŠ” ê²ƒë„ ë„ì›€ì´ ë  ê²ƒ ê°™ì•„ìš”."
                        ]
                    },
                    physical: {
                        opening: [
                            "ì‹ ì²´ì ìœ¼ë¡œë„ í˜ë“œì‹  ê²ƒ ê°™ì•„ìš”. ëª¸ê³¼ ë§ˆìŒì€ ì„œë¡œ ì—°ê²°ë˜ì–´ ìˆê±°ë“ ìš”.",
                            "ëª¸ì˜ ì¦ìƒë“¤ì´ ë§ˆìŒì˜ ìƒíƒœì™€ë„ ê´€ë ¨ì´ ìˆì„ ìˆ˜ ìˆì–´ìš”.",
                            "ì‹ ì²´ì ì¸ ë¶ˆí¸í•¨ì´ ì¼ìƒì— ë§ì€ ì˜í–¥ì„ ë¯¸ì¹˜ê³  ê³„ì‹œëŠ”êµ°ìš”.",
                            "ëª¸ì´ ì•„í”„ë©´ ë§ˆìŒë„ ë”ìš± í˜ë“¤ì–´ì§€ì£ . ì–´ë–¤ ì¦ìƒì´ ê°€ì¥ ê´´ë¡œìš°ì‹ ê°€ìš”?",
                            "ê±´ê°• ë¬¸ì œë¡œ ì¸í•œ ìŠ¤íŠ¸ë ˆìŠ¤ë„ ìƒë‹¹í•˜ì‹¤ ê²ƒ ê°™ì•„ìš”."
                        ],
                        middle: [
                            "ì´ëŸ° ì¦ìƒë“¤ì´ ì–¸ì œë¶€í„° ì‹œì‘ë˜ì—ˆë‚˜ìš”? ìŠ¤íŠ¸ë ˆìŠ¤ì™€ ê´€ë ¨ì´ ìˆì„ê¹Œìš”?",
                            "ë³‘ì› ì§„ë£ŒëŠ” ë°›ì•„ë³´ì…¨ë‚˜ìš”? ì „ë¬¸ì˜ ì†Œê²¬ì€ ì–´ë– ì…¨ë‚˜ìš”?",
                            "ì¦ìƒì´ ì¼ìƒìƒí™œì— ì–´ë–¤ ì˜í–¥ì„ ë¯¸ì¹˜ê³  ìˆë‚˜ìš”?",
                            "ìˆ˜ë©´ íŒ¨í„´ì´ë‚˜ ì‹ìŠµê´€ì— ë³€í™”ê°€ ìˆìœ¼ì…¨ë‚˜ìš”?",
                            "ê·œì¹™ì ì¸ ìš´ë™ì´ë‚˜ ìƒí™œ ê´€ë¦¬ëŠ” í•˜ê³  ê³„ì‹œë‚˜ìš”?"
                        ],
                        deep: [
                            "ìŠ¤íŠ¸ë ˆìŠ¤ë‚˜ ê°ì • ìƒíƒœê°€ ì‹ ì²´ ì¦ìƒì— ì˜í–¥ì„ ë¯¸ì¹˜ê³  ìˆë‹¤ê³  ìƒê°í•˜ì„¸ìš”?",
                            "ì‹¬ë¦¬ì ì¸ ë¶€ë¶„ê³¼ ì‹ ì²´ ì¦ìƒì„ í•¨ê»˜ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ í•„ìš”í•  ê²ƒ ê°™ì•„ìš”.",
                            "ìƒí™œ ìŠµê´€ ê°œì„ ì„ í†µí•´ ë‚˜ì•„ì§ˆ ìˆ˜ ìˆëŠ” ë¶€ë¶„ì´ ìˆì„ê¹Œìš”?",
                            "í†µí•©ì ì¸ ê±´ê°• ê´€ë¦¬ ë°©ë²•ì— ëŒ€í•´ ê´€ì‹¬ì´ ìˆìœ¼ì‹ ê°€ìš”?",
                            "í•„ìš”í•˜ë‹¤ë©´ ì •ì‹ ê±´ê°•ì˜í•™ê³¼ ìƒë‹´ë„ ë„ì›€ì´ ë  ìˆ˜ ìˆì–´ìš”."
                        ]
                    },
                    loneliness: {
                        opening: [
                            "ì™¸ë¡œì›€ì„ ë§ì´ ëŠë¼ê³  ê³„ì‹œëŠ”êµ°ìš”. ê·¸ëŸ° ë§ˆìŒì´ ì–¼ë§ˆë‚˜ í˜ë“ ì§€ ì´í•´í•´ìš”.",
                            "í˜¼ìë¼ëŠ” ëŠë‚Œì´ í¬ê²Œ ë‹¤ê°€ì˜¤ê³  ìˆëŠ” ê²ƒ ê°™ì•„ìš”. ì •ë§ ì“¸ì“¸í•˜ì‹œê² ì–´ìš”.",
                            "ì‚¬ëŒë“¤ê³¼ ë‹¨ì ˆëœ ëŠë‚Œì„ ë°›ê³  ê³„ì‹œëŠ” ê²ƒ ê°™ì•„ìš”. ë§ˆìŒì´ ë§ì´ ì•„í”„ì‹¤ ê±°ì˜ˆìš”.",
                            "ì†Œì†ê°ì´ë‚˜ ì—°ê²°ê°ì„ ëŠë¼ê¸° ì–´ë ¤ìš°ì‹  ìƒí™©ì¸ ê²ƒ ê°™ì•„ìš”.",
                            "ê³ ë¦½ê°ì´ ê¹Šì–´ì§€ê³  ìˆëŠ” ê²ƒ ê°™ì•„ìš”. ëˆ„êµ°ê°€ì™€ ì§„ì •í•œ ì†Œí†µì´ ê·¸ë¦¬ìš°ì‹œì£ ?"
                        ],
                        middle: [
                            "ì–¸ì œë¶€í„° ì´ëŸ° ì™¸ë¡œì›€ì„ ëŠë¼ê¸° ì‹œì‘í•˜ì…¨ë‚˜ìš”?",
                            "ì£¼ë³€ì— ì‚¬ëŒë“¤ì´ ìˆì–´ë„ ì™¸ë¡œì›€ì„ ëŠë¼ì‹œë‚˜ìš”?",
                            "ì§„ì •ìœ¼ë¡œ ì´í•´í•´ì£¼ëŠ” ì‚¬ëŒì´ í•„ìš”í•˜ì‹  ê²ƒ ê°™ì•„ìš”. ê·¸ëŸ° ì‚¬ëŒì´ ìˆë‚˜ìš”?",
                            "ìƒˆë¡œìš´ ì‚¬ëŒë“¤ì„ ë§Œë‚˜ê¸° ì–´ë ¤ìš´ ìƒí™©ì¸ê°€ìš”?",
                            "ì™¸ë¡œìš¸ ë•Œ ë³´í†µ ì–´ë–»ê²Œ ì‹œê°„ì„ ë³´ë‚´ì‹œë‚˜ìš”?"
                        ],
                        deep: [
                            "ì˜ë¯¸ ìˆëŠ” ê´€ê³„ë¥¼ ë§Œë“¤ì–´ê°€ëŠ” ê²ƒì— ëŒ€í•´ ì–´ë–»ê²Œ ìƒê°í•˜ì„¸ìš”?",
                            "í˜¼ìë§Œì˜ ì‹œê°„ê³¼ ì™¸ë¡œì›€ì€ ë‹¤ë¥¸ ê²ƒ ê°™ì•„ìš”. ì–´ë–»ê²Œ ëŠë¼ì‹œë‚˜ìš”?",
                            "ì‚¬íšŒì  í™œë™ì´ë‚˜ ëª¨ì„ì— ì°¸ì—¬í•´ë³´ì‹œëŠ” ê±´ ì–´ë–¨ê¹Œìš”?",
                            "ì˜¨ë¼ì¸ì—ì„œë¼ë„ ë¹„ìŠ·í•œ ê´€ì‹¬ì‚¬ë¥¼ ê°€ì§„ ì‚¬ëŒë“¤ê³¼ êµë¥˜í•´ë³´ì…¨ë‚˜ìš”?",
                            "ì „ë¬¸ ìƒë‹´ì„ í†µí•´ ê´€ê³„ í˜•ì„±ì— ëŒ€í•´ ë„ì›€ë°›ì•„ë³´ì‹œëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”?"
                        ]
                    },
                    self_esteem: {
                        opening: [
                            "ìì‹ ì— ëŒ€í•´ ë¶€ì •ì ìœ¼ë¡œ ìƒê°í•˜ê³  ê³„ì‹œëŠ” ê²ƒ ê°™ì•„ìš”. ë§ˆìŒì´ ë§ì´ ì•„í”„ì‹œê² ì–´ìš”.",
                            "ìì¡´ê°ì´ ë§ì´ ë‚®ì•„ì ¸ ìˆëŠ” ìƒíƒœì¸ ê²ƒ ê°™ì•„ìš”. ìŠ¤ìŠ¤ë¡œë¥¼ í˜ë“¤ê²Œ í•˜ê³  ê³„ì‹œëŠ”êµ°ìš”.",
                            "ìì‹ ì„ ë„ˆë¬´ í˜¹ë…í•˜ê²Œ ëŒ€í•˜ê³  ê³„ì‹œëŠ” ê²ƒ ê°™ì•„ìš”. ì¡°ê¸ˆ ë” ë”°ëœ»í•˜ê²Œ ë°”ë¼ë´ì£¼ì„¸ìš”.",
                            "ìê¸° ìì‹ ì— ëŒ€í•œ ì‹ ë¢°ë‚˜ ë¯¿ìŒì´ í”ë“¤ë¦¬ê³  ìˆëŠ” ê²ƒ ê°™ì•„ìš”.",
                            "ë‹¤ë¥¸ ì‚¬ëŒë“¤ê³¼ ë¹„êµí•˜ë©° ìŠ¤ìŠ¤ë¡œë¥¼ í‰ê°€ì ˆí•˜í•˜ê³  ê³„ì‹œëŠ” ê²ƒ ê°™ì•„ìš”."
                        ],
                        middle: [
                            "ì–¸ì œë¶€í„° ìì‹ ì— ëŒ€í•´ ì´ë ‡ê²Œ ë¶€ì •ì ìœ¼ë¡œ ìƒê°í•˜ê²Œ ë˜ì…¨ë‚˜ìš”?",
                            "íŠ¹ë³„í•œ ì‚¬ê±´ì´ë‚˜ ê²½í—˜ì´ ìì¡´ê°ì— ì˜í–¥ì„ ë¯¸ì³¤ë‚˜ìš”?",
                            "ìì‹ ì˜ ì¥ì ì´ë‚˜ ì˜í•˜ëŠ” ê²ƒë“¤ì„ ì¸ì •í•˜ê¸° ì–´ë ¤ìš°ì‹ ê°€ìš”?",
                            "ë‹¤ë¥¸ ì‚¬ëŒë“¤ì˜ í‰ê°€ë‚˜ ì‹œì„ ì„ ë§ì´ ì˜ì‹í•˜ì‹œë‚˜ìš”?",
                            "ì™„ë²½í•˜ì§€ ì•Šìœ¼ë©´ ê°€ì¹˜ê°€ ì—†ë‹¤ê³  ëŠë¼ì‹œë‚˜ìš”?"
                        ],
                        deep: [
                            "ìì‹ ì—ê²Œ ì¹œêµ¬ì²˜ëŸ¼ ë”°ëœ»í•˜ê²Œ ë§í•´ì£¼ëŠ” ì—°ìŠµì„ í•´ë³´ì‹œëŠ” ê±´ ì–´ë–¨ê¹Œìš”?",
                            "ì‘ì€ ì„±ì·¨ë‚˜ ë…¸ë ¥ë“¤ë„ ì¸ì •í•˜ê³  ì¹­ì°¬í•´ì£¼ì‹œë‚˜ìš”?",
                            "ìì¡´ê° íšŒë³µì„ ìœ„í•œ êµ¬ì²´ì ì¸ ë°©ë²•ë“¤ì„ í•¨ê»˜ ì°¾ì•„ë³´ë©´ ì–´ë–¨ê¹Œìš”?",
                            "ìê¸° ìˆ˜ìš©ê³¼ ìê¸° ì‚¬ë‘ì— ëŒ€í•´ ì–´ë–»ê²Œ ìƒê°í•˜ì„¸ìš”?",
                            "ìì¡´ê° í–¥ìƒì„ ìœ„í•œ ì „ë¬¸ì ì¸ ë„ì›€ì„ ë°›ì•„ë³´ì‹œëŠ” ê²ƒë„ ì¢‹ì„ ê²ƒ ê°™ì•„ìš”."
                        ]
                    },
                    fear: {
                        opening: [
                            "ë‘ë ¤ì›€ì´ë‚˜ ê³µí¬ê°ì„ ëŠë¼ê³  ê³„ì‹œëŠ”êµ°ìš”. ê·¸ëŸ° ê°ì •ì´ ì–¼ë§ˆë‚˜ í˜ë“ ì§€ ì•Œì•„ìš”.",
                            "ë¬´ì„œìš´ ë§ˆìŒì´ í¬ê²Œ ë‹¤ê°€ì˜¤ê³  ìˆëŠ” ê²ƒ ê°™ì•„ìš”. ë¶ˆì•ˆí•˜ê³  ë–¨ë¦¬ì‹œê² ì–´ìš”.",
                            "ë¯¸ì§€ì˜ ê²ƒë“¤ì— ëŒ€í•œ ë‘ë ¤ì›€ì´ ìˆìœ¼ì‹  ê²ƒ ê°™ì•„ìš”. ìì—°ìŠ¤ëŸ¬ìš´ ë°˜ì‘ì´ì—ìš”.",
                            "ì–´ë–¤ ìƒí™©ì´ë‚˜ ê²°ê³¼ì— ëŒ€í•œ ê³µí¬ê°ì´ ëŠê»´ì§€ì‹œëŠ”êµ°ìš”.",
                            "ê±±ì •ê³¼ ë‘ë ¤ì›€ì´ ì¼ìƒì„ ì§€ë°°í•˜ê³  ìˆëŠ” ê²ƒ ê°™ì•„ìš”."
                        ],
                        middle: [
                            "êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–¤ ê²ƒì´ ê°€ì¥ ë‘ë ¤ìš°ì‹ ê°€ìš”?",
                            "ì´ëŸ° ë‘ë ¤ì›€ì´ ì–¸ì œë¶€í„° ì‹œì‘ë˜ì—ˆë‚˜ìš”?",
                            "ë‘ë ¤ìš´ ìƒí™©ì„ í”¼í•˜ê²Œ ë˜ì‹œë‚˜ìš”?",
                            "ë‘ë ¤ì›€ ë•Œë¬¸ì— í•˜ì§€ ëª»í•˜ëŠ” ì¼ë“¤ì´ ìˆë‚˜ìš”?",
                            "ê³¼ê±°ì— ë¹„ìŠ·í•œ ê²½í—˜ì´ ìˆìœ¼ì…¨ë‚˜ìš”?"
                        ],
                        deep: [
                            "ì´ ë‘ë ¤ì›€ì´ ì‹¤ì œë¡œ ì¼ì–´ë‚  ê°€ëŠ¥ì„±ì€ ì–¼ë§ˆë‚˜ ë ê¹Œìš”?",
                            "ë‘ë ¤ì›€ì„ ê·¹ë³µí•˜ê¸° ìœ„í•´ ì‹œë„í•´ë³¼ ìˆ˜ ìˆëŠ” ì‘ì€ ë‹¨ê³„ë“¤ì´ ìˆì„ê¹Œìš”?",
                            "ìš©ê¸°ë¥¼ ë‚´ì„œ ë‘ë ¤ì›€ê³¼ ë§ˆì£¼í•´ë³¸ ê²½í—˜ì´ ìˆë‚˜ìš”?",
                            "ë‘ë ¤ì›€ ê´€ë¦¬ì— ëŒ€í•œ ì „ë¬¸ì ì¸ ë„ì›€ì´ í•„ìš”í•  ê²ƒ ê°™ì•„ìš”.",
                            "ì ì§„ì ì¸ ë…¸ì¶œì´ë‚˜ ì¸ì§€ì¹˜ë£Œê°€ ë„ì›€ì´ ë  ìˆ˜ ìˆì–´ìš”."
                        ]
                    },
                    general: {
                        opening: [
                            "ì§€ê¸ˆ ë§ˆìŒì´ ì–´ë– ì‹ ì§€ ì˜ ë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤. í¸í•˜ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”.",
                            "í˜„ì¬ ìƒí™©ì´ ì‰½ì§€ ì•Šìœ¼ì‹  ê²ƒ ê°™ì•„ìš”. ì–´ë–¤ ë¶€ë¶„ì´ ê°€ì¥ í˜ë“œì‹ ê°€ìš”?",
                            "ë§ì”€í•´ì£¼ì‹  ë‚´ìš©ì„ í†µí•´ ë§ì€ ê³ ë¯¼ì´ ìˆìœ¼ì‹œë‹¤ëŠ” ê±¸ ëŠë‚„ ìˆ˜ ìˆì–´ìš”.",
                            "ì§€ê¸ˆ ëŠë¼ì‹œëŠ” ê°ì •ë“¤ì´ ë³µì¡í•˜ì‹¤ ê²ƒ ê°™ì•„ìš”. í•˜ë‚˜ì”© í’€ì–´ê°€ë³´ì£ .",
                            "ì´ë ‡ê²Œ ì†”ì§í•˜ê²Œ ì´ì•¼ê¸°í•´ì£¼ì…”ì„œ ê°ì‚¬í•´ìš”. í•¨ê»˜ ìƒê°í•´ë³´ê² ìŠµë‹ˆë‹¤."
                        ],
                        middle: [
                            "ì´ëŸ° ìƒí™©ì—ì„œ ê°€ì¥ ìš°ì„ ì ìœ¼ë¡œ í•´ê²°í•˜ê³  ì‹¶ì€ ê²ƒì´ ìˆë‚˜ìš”?",
                            "ë¹„ìŠ·í•œ ì–´ë ¤ì›€ì„ ê²ªì–´ë³¸ ì ì´ ìˆìœ¼ì‹ ê°€ìš”? ê·¸ë•ŒëŠ” ì–´ë–»ê²Œ í•´ê²°í•˜ì…¨ë‚˜ìš”?",
                            "ì£¼ë³€ì—ì„œ ë„ì›€ì„ ë°›ì„ ìˆ˜ ìˆëŠ” ì‚¬ëŒì´ ìˆë‚˜ìš”?",
                            "ì´ ë¬¸ì œê°€ ì¼ìƒìƒí™œì— ì–´ë–¤ ì˜í–¥ì„ ë¯¸ì¹˜ê³  ìˆë‚˜ìš”?",
                            "ë³€í™”ë¥¼ ìœ„í•´ ì–´ë–¤ ë…¸ë ¥ë“¤ì„ í•´ë³´ì…¨ë‚˜ìš”?"
                        ],
                        deep: [
                            "ì§€ê¸ˆê¹Œì§€ì˜ ëŒ€í™”ë¥¼ í†µí•´ ì–´ë–¤ í†µì°°ì´ë‚˜ ê¹¨ë‹¬ìŒì´ ìˆìœ¼ì…¨ë‚˜ìš”?",
                            "ì•ìœ¼ë¡œ ì–´ë–¤ ë°©í–¥ìœ¼ë¡œ ë‚˜ì•„ê°€ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?",
                            "ì „ë¬¸ì ì¸ ë„ì›€ì´ í•„ìš”í•œ ë¶€ë¶„ì´ ìˆë‹¤ê³  ìƒê°í•˜ì„¸ìš”?",
                            "ì§€ê¸ˆ ê°€ì¥ í•„ìš”í•œ ê²ƒì´ ë¬´ì—‡ì´ë¼ê³  ìƒê°í•˜ì‹œë‚˜ìš”?",
                            "ì‘ì€ ë³€í™”ë¶€í„° ì‹œì‘í•´ë³¼ ìˆ˜ ìˆëŠ” ê²ƒë“¤ì´ ìˆì„ê¹Œìš”?"
                        ]
                    }
                };

                // ìƒí™©ë³„ íŠ¹ìˆ˜ ì‘ë‹µ íŒ¨í„´
                const situationalResponses = {
                    crisis: [
                        "ì§€ê¸ˆ ì •ë§ í˜ë“  ìˆœê°„ì„ ë³´ë‚´ê³  ê³„ì‹œëŠ”êµ°ìš”. ì´ëŸ° ê°ì •ì„ ëŠë¼ëŠ” ê²ƒ ìì²´ê°€ ìš©ê¸° ìˆëŠ” ì¼ì´ì—ìš”.",
                        "ê·¹ë„ë¡œ ì–´ë ¤ìš´ ìƒí™©ì— ê³„ì‹œëŠ” ê²ƒ ê°™ì•„ìš”. í˜¼ìì„œ ê²¬ëŒë‚´ë ¤ í•˜ì§€ ë§ˆì‹œê³  ë„ì›€ì„ ìš”ì²­í•˜ì„¸ìš”.",
                        "ì´ëŸ° ê³ í†µìŠ¤ëŸ¬ìš´ ê°ì •ë“¤ì´ ì˜ì›íˆ ì§€ì†ë˜ì§€ëŠ” ì•Šì„ ê±°ì˜ˆìš”. ì§€ê¸ˆì€ ì•ˆì „ì´ ê°€ì¥ ì¤‘ìš”í•´ìš”."
                    ],
                    improvement: [
                        "ì¡°ê¸ˆì”© ë‚˜ì•„ì§€ê³  ê³„ì‹œëŠ” ê²ƒ ê°™ì•„ì„œ ë‹¤í–‰ì´ì—ìš”. ê·¸ ë³€í™”ë¥¼ ì¸ì •í•´ì£¼ì„¸ìš”.",
                        "ê¸ì •ì ì¸ ë³€í™”ê°€ ëŠê»´ì ¸ìš”. ì§€ê¸ˆê¹Œì§€ì˜ ë…¸ë ¥ë“¤ì´ ê²°ì‹¤ì„ ë§ºê³  ìˆëŠ” ê²ƒ ê°™ì•„ìš”.",
                        "íšŒë³µì˜ ì¡°ì§ì´ ë³´ì—¬ì„œ ì •ë§ ê¸°ì©ë‹ˆë‹¤. ê³„ì† ì´ ë°©í–¥ìœ¼ë¡œ ë‚˜ì•„ê°€ì‹œë©´ ë  ê²ƒ ê°™ì•„ìš”."
                    ],
                    confusion: [
                        "ì§€ê¸ˆ ë§ˆìŒì´ ë§ì´ ë³µì¡í•˜ê³  í˜¼ë€ìŠ¤ëŸ¬ìš°ì‹  ê²ƒ ê°™ì•„ìš”. ê·¸ëŸ° ê°ì •ë„ ìì—°ìŠ¤ëŸ¬ì›Œìš”.",
                        "ì—¬ëŸ¬ ê°ì •ì´ ë’¤ì—‰ì¼œ ìˆì–´ì„œ ì •ë¦¬ê°€ ì•ˆ ë˜ì‹œëŠ” ê²ƒ ê°™ì•„ìš”. ì²œì²œíˆ í•˜ë‚˜ì”© í’€ì–´ë³´ì£ .",
                        "í˜¼ë€ìŠ¤ëŸ¬ìš´ ë§ˆìŒì´ ëŠê»´ì ¸ìš”. ì§€ê¸ˆì€ ëª…í™•í•œ ë‹µì„ ì°¾ìœ¼ë ¤ í•˜ì§€ ë§ˆì‹œê³  ê·¸ ê°ì •ì„ ì¸ì •í•´ì£¼ì„¸ìš”."
                    ]
                };

                // ëŒ€í™” ë§¥ë½ ê¸°ë°˜ ì‘ë‹µ ì¡°ì ˆ
                const contextualFactors = this.analyzeConversationContext(userMessage, conversationCount);
                
                // ì£¼ìš” ê°ì • ì¹´í…Œê³ ë¦¬ ê²°ì •
                const dominantCategory = this.getDominantEmotionCategory(keywords);
                
                // ì‘ë‹µ ì„ íƒ ë¡œì§
                let selectedResponse = this.selectContextualResponse(
                    dominantCategory, 
                    conversationPhase, 
                    contextualFactors, 
                    responses, 
                    situationalResponses
                );

                // ê°œì¸í™”ëœ í›„ì† ì§ˆë¬¸ ìƒì„±
                const followUpQuestion = this.generateContextualFollowUp(
                    dominantCategory, 
                    conversationPhase, 
                    contextualFactors,
                    conversationCount
                );

                // ê²©ë ¤ë‚˜ ì§€ì§€ ë©”ì‹œì§€ ì¶”ê°€ (ê²½ìš°ì— ë”°ë¼)
                const supportMessage = this.generateSupportMessage(contextualFactors, conversationCount);

                // ìµœì¢… ì‘ë‹µ êµ¬ì„±
                let finalResponse = selectedResponse;
                if (followUpQuestion) {
                    finalResponse += " " + followUpQuestion;
                }
                if (supportMessage && Math.random() > 0.7) { // 30% í™•ë¥ ë¡œ ì§€ì§€ ë©”ì‹œì§€ ì¶”ê°€
                    finalResponse += " " + supportMessage;
                }

                return finalResponse;
            }

            /**
             * ëŒ€í™” ë‹¨ê³„ ê²°ì •
             */
            determineConversationPhase(conversationCount) {
                if (conversationCount <= 2) return 'opening';
                else if (conversationCount <= 6) return 'middle';
                else return 'deep';
            }

            /**
             * ì£¼ìš” ê°ì • ì¹´í…Œê³ ë¦¬ ê²°ì •
             */
            getDominantEmotionCategory(keywords) {
                if (Object.keys(keywords).length === 0) return 'general';
                
                // í‚¤ì›Œë“œ ë¹ˆë„ì— ë”°ë¥¸ ê°€ì¤‘ì¹˜ ê³„ì‚°
                const categoryWeights = {};
                Object.entries(keywords).forEach(([category, words]) => {
                    categoryWeights[category] = words.length;
                });

                // ê°€ì¥ ë†’ì€ ê°€ì¤‘ì¹˜ë¥¼ ê°€ì§„ ì¹´í…Œê³ ë¦¬ ë°˜í™˜
                return Object.entries(categoryWeights)
                    .sort((a, b) => b[1] - a[1])[0][0];
            }

            /**
             * ëŒ€í™” ë§¥ë½ ë¶„ì„
             */
            analyzeConversationContext(userMessage, conversationCount) {
                const context = {
                    intensity: this.analyzeEmotionalIntensity(userMessage),
                    urgency: this.detectUrgency(userMessage),
                    progress: this.detectProgress(userMessage),
                    confusion: this.detectConfusion(userMessage),
                    repetition: this.detectRepetition(userMessage, conversationCount),
                    length: userMessage.length > 100 ? 'long' : userMessage.length > 30 ? 'medium' : 'short'
                };
                return context;
            }

            /**
             * ê°ì • ê°•ë„ ë¶„ì„
             */
            analyzeEmotionalIntensity(message) {
                const highIntensityWords = [
                    'ì •ë§', 'ë„ˆë¬´', 'ë§¤ìš°', 'ì™„ì „íˆ', 'ê·¹ë„ë¡œ', 'ì‹¬ê°í•˜ê²Œ', 'ì ˆëŒ€', 'ì „í˜€',
                    'ì£½ì„ê²ƒê°™', 'ë¯¸ì¹˜ê² ', 'ê²¬ë”œìˆ˜ì—†', 'í•œê³„', 'ìµœì•…', 'ë', 'ì ˆë§ì ',
                    '!!!', '!!', '...', 'ã… ã… ', 'ã…œã…œ', 'ì§„ì§œ', 'ë ˆì•Œ'
                ];
                
                const messageLower = message.toLowerCase();
                const intensityScore = highIntensityWords.reduce((score, word) => {
                    return score + (messageLower.includes(word) ? 1 : 0);
                }, 0);
                
                if (intensityScore >= 3) return 'high';
                else if (intensityScore >= 1) return 'medium';
                else return 'low';
            }

            /**
             * ê¸´ê¸‰ì„± ê°ì§€
             */
            detectUrgency(message) {
                const urgencyKeywords = [
                    'ì§€ê¸ˆë‹¹ì¥', 'ì¦‰ì‹œ', 'ë¹¨ë¦¬', 'ê¸‰í•˜ê²Œ', 'ì‘ê¸‰', 'ìœ„ê¸‰', 'ìœ„í—˜',
                    'ì£½ê³ ì‹¶', 'ìí•´', 'ìì‚´', 'ëë‚´ê³ ì‹¶', 'ë”ì´ìƒëª»', 'í•œê³„'
                ];
                
                return urgencyKeywords.some(keyword => 
                    message.toLowerCase().includes(keyword)
                );
            }

            /**
             * ì§„ì „/ê°œì„  ê°ì§€
             */
            detectProgress(message) {
                const progressKeywords = [
                    'ë‚˜ì•„ì§€', 'ì¢‹ì•„ì§€', 'ê°œì„ ', 'íšŒë³µ', 'ê·¹ë³µ', 'í•´ê²°', 'ì„±ê³µ',
                    'ë°œì „', 'ì„±ì¥', 'ë³€í™”', 'í¬ë§', 'ê¸ì •ì ', 'ë‹¤í–‰', 'ê¸°ì˜'
                ];
                
                return progressKeywords.some(keyword => 
                    message.toLowerCase().includes(keyword)
                );
            }

            /**
             * í˜¼ë€ ìƒíƒœ ê°ì§€
             */
            detectConfusion(message) {
                const confusionKeywords = [
                    'ëª¨ë¥´ê² ', 'í—·ê°ˆ', 'í˜¼ë€', 'ë³µì¡', 'ì• ë§¤', 'ë¶ˆë¶„ëª…', 'í™•ì‹¤í•˜ì§€ì•Š',
                    'ì–´ë–»ê²Œí•´ì•¼', 'ë­˜í•´ì•¼', 'ì–´ë””ì„œë¶€í„°', 'ë¬´ì—‡ë¶€í„°', 'ê°ˆí”¼ëª»ì¡'
                ];
                
                return confusionKeywords.some(keyword => 
                    message.toLowerCase().includes(keyword)
                );
            }

            /**
             * ë°˜ë³µ íŒ¨í„´ ê°ì§€
             */
            detectRepetition(message, conversationCount) {
                if (conversationCount < 3) return false;
                
                // ìµœê·¼ ëŒ€í™”ì—ì„œ ë¹„ìŠ·í•œ ì£¼ì œë‚˜ í‚¤ì›Œë“œê°€ ë°˜ë³µë˜ëŠ”ì§€ í™•ì¸
                const recentHistory = this.conversationState.conversationHistory.slice(-3);
                const currentKeywords = this.extractKeywords(message);
                
                return recentHistory.some(conv => {
                    const prevKeywords = conv.keywords || {};
                    return Object.keys(currentKeywords).some(category => 
                        prevKeywords.hasOwnProperty(category)
                    );
                });
            }

            /**
             * ë§¥ë½ì— ë§ëŠ” ì‘ë‹µ ì„ íƒ
             */
            selectContextualResponse(category, phase, context, responses, situationalResponses) {
                // ìœ„ê¸° ìƒí™© ìš°ì„  ì²˜ë¦¬
                if (context.urgency) {
                    return this.getRandomResponse(situationalResponses.crisis);
                }
                
                // ì§„ì „ì´ ìˆëŠ” ê²½ìš°
                if (context.progress) {
                    return this.getRandomResponse(situationalResponses.improvement);
                }
                
                // í˜¼ë€ ìƒíƒœì¸ ê²½ìš°
                if (context.confusion) {
                    return this.getRandomResponse(situationalResponses.confusion);
                }
                
                // ì¼ë°˜ì ì¸ ê²½ìš° - ì¹´í…Œê³ ë¦¬ì™€ ë‹¨ê³„ì— ë”°ë¥¸ ì‘ë‹µ
                const categoryResponses = responses[category] || responses.general;
                const phaseResponses = categoryResponses[phase] || categoryResponses.opening;
                
                return this.getRandomResponse(phaseResponses);
            }

            /**
             * ë§¥ë½ì— ë§ëŠ” í›„ì† ì§ˆë¬¸ ìƒì„±
             */
            generateContextualFollowUp(category, phase, context, conversationCount) {
                // ë°˜ë³µë˜ëŠ” ëŒ€í™”ì—ì„œëŠ” ë‹¤ë¥¸ ì ‘ê·¼
                if (context.repetition) {
                    const alternativeQuestions = [
                        "ë‹¤ë¥¸ ê´€ì ì—ì„œ ì´ ë¬¸ì œë¥¼ ë°”ë¼ë³¼ ìˆ˜ ìˆì„ê¹Œìš”?",
                        "ì´ ì£¼ì œì— ëŒ€í•´ ê³„ì† ì´ì•¼ê¸°í•˜ê³  ì‹¶ìœ¼ì‹  ì´ìœ ê°€ ìˆì„ê¹Œìš”?",
                        "í˜¹ì‹œ ì•„ì§ ë§ì”€í•˜ì§€ ì•Šìœ¼ì‹  ì¤‘ìš”í•œ ë¶€ë¶„ì´ ìˆë‚˜ìš”?",
                        "ìƒˆë¡œìš´ ì‹œê°ìœ¼ë¡œ ì ‘ê·¼í•´ë³´ë©´ ì–´ë–¨ê¹Œìš”?"
                    ];
                    return this.getRandomResponse(alternativeQuestions);
                }

                // ê°•ë„ê°€ ë†’ì€ ê°ì • ìƒíƒœ
                if (context.intensity === 'high') {
                    const intensiveQuestions = [
                        "ì§€ê¸ˆ ê°€ì¥ ê¸‰í•˜ê²Œ í•´ê²°í•´ì•¼ í•  ê²ƒì´ ë¬´ì—‡ì¼ê¹Œìš”?",
                        "ì´ëŸ° ê°•í•œ ê°ì •ì„ ëŠë¼ê²Œ ëœ êµ¬ì²´ì ì¸ ìƒí™©ì´ ìˆë‚˜ìš”?",
                        "ì§€ê¸ˆ ë‹¹ì¥ í•„ìš”í•œ ì§€ì›ì´ë‚˜ ë„ì›€ì´ ìˆì„ê¹Œìš”?",
                        "ì´ ê°ì •ì˜ ê°•ë„ê°€ 10ì  ë§Œì ì— ëª‡ ì  ì •ë„ì¸ê°€ìš”?"
                    ];
                    return this.getRandomResponse(intensiveQuestions);
                }

                // ëŒ€í™” ë‹¨ê³„ë³„ ë§ì¶¤ ì§ˆë¬¸
                const phaseQuestions = {
                    opening: [
                        "ì´ëŸ° ìƒí™©ì´ ì–¼ë§ˆë‚˜ ì§€ì†ë˜ì—ˆë‚˜ìš”?",
                        "ì–¸ì œë¶€í„° ì´ëŸ° ê°ì •ì„ ëŠë¼ê¸° ì‹œì‘í•˜ì…¨ë‚˜ìš”?",
                        "ê°€ì¥ í˜ë“  ë¶€ë¶„ì´ ì–´ë–¤ ê²ƒì¸ê°€ìš”?",
                        "í‰ì†Œì™€ ë‹¤ë¥¸ ì ì´ ìˆë‹¤ë©´ ë¬´ì—‡ì¸ê°€ìš”?"
                    ],
                    middle: [
                        "ì´ ë¬¸ì œê°€ ì¼ìƒìƒí™œì— ì–´ë–¤ ì˜í–¥ì„ ë¯¸ì¹˜ê³  ìˆë‚˜ìš”?",
                        "ë¹„ìŠ·í•œ ê²½í—˜ì„ í•´ë³¸ ì ì´ ìˆìœ¼ì‹ ê°€ìš”?",
                        "ì£¼ë³€ ì‚¬ëŒë“¤ì€ ì´ ìƒí™©ì„ ì•Œê³  ìˆë‚˜ìš”?",
                        "ì–´ë–¤ ë¶€ë¶„ì—ì„œ ë³€í™”ê°€ í•„ìš”í•˜ë‹¤ê³  ìƒê°í•˜ì„¸ìš”?"
                    ],
                    deep: [
                        "ì§€ê¸ˆê¹Œì§€ ëŒ€í™”ë¥¼ í†µí•´ ìƒˆë¡­ê²Œ ê¹¨ë‹¬ì€ ê²ƒì´ ìˆë‚˜ìš”?",
                        "ì•ìœ¼ë¡œ ì–´ë–¤ ë°©í–¥ìœ¼ë¡œ ë‚˜ì•„ê°€ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?",
                        "ì´ ê²½í—˜ì„ í†µí•´ ë°°ìš´ ê²ƒì´ ìˆë‹¤ë©´ ë¬´ì—‡ì¸ê°€ìš”?",
                        "ë‹¤ìŒ ë‹¨ê³„ë¡œ ë¬´ì—‡ì„ ì‹œë„í•´ë³´ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?"
                    ]
                };

                return this.getRandomResponse(phaseQuestions[phase]);
            }

            /**
             * ì§€ì§€ ë©”ì‹œì§€ ìƒì„±
             */
            generateSupportMessage(context, conversationCount) {
                const supportMessages = [
                    "ë‹¹ì‹ ì˜ ìš©ê¸°ì— ë°•ìˆ˜ë¥¼ ë³´ë‚´ë“œë¦¬ê³  ì‹¶ì–´ìš”.",
                    "ì´ë ‡ê²Œ ì†”ì§í•˜ê²Œ í‘œí˜„í•´ì£¼ì…”ì„œ ì •ë§ ê°ì‚¬í•©ë‹ˆë‹¤.",
                    "í˜¼ìê°€ ì•„ë‹ˆë¼ëŠ” ê²ƒì„ ê¸°ì–µí•´ì£¼ì„¸ìš”.",
                    "ì§€ê¸ˆê¹Œì§€ ì˜ ê²¬ëŒë‚´ê³  ê³„ì„¸ìš”.",
                    "ë³€í™”ëŠ” ì‹œê°„ì´ ê±¸ë¦¬ì§€ë§Œ ë°˜ë“œì‹œ ê°€ëŠ¥í•´ìš”.",
                    "ë‹¹ì‹ ì˜ ê°ì •ì€ ëª¨ë‘ ì†Œì¤‘í•˜ê³  ì˜ë¯¸ê°€ ìˆì–´ìš”.",
                    "ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ê´œì°®ì•„ìš”. ìˆëŠ” ê·¸ëŒ€ë¡œë„ ì¶©ë¶„íˆ ê°€ì¹˜ ìˆì–´ìš”.",
                    "ì‘ì€ ê±¸ìŒì´ë¼ë„ ì•ìœ¼ë¡œ ë‚˜ì•„ê°€ê³  ê³„ì‹œëŠ” ê±°ì˜ˆìš”."
                ];

                // ëŒ€í™”ê°€ ê¸¸ì–´ì§ˆìˆ˜ë¡ ë” ê°œì¸ì ì¸ ì§€ì§€ ë©”ì‹œì§€
                if (conversationCount > 5) {
                    const deepSupportMessages = [
                        "ì§€ê¸ˆê¹Œì§€ì˜ ëŒ€í™”ë¥¼ í†µí•´ ë‹¹ì‹ ì˜ ì§„ì •ì„±ì´ ëŠê»´ì ¸ìš”.",
                        "ì´ëŸ° ê¹Šì€ ëŒ€í™”ë¥¼ ë‚˜ëˆ„ì–´ì£¼ì…”ì„œ ì˜ê´‘ì…ë‹ˆë‹¤.",
                        "ë‹¹ì‹ ì˜ ì„±ì°°í•˜ëŠ” ëª¨ìŠµì´ ì •ë§ ì¸ìƒì ì´ì—ìš”.",
                        "í•¨ê»˜ ì´ ì—¬ì •ì„ ê±¸ì–´ê°€ê³  ìˆë‹¤ê³  ìƒê°í•´ì£¼ì„¸ìš”."
                    ];
                    return this.getRandomResponse([...supportMessages, ...deepSupportMessages]);
                }

                return this.getRandomResponse(supportMessages);
            }

            /**
             * ëœë¤ ì‘ë‹µ ì„ íƒ (ì¤‘ë³µ ë°©ì§€ ë¡œì§ í¬í•¨)
             */
            getRandomResponse(responseArray) {
                if (!responseArray || responseArray.length === 0) {
                    return "ë§ì”€í•´ì£¼ì‹  ë‚´ìš©ì„ ê¹Šì´ ì´í•´í•˜ë ¤ê³  ë…¸ë ¥í•˜ê³  ìˆì–´ìš”.";
                }

                // ìµœê·¼ ì‚¬ìš©ëœ ì‘ë‹µ ì¶”ì  (ê°„ë‹¨í•œ ì¤‘ë³µ ë°©ì§€)
                if (!this.recentResponses) {
                    this.recentResponses = [];
                }

                // ìµœê·¼ 3ê°œ ì‘ë‹µê³¼ ë‹¤ë¥¸ ê²ƒ ì„ íƒ
                const availableResponses = responseArray.filter(response => 
                    !this.recentResponses.includes(response)
                );
                
                const selectedResponse = availableResponses.length > 0 
                    ? availableResponses[Math.floor(Math.random() * availableResponses.length)]
                    : responseArray[Math.floor(Math.random() * responseArray.length)];

                // ìµœê·¼ ì‘ë‹µ ê¸°ë¡ ì—…ë°ì´íŠ¸
                this.recentResponses.push(selectedResponse);
                if (this.recentResponses.length > 3) {
                    this.recentResponses.shift();
                }

                return selectedResponse;
            }

            /**
             * ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ êµ¬ì„±
             */
            buildSystemPrompt() {
                return `ë‹¹ì‹ ì€ ì „ë¬¸ì ì¸ ì‹¬ë¦¬ìƒë‹´ì‚¬ì…ë‹ˆë‹¤. ë‹¤ìŒ ì§€ì¹¨ì„ ë”°ë¼ì£¼ì„¸ìš”:

1. ê³µê°ì ì´ê³  ë”°ëœ»í•œ í†¤ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”
2. ë‚´ë‹´ìì˜ ê°ì •ì„ ì¸ì •í•˜ê³  ê²€ì¦í•´ì£¼ì„¸ìš”
3. íŒë‹¨í•˜ì§€ ë§ê³  ê²½ì²­í•˜ëŠ” ìì„¸ë¥¼ ìœ ì§€í•˜ì„¸ìš”
4. ì ì ˆí•œ ì§ˆë¬¸ì„ í†µí•´ ë” ê¹Šì€ íƒìƒ‰ì„ ë„ì™€ì£¼ì„¸ìš”
5. ì „ë¬¸ì  ì¹˜ë£Œê°€ í•„ìš”í•˜ë‹¤ê³  íŒë‹¨ë˜ë©´ ê¶Œìœ í•˜ì„¸ìš”
6. ìí•´ë‚˜ ìì‚´ ìœ„í—˜ì´ ê°ì§€ë˜ë©´ ì¦‰ì‹œ ì „ë¬¸ê¸°ê´€ ì—°ë½ì„ ê¶Œí•˜ì„¸ìš”
7. ì‘ë‹µì€ 3-5ë¬¸ì¥ìœ¼ë¡œ ê°„ê²°í•˜ê²Œ ì‘ì„±í•˜ì„¸ìš”

í˜„ì¬ ìƒë‹´ ëª¨ë“œ: ${this.session.mode || 'ëŒ€í™”í˜• ìƒë‹´'}
ì£¼ìš” ê°ì • í…Œë§ˆ: ${Array.from(this.conversationState.emotionalThemes).join(', ') || 'ë¶„ì„ ì¤‘'}`;
            }

            /**
             * ëŒ€í™” ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±
             */
            buildConversationContext() {
                const context = [];
                const recentHistory = this.conversationState.conversationHistory.slice(-6); // ìµœê·¼ 6ê°œ ëŒ€í™”ë§Œ
                
                recentHistory.forEach(conv => {
                    context.push({ role: 'user', content: conv.input });
                    if (conv.response) {
                        context.push({ role: 'assistant', content: conv.response });
                    }
                });
                
                return context;
            }

            /**
             * ìƒë‹´ ëª¨ë“œ ì„ íƒ ì²˜ë¦¬
             */
            selectMode(mode) {
                this.session.mode = mode;
                this.conversationState.phase = 'conversation';
                
                this.welcomeScreen.style.display = 'none';
                
                if (mode === 'conversation') {
                    this.addSystemMessage("ğŸ’¬ ììœ  ëŒ€í™” ìƒë‹´ ëª¨ë“œë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤.");
                    this.addBotMessage(
                        "ì•ˆë…•í•˜ì„¸ìš”! í¸ì•ˆí•œ ë§ˆìŒìœ¼ë¡œ í˜„ì¬ ìƒí™©ì´ë‚˜ ê³ ë¯¼ì„ ììœ ë¡­ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”. " +
                        "í•„ìš”í•˜ë‹¤ë©´ ì–¸ì œë“  í‘œì¤€ ì‹¬ë¦¬ê²€ì‚¬ë¥¼ ì œì•ˆë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                        ["ê¸°ë¶„ì´ ì¢‹ì§€ ì•Šì•„ìš”", "ìš”ì¦˜ í˜ë“  ì¼ì´ ë§ì•„ìš”", "ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë§ì´ ë°›ê³  ìˆì–´ìš”", "ëˆ„êµ°ê°€ì™€ ì´ì•¼ê¸°í•˜ê³  ì‹¶ì–´ìš”"]
                    );
                } else {
                    this.addSystemMessage("ğŸ“‹ í‘œì¤€ ì‹¬ë¦¬ê²€ì‚¬ ëª¨ë“œë¥¼ ì„ íƒí•˜ì…¨ìŠµë‹ˆë‹¤.");
                    this.addBotMessage(
                        "ì–´ë–¤ ë¬¸ì œë¡œ ê²€ì‚¬ë¥¼ ë°›ê³  ì‹¶ìœ¼ì‹ ì§€ ê°„ë‹¨íˆ ë§ì”€í•´ì£¼ì„¸ìš”. " +
                        "ì ì ˆí•œ í‘œì¤€í™”ëœ ì‹¬ë¦¬ê²€ì‚¬ë¥¼ ì¶”ì²œí•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.",
                        ["ìš°ìš¸ê°ì´ ì§€ì†ë˜ê³  ìˆì–´ìš”", "ë¶ˆì•ˆí•˜ê³  ê±±ì •ì´ ë§ì•„ìš”", "ìŠ¤íŠ¸ë ˆìŠ¤ê°€ ì‹¬í•´ìš”", "ì „ë°˜ì ìœ¼ë¡œ í˜ë“¤ì–´ìš”"]
                    );
                }
            }

            /**
             * ë©”ì‹œì§€ ì „ì†¡ ì²˜ë¦¬
             */
            async sendMessage() {
                const message = this.messageInput.value.trim();
                if (!message || this.isTyping) return;

                this.addUserMessage(message);
                this.messageInput.value = '';
                this.messageInput.style.height = 'auto';
                this.sendButton.disabled = true;

                await this.processResponse(message);
                this.sendButton.disabled = false;
            }

            /**
             * ì‘ë‹µ ì²˜ë¦¬ ë° ë‹¤ìŒ ë‹¨ê³„ ê²°ì •
             */
            async processResponse(userInput) {
                // íŠ¹ìˆ˜ ëª…ë ¹ì–´ ì²˜ë¦¬
                if (userInput.toLowerCase().includes('ê²€ì‚¬') || userInput.toLowerCase().includes('í‰ê°€')) {
                    if (this.session.mode === 'conversation') {
                        this.addSystemMessage("ğŸ“‹ í‘œì¤€ ì‹¬ë¦¬ê²€ì‚¬ë¡œ ì „í™˜í•©ë‹ˆë‹¤.");
                        this.session.mode = 'assessment';
                        this.determineAssessmentPath(userInput);
                        return;
                    }
                } else if (userInput.toLowerCase().includes('ë¶„ì„') && this.conversationState.conversationHistory.length > 0) {
                    this.provideConversationAnalysis();
                    return;
                } else if (userInput.toLowerCase().includes('ì¢…ë£Œ')) {
                    this.endConversation();
                    return;
                }

                // ê°ì • ë° í‚¤ì›Œë“œ ë¶„ì„
                const analysis = this.analyzeSentimentAndEmotion(userInput);
                const keywords = this.extractKeywords(userInput);
                
                // ëŒ€í™” ê¸°ë¡ì— ì¶”ê°€
                this.conversationState.conversationHistory.push({
                    input: this.anonymizeText(userInput),
                    analysis: analysis,
                    keywords: keywords,
                    timestamp: new Date().toISOString()
                });

                // ê°ì • í…Œë§ˆ ì—…ë°ì´íŠ¸
                Object.keys(keywords).forEach(theme => {
                    this.conversationState.emotionalThemes.add(theme);
                });

                // íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ
                this.showTypingIndicator();

                try {
                    // AI ì‘ë‹µ ìƒì„±
                    const aiResponse = await this.callAIAPI(userInput);
                    
                    this.removeTypingIndicator();
                    
                    // ì‘ë‹µì„ ëŒ€í™” ê¸°ë¡ì— ì¶”ê°€
                    if (this.conversationState.conversationHistory.length > 0) {
                        this.conversationState.conversationHistory[this.conversationState.conversationHistory.length - 1].response = aiResponse;
                    }
                    
                    this.addBotMessage(aiResponse);
                    
                    // ê°ì • ë¶„ì„ ê²°ê³¼ í‘œì‹œ (í‚¤ì›Œë“œê°€ ê°ì§€ëœ ê²½ìš°)
                    if (Object.keys(keywords).length > 0) {
                        setTimeout(() => {
                            this.showEmotionAnalysis(keywords, analysis);
                        }, 1000);
                    }
                    
                    // ìœ„í—˜ ìƒí™© ê°ì§€
                    this.checkForRiskFactors(userInput, keywords);
                    
                    // ì •ê¸°ì  ë¶„ì„ ì œê³µ (5íšŒë§ˆë‹¤)
                    if (this.conversationState.conversationHistory.length % 5 === 0) {
                        setTimeout(() => {
                            this.addSystemMessage("ğŸ“Š ëŒ€í™” ë¶„ì„ì„ ì œê³µí•©ë‹ˆë‹¤.");
                            this.provideConversationAnalysis();
                        }, 2000);
                    }
                    
                    // ê²€ì‚¬ ì œì•ˆ (íŠ¹ì • í‚¤ì›Œë“œ ë°˜ë³µ ì‹œ)
                    this.suggestAssessmentIfNeeded(keywords);
                    
                } catch (error) {
                    this.removeTypingIndicator();
                    this.addBotMessage("ì£„ì†¡í•©ë‹ˆë‹¤. ì¼ì‹œì ì¸ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë§ì”€í•´ì£¼ì‹œê² ì–´ìš”?");
                    console.error('ì‘ë‹µ ìƒì„± ì˜¤ë¥˜:', error);
                }
            }

            /**
             * ìœ„í—˜ ìš”ì†Œ ê°ì§€ ë° ëŒ€ì‘
             */
            checkForRiskFactors(userInput, keywords) {
                const riskKeywords = ['ì£½ê³ ì‹¶', 'ìì‚´', 'ìí•´', 'ëë‚´ê³ ì‹¶', 'ì‚¬ë¼ì§€ê³ ì‹¶', 'ë”ì´ìƒ', 'í¬ê¸°'];
                const hasRiskKeywords = riskKeywords.some(keyword => userInput.toLowerCase().includes(keyword));
                
                if (hasRiskKeywords) {
                    setTimeout(() => {
                        this.addSystemMessage("ğŸ†˜ ê¸´ê¸‰ ìƒí™© ê°ì§€");
                        this.addBotMessage(
                            "ì§€ê¸ˆ ë§¤ìš° í˜ë“  ìƒí™©ì— ê³„ì‹  ê²ƒ ê°™ìŠµë‹ˆë‹¤. í˜¼ìì„œ ì´ ëª¨ë“  ê²ƒì„ ê°ë‹¹í•˜ì§€ ë§ˆì„¸ìš”. " +
                            "ì „ë¬¸ê°€ì˜ ë„ì›€ì„ ë°›ìœ¼ì‹¤ ê²ƒì„ ê°•ë ¥íˆ ê¶Œí•©ë‹ˆë‹¤.\n\n" +
                            "â€¢ ìƒëª…ì˜ì „í™”: 1393 (24ì‹œê°„)\n" +
                            "â€¢ ì²­ì†Œë…„ì „í™”: 1388\n" +
                            "â€¢ ì •ì‹ ê±´ê°•ìœ„ê¸°ìƒë‹´ì „í™”: 1577-0199\n\n" +
                            "ë‹¹ì‹ ì˜ ìƒëª…ì€ ì†Œì¤‘í•©ë‹ˆë‹¤."
                        );
                    }, 500);
                }
            }

            /**
             * ê²€ì‚¬ ì œì•ˆ ë¡œì§
             */
            suggestAssessmentIfNeeded(keywords) {
                const keywordCounts = {};
                
                // ì§€ê¸ˆê¹Œì§€ì˜ ëŒ€í™”ì—ì„œ í‚¤ì›Œë“œ ë¹ˆë„ ê³„ì‚°
                this.conversationState.conversationHistory.forEach(conv => {
                    Object.keys(conv.keywords).forEach(category => {
                        keywordCounts[category] = (keywordCounts[category] || 0) + 1;
                    });
                });
                
                // íŠ¹ì • í‚¤ì›Œë“œê°€ 3íšŒ ì´ìƒ ë‚˜íƒ€ë‚˜ë©´ ê²€ì‚¬ ì œì•ˆ
                Object.entries(keywordCounts).forEach(([category, count]) => {
                    if (count >= 3 && this.session.mode === 'conversation') {
                        setTimeout(() => {
                            let assessmentName = '';
                            let assessmentType = '';
                            
                            if (category === 'depression') {
                                assessmentName = 'PHQ-9 ìš°ìš¸ì¦ ì„ ë³„ê²€ì‚¬';
                                assessmentType = 'phq9';
                            } else if (category === 'anxiety') {
                                assessmentName = 'GAD-7 ë¶ˆì•ˆì¥ì•  ì„ ë³„ê²€ì‚¬';
                                assessmentType = 'gad7';
                            } else if (category === 'stress') {
                                assessmentName = 'ì§€ê°ëœ ìŠ¤íŠ¸ë ˆìŠ¤ ì²™ë„(PSS)';
                                assessmentType = 'stress';
                            }
                            
                            if (assessmentName) {
                                this.addBotMessage(
                                    `ëŒ€í™”ë¥¼ í†µí•´ ${category === 'depression' ? 'ìš°ìš¸ê°' : category === 'anxiety' ? 'ë¶ˆì•ˆê°' : 'ìŠ¤íŠ¸ë ˆìŠ¤'} ê´€ë ¨ ë‚´ìš©ì´ ì§€ì†ì ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ê³  ìˆìŠµë‹ˆë‹¤. ` +
                                    `ë³´ë‹¤ ì •í™•í•œ í‰ê°€ë¥¼ ìœ„í•´ ${assessmentName}ë¥¼ ë°›ì•„ë³´ì‹œëŠ” ê²ƒì€ ì–´ë–¨ê¹Œìš”?`,
                                    ["ë„¤, ê²€ì‚¬ë¥¼ ë°›ì•„ë³´ê² ìŠµë‹ˆë‹¤", "ì•„ë‹ˆìš”, ëŒ€í™”ë¥¼ ê³„ì†í•˜ê² ìŠµë‹ˆë‹¤", "ë‚˜ì¤‘ì— ë°›ì•„ë³´ê² ìŠµë‹ˆë‹¤"]
                                );
                            }
                        }, 1500);
                    }
                });
            }

            /**
             * í‰ê°€ ê²½ë¡œ ê²°ì •
             */
            determineAssessmentPath(userInput) {
                const userLower = userInput.toLowerCase();
                
                if (this.keywordPatterns.depression.some(keyword => userLower.includes(keyword))) {
                    this.conversationState.currentAssessmentType = 'phq9';
                    this.addSystemMessage("ğŸ” ìš°ìš¸ê°ê³¼ ê´€ë ¨ëœ ë‚´ìš©ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.");
                } else if (this.keywordPatterns.anxiety.some(keyword => userLower.includes(keyword))) {
                    this.conversationState.currentAssessmentType = 'gad7';
                    this.addSystemMessage("ğŸ” ë¶ˆì•ˆê°ê³¼ ê´€ë ¨ëœ ë‚´ìš©ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.");
                } else {
                    this.conversationState.currentAssessmentType = 'stress';
                    this.addSystemMessage("ğŸ” ì „ë°˜ì ì¸ ìŠ¤íŠ¸ë ˆìŠ¤ í‰ê°€ë¥¼ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤.");
                }

                const assessmentName = this.assessmentData[this.conversationState.currentAssessmentType].name;
                this.addBotMessage(`${assessmentName}ë¥¼ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤. ê° ì§ˆë¬¸ì— ì†”ì§í•˜ê²Œ ë‹µë³€í•´ì£¼ì„¸ìš”.`);

                this.conversationState.phase = 'assessment';
                this.conversationState.currentQuestionIndex = 0;
                this.session.scores[this.conversationState.currentAssessmentType] = [];
                
                setTimeout(() => this.askNextAssessmentQuestion(), 1000);
            }

            /**
             * ë‹¤ìŒ í‰ê°€ ì§ˆë¬¸ ì œì‹œ
             */
            askNextAssessmentQuestion() {
                const assessmentType = this.conversationState.currentAssessmentType;
                const questions = this.assessmentData[assessmentType].questions;
                const currentIndex = this.conversationState.currentQuestionIndex;
                
                if (currentIndex < questions.length) {
                    this.addAssessmentQuestion(
                        questions[currentIndex],
                        currentIndex + 1,
                        questions.length,
                        this.assessmentData[assessmentType].name
                    );
                } else {
                    this.conversationState.phase = 'summary';
                    setTimeout(() => this.provideSummaryAndRecommendations(), 1000);
                }
            }

            /**
             * í‰ê°€ ì§ˆë¬¸ UI ìƒì„±
             */
            addAssessmentQuestion(question, currentNum, totalNum, assessmentName) {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'message bot';
                
                questionDiv.innerHTML = `
                    <div class="avatar bot-avatar">ğŸ“‹</div>
                    <div class="message-bubble">
                        <div class="assessment-card">
                            <div class="assessment-header">
                                <div class="question-number">${currentNum}/${totalNum}</div>
                                <div class="assessment-type">${assessmentName}</div>
                            </div>
                            <div class="question-text">${question}</div>
                            <div class="rating-scale">
                                ${Object.entries(this.scaleDescriptions).map(([score, desc]) => `
                                    <div class="rating-option" onclick="chatbot.selectRating(${score})">
                                        <span class="rating-number">${score}</span>
                                        <span>${desc}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                
                this.chatContainer.appendChild(questionDiv);
                this.scrollToBottom();
            }

            /**
             * í‰ê°€ ì ìˆ˜ ì„ íƒ ì²˜ë¦¬
             */
            selectRating(score) {
                const currentQuestionCard = event.target.closest('.assessment-card');
                if (!currentQuestionCard || currentQuestionCard.classList.contains('completed')) {
                    return;
                }
                
                const options = currentQuestionCard.querySelectorAll('.rating-option');
                
                options.forEach(option => option.classList.remove('selected'));
                event.target.closest('.rating-option').classList.add('selected');
                
                this.conversationState.selectedRating = score;
                
                currentQuestionCard.classList.add('completed');
                options.forEach(option => {
                    option.style.pointerEvents = 'none';
                    option.style.opacity = '0.6';
                });
                
                event.target.closest('.rating-option').style.opacity = '1';
                
                setTimeout(() => {
                    this.handleAssessmentResponse(score.toString(), null);
                }, 500);
            }

            /**
             * í‰ê°€ ì‘ë‹µ ì²˜ë¦¬
             */
            handleAssessmentResponse(userInput, analysis) {
                const score = parseInt(userInput);
                if (isNaN(score) || score < 0 || score > 3) {
                    this.addBotMessage("âŒ 0-3 ì‚¬ì´ì˜ ì ìˆ˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.");
                    return;
                }

                const assessmentType = this.conversationState.currentAssessmentType;
                this.session.scores[assessmentType].push(score);
                
                this.conversationState.currentQuestionIndex++;
                setTimeout(() => this.askNextAssessmentQuestion(), 500);
            }

            /**
             * ê°œì¸ì •ë³´ ìµëª…í™” ì²˜ë¦¬
             */
            anonymizeText(text) {
                const patterns = [
                    { regex: /\b[ê°€-í£]{2,4}\b(?=\s*(?:ë‹˜|ì”¨|ì´|ê°€|ì€|ëŠ”))/g, replacement: '[ì´ë¦„]' },
                    { regex: /\b\d{2,3}-\d{3,4}-\d{4}\b/g, replacement: '[ì „í™”ë²ˆí˜¸]' },
                    { regex: /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g, replacement: '[ì´ë©”ì¼]' },
                    { regex: /\b\d{6}-\d{7}\b/g, replacement: '[ì£¼ë¯¼ë²ˆí˜¸]' }
                ];

                let anonymized = text;
                patterns.forEach(pattern => {
                    anonymized = anonymized.replace(pattern.regex, pattern.replacement);
                });
                return anonymized;
            }

            /**
             * ê°ì • ë° ìƒí™© ë¶„ì„
             */
            analyzeSentimentAndEmotion(text) {
                const analysis = {
                    sentiment: this.analyzeSentiment(text),
                    emotions: this.analyzeEmotions(text),
                    confidence: Math.random() * 0.3 + 0.7
                };
                return analysis;
            }

            /**
             * ê°ì • ì ìˆ˜ ë¶„ì„
             */
            analyzeSentiment(text) {
                const positiveWords = ["ì¢‹", "í–‰ë³µ", "ê¸°ì¨", "ë§Œì¡±", "ì¦ê±°", "í¸ì•ˆ", "í¬ë§", "ì‚¬ë‘"];
                const negativeWords = ["ë‚˜ì˜", "ìŠ¬í”„", "í™”ë‚˜", "ìš°ìš¸", "ë¶ˆì•ˆ", "ê±±ì •", "í˜ë“¤", "ê´´ë¡œ"];
                
                let positiveScore = 0;
                let negativeScore = 0;
                
                const textLower = text.toLowerCase();
                positiveWords.forEach(word => {
                    if (textLower.includes(word)) positiveScore++;
                });
                negativeWords.forEach(word => {
                    if (textLower.includes(word)) negativeScore++;
                });
                
                if (positiveScore > negativeScore) return 'positive';
                else if (negativeScore > positiveScore) return 'negative';
                else return 'neutral';
            }

            /**
             * ì„¸ë¶€ ê°ì • ë¶„ì„
             */
            analyzeEmotions(text) {
                const emotions = {};
                const textLower = text.toLowerCase();
                
                Object.entries(this.keywordPatterns).forEach(([emotion, keywords]) => {
                    let score = 0;
                    keywords.forEach(keyword => {
                        if (textLower.includes(keyword)) score++;
                    });
                    if (score > 0) {
                        emotions[emotion] = Math.min(score / keywords.length, 1.0);
                    }
                });
                
                return emotions;
            }

            /**
             * í‚¤ì›Œë“œ ì¶”ì¶œ
             */
            extractKeywords(text) {
                const foundKeywords = {};
                const textLower = text.toLowerCase();
                
                Object.entries(this.keywordPatterns).forEach(([category, keywords]) => {
                    const foundInCategory = keywords.filter(keyword => textLower.includes(keyword));
                    if (foundInCategory.length > 0) {
                        foundKeywords[category] = foundInCategory;
                    }
                });
                
                return foundKeywords;
            }

            /**
             * ê°ì • ë¶„ì„ ê²°ê³¼ í‘œì‹œ
             */
            showEmotionAnalysis(keywords, analysis) {
                const analysisDiv = document.createElement('div');
                analysisDiv.className = 'emotion-analysis';
                
                let keywordHtml = '';
                if (Object.keys(keywords).length > 0) {
                    const categoryNames = {
                        depression: "ìš°ìš¸ê°",
                        anxiety: "ë¶ˆì•ˆê°",
                        stress: "ìŠ¤íŠ¸ë ˆìŠ¤",
                        anger: "ë¶„ë…¸ê°",
                        relationships: "ì¸ê°„ê´€ê³„",
                        work_school: "ì§ì¥/í•™ì—…",
                        physical: "ì‹ ì²´ì¦ìƒ"
                    };
                    
                    keywordHtml = `
                        <div class="keyword-analysis">
                            <h4>ğŸ” ê°ì§€ëœ í‚¤ì›Œë“œ</h4>
                            <div class="keyword-tags">
                                ${Object.keys(keywords).map(category => 
                                    `<span class="keyword-tag">${categoryNames[category] || category}</span>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                }

                analysisDiv.innerHTML = `
                    <h4>ğŸ’­ ê°ì • ë¶„ì„ ê²°ê³¼</h4>
                    <div class="emotion-item">
                        <span>ì „ë°˜ì  ê°ì •</span>
                        <span>${analysis.sentiment === 'positive' ? 'ê¸ì •ì ' : analysis.sentiment === 'negative' ? 'ë¶€ì •ì ' : 'ì¤‘ë¦½ì '}</span>
                    </div>
                    ${keywordHtml}
                `;
                
                this.chatContainer.appendChild(analysisDiv);
                this.scrollToBottom();
            }

            /**
             * ëŒ€í™” ë¶„ì„ ì œê³µ
             */
            provideConversationAnalysis() {
                if (this.conversationState.conversationHistory.length === 0) {
                    this.addBotMessage("ì•„ì§ ë¶„ì„í•  ëŒ€í™” ë‚´ìš©ì´ ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
                    return;
                }

                // í‚¤ì›Œë“œ ë¹ˆë„ ë¶„ì„
                const keywordFrequency = {};
                const emotionalPatterns = [];
                
                this.conversationState.conversationHistory.forEach((conv, index) => {
                    Object.keys(conv.keywords).forEach(category => {
                        keywordFrequency[category] = (keywordFrequency[category] || 0) + 1;
                    });
                    
                    // ê°ì • íŒ¨í„´ ì¶”ì 
                    if (conv.analysis && conv.analysis.sentiment) {
                        emotionalPatterns.push(conv.analysis.sentiment);
                    }
                });

                const analysisDiv = document.createElement('div');
                analysisDiv.className = 'message bot';
                
                const sortedKeywords = Object.entries(keywordFrequency)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);

                const categoryNames = {
                    depression: "ìš°ìš¸ê° ê´€ë ¨",
                    anxiety: "ë¶ˆì•ˆê° ê´€ë ¨", 
                    stress: "ìŠ¤íŠ¸ë ˆìŠ¤ ê´€ë ¨",
                    anger: "ë¶„ë…¸ê° ê´€ë ¨",
                    relationships: "ì¸ê°„ê´€ê³„ ê´€ë ¨",
                    work_school: "ì§ì¥/í•™ì—… ê´€ë ¨",
                    physical: "ì‹ ì²´ì  ì¦ìƒ ê´€ë ¨"
                };

                // ê°ì • ë³€í™” ë¶„ì„
                const recentEmotions = emotionalPatterns.slice(-5);
                const emotionalTrend = this.analyzeEmotionalTrend(recentEmotions);

                analysisDiv.innerHTML = `
                    <div class="avatar bot-avatar">ğŸ“Š</div>
                    <div class="message-bubble">
                        <div class="summary-card">
                            <div class="summary-header">
                                <h3>ğŸ“Š ì¢…í•© ëŒ€í™” ë¶„ì„</h3>
                            </div>
                            
                            <h4>ğŸ” ì£¼ìš” ê´€ì‹¬ì‚¬ (${this.conversationState.conversationHistory.length}íšŒ ëŒ€í™” ê¸°ì¤€):</h4>
                            ${sortedKeywords.length > 0 ? sortedKeywords.map(([category, count]) => 
                                `<div class="emotion-item">
                                    <span>${categoryNames[category] || category}</span>
                                    <span>${count}íšŒ ì–¸ê¸‰</span>
                                </div>`
                            ).join('') : '<p>íŠ¹ë³„í•œ íŒ¨í„´ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>'}
                            
                            <h4 style="margin-top: 15px;">ğŸ’­ ê°ì • ìƒíƒœ ë³€í™”:</h4>
                            <p>${emotionalTrend}</p>
                            
                            <h4 style="margin-top: 15px;">ğŸ¯ ì£¼ìš” ë°œê²¬ì‚¬í•­:</h4>
                            ${this.generateInsights(sortedKeywords, emotionalPatterns)}
                            
                            <div style="margin-top: 20px; padding: 15px; background: rgba(79, 172, 254, 0.1); border-radius: 10px;">
                                <p><strong>ğŸ’¡ ìƒë‹´ì‚¬ ì†Œê²¬:</strong> ì§€ì†ì ì¸ ëŒ€í™”ë¥¼ í†µí•´ ${this.conversationState.conversationHistory.length}íšŒì˜ ìƒí˜¸ì‘ìš©ì„ ë¶„ì„í•œ ê²°ê³¼, 
                                ${sortedKeywords.length > 0 ? `ì£¼ë¡œ ${categoryNames[sortedKeywords[0][0]]} ì˜ì—­ì—ì„œ ì–´ë ¤ì›€ì„ ê²ªê³  ê³„ì‹  ê²ƒìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.` : 'ë‹¤ì–‘í•œ ì£¼ì œì— ëŒ€í•´ ê· í˜•ì¡íŒ ëŒ€í™”ë¥¼ ë‚˜ëˆ„ê³  ê³„ì‹­ë‹ˆë‹¤.'}
                                </p>
                            </div>
                        </div>
                    </div>
                `;
                
                this.chatContainer.appendChild(analysisDiv);
                this.scrollToBottom();
            }

            /**
             * ê°ì • íŠ¸ë Œë“œ ë¶„ì„
             */
            analyzeEmotionalTrend(emotions) {
                if (emotions.length < 3) return "ë¶„ì„ì„ ìœ„í•œ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.";
                
                const positiveCount = emotions.filter(e => e === 'positive').length;
                const negativeCount = emotions.filter(e => e === 'negative').length;
                const neutralCount = emotions.filter(e => e === 'neutral').length;
                
                if (negativeCount > positiveCount + neutralCount) {
                    return "ìµœê·¼ ëŒ€í™”ì—ì„œ ë¶€ì •ì ì¸ ê°ì •ì´ ì§€ì†ì ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ê³  ìˆìŠµë‹ˆë‹¤.";
                } else if (positiveCount > negativeCount + neutralCount) {
                    return "ìµœê·¼ ëŒ€í™”ì—ì„œ ê¸ì •ì ì¸ ê°ì •ì´ ì¦ê°€í•˜ëŠ” ê²½í–¥ì„ ë³´ì…ë‹ˆë‹¤.";
                } else {
                    return "ê°ì • ìƒíƒœê°€ ë³€í™”í•˜ë©° ì•ˆì •ì ì¸ íŒ¨í„´ì„ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.";
                }
            }

            /**
             * ì¸ì‚¬ì´íŠ¸ ìƒì„±
             */
            generateInsights(sortedKeywords, emotionalPatterns) {
                const insights = [];
                
                if (sortedKeywords.length > 0) {
                    const topCategory = sortedKeywords[0][0];
                    const topCount = sortedKeywords[0][1];
                    
                    if (topCount >= 3) {
                        insights.push(`â€¢ ${topCategory === 'depression' ? 'ìš°ìš¸ê°' : topCategory === 'anxiety' ? 'ë¶ˆì•ˆê°' : 'ìŠ¤íŠ¸ë ˆìŠ¤'} ê´€ë ¨ ì£¼ì œê°€ ë°˜ë³µì ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ê³  ìˆì–´ ì£¼ì˜ê¹Šì€ ê´€ì°°ì´ í•„ìš”í•©ë‹ˆë‹¤.`);
                    }
                }
                
                if (emotionalPatterns.filter(e => e === 'negative').length > emotionalPatterns.length * 0.7) {
                    insights.push('â€¢ ë¶€ì •ì  ê°ì •ì´ ì§€ë°°ì ìœ¼ë¡œ ë‚˜íƒ€ë‚˜ê³  ìˆì–´ ì „ë¬¸ì  ì§€ì›ì´ ë„ì›€ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                }
                
                if (sortedKeywords.some(([cat]) => cat === 'relationships')) {
                    insights.push('â€¢ ì¸ê°„ê´€ê³„ ì˜ì—­ì—ì„œì˜ ì–´ë ¤ì›€ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
                
                if (insights.length === 0) {
                    insights.push('â€¢ ë‹¤ì–‘í•œ ì£¼ì œì— ëŒ€í•´ ê· í˜•ì¡íŒ í‘œí˜„ì„ í•˜ê³  ê³„ì‹­ë‹ˆë‹¤.');
                }
                
                return insights.join('<br>');
            }

            /**
             * ê²°ê³¼ ìš”ì•½ ë° ê¶Œì¥ì‚¬í•­ ì œê³µ
             */
            provideSummaryAndRecommendations() {
                const assessmentType = this.conversationState.currentAssessmentType;
                const scores = this.session.scores[assessmentType];
                const totalScore = scores.reduce((sum, score) => sum + score, 0);
                const interpretation = this.interpretScore(totalScore, assessmentType);
                
                const summaryDiv = document.createElement('div');
                summaryDiv.className = 'message bot';
                
                summaryDiv.innerHTML = `
                    <div class="avatar bot-avatar">ğŸ“‹</div>
                    <div class="message-bubble">
                        <div class="summary-card">
                            <div class="summary-header">
                                <h3>ğŸ“Š í‰ê°€ ê²°ê³¼ ë° ë¶„ì„</h3>
                            </div>
                            
                            <div class="score-display">
                                <div class="score-number">${totalScore}</div>
                                <div class="score-interpretation">${this.assessmentData[assessmentType].name}</div>
                                <div style="margin-top: 10px; font-weight: 600; color: #7b1fa2;">
                                    í•´ì„: ${interpretation}
                                </div>
                            </div>

                            <div class="recommendations">
                                <h4>ğŸ’¡ ê¶Œì¥ì‚¬í•­</h4>
                                ${this.generateRecommendations(totalScore, assessmentType)}
                            </div>

                            <div style="margin-top: 20px; padding: 15px; background: rgba(33, 150, 243, 0.1); border-radius: 10px;">
                                <h4 style="color: #1976d2; margin-bottom: 10px;">ğŸ“š ì „ë¬¸ ê¸°ê´€ ì—°ë½ì²˜</h4>
                                <div class="recommendation-item">
                                    <div class="recommendation-icon">ğŸ“</div>
                                    <div>
                                        <strong>ì •ì‹ ê±´ê°•ë³µì§€ì„¼í„°:</strong> 1577-0199<br>
                                        <strong>ìƒëª…ì˜ì „í™”:</strong> 1393<br>
                                        <strong>ì²­ì†Œë…„ì „í™”:</strong> 1388
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                this.chatContainer.appendChild(summaryDiv);
                this.scrollToBottom();

                // ìƒë‹´ ê³„ì† ì—¬ë¶€ í™•ì¸
                setTimeout(() => {
                    this.addBotMessage(
                        "ê²€ì‚¬ ê²°ê³¼ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¶”ê°€ ìƒë‹´ì„ ê³„ì†í•˜ì‹œê±°ë‚˜, ë‹¤ë¥¸ ê²€ì‚¬ë¥¼ ë°›ì•„ë³´ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì–´ë–»ê²Œ ë„ì™€ë“œë¦´ê¹Œìš”?",
                        ["ëŒ€í™” ìƒë‹´ì„ ê³„ì†í•˜ê² ìŠµë‹ˆë‹¤", "ë‹¤ë¥¸ ê²€ì‚¬ë„ ë°›ì•„ë³´ê³  ì‹¶ì–´ìš”", "ìƒë‹´ì„ ì¢…ë£Œí•˜ê² ìŠµë‹ˆë‹¤"]
                    );
                    this.conversationState.phase = 'conversation';
                    this.session.mode = 'conversation';
                }, 1000);
            }

            /**
             * ì ìˆ˜ í•´ì„
             */
            interpretScore(score, assessmentType) {
                switch (assessmentType) {
                    case 'phq9':
                        if (score <= 4) return "ìµœì†Œ ìˆ˜ì¤€ì˜ ìš°ìš¸ê°";
                        else if (score <= 9) return "ê²½ë¯¸í•œ ìš°ìš¸ê°";
                        else if (score <= 14) return "ì¤‘ë“±ë„ ìš°ìš¸ê°";
                        else if (score <= 19) return "ì¤‘ë“±ë„-ì‹¬í•œ ìš°ìš¸ê°";
                        else return "ì‹¬í•œ ìš°ìš¸ê°";

                    case 'gad7':
                        if (score <= 4) return "ìµœì†Œ ìˆ˜ì¤€ì˜ ë¶ˆì•ˆê°";
                        else if (score <= 9) return "ê²½ë¯¸í•œ ë¶ˆì•ˆê°";
                        else if (score <= 14) return "ì¤‘ë“±ë„ ë¶ˆì•ˆê°";
                        else return "ì‹¬í•œ ë¶ˆì•ˆê°";

                    case 'stress':
                        if (score <= 13) return "ë‚®ì€ ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€";
                        else if (score <= 26) return "ë³´í†µ ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€";
                        else return "ë†’ì€ ìŠ¤íŠ¸ë ˆìŠ¤ ìˆ˜ì¤€";

                    default:
                        return "í‰ê°€ ì™„ë£Œ";
                }
            }

            /**
             * ë§ì¶¤í˜• ê¶Œì¥ì‚¬í•­ ìƒì„±
             */
            generateRecommendations(score, assessmentType) {
                let recommendations = '';

                if (assessmentType === 'phq9' && score >= 10) {
                    recommendations = `
                        <div class="recommendation-item">
                            <div class="recommendation-icon">ğŸ¥</div>
                            <div>
                                <strong>ì¤‘ë“±ë„ ì´ìƒì˜ ìš°ìš¸ê°ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.</strong><br>
                                ì „ë¬¸ì ì¸ ìƒë‹´ì´ë‚˜ ì¹˜ë£Œë¥¼ ë°›ìœ¼ì‹œëŠ” ê²ƒì„ ê¶Œì¥ë“œë¦½ë‹ˆë‹¤.
                            </div>
                        </div>
                        <div class="recommendation-item">
                            <div class="recommendation-icon">ğŸ†˜</div>
                            <div>
                                <strong>ì‘ê¸‰ìƒí™©:</strong> ìí•´ë‚˜ ìì‚´ ìƒê°ì´ ìˆë‹¤ë©´<br>
                                ì¦‰ì‹œ 119 ë˜ëŠ” ìƒëª…ì˜ì „í™”(1393)ì— ì—°ë½í•˜ì„¸ìš”.
                            </div>
                        </div>
                    `;
                } else if (assessmentType === 'gad7' && score >= 10) {
                    recommendations = `
                        <div class="recommendation-item">
                            <div class="recommendation-icon">ğŸ˜°</div>
                            <div>
                                <strong>ì¤‘ë“±ë„ ì´ìƒì˜ ë¶ˆì•ˆê°ì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.</strong><br>
                                ì´ì™„ ê¸°ë²•, ê·œì¹™ì ì¸ ìš´ë™, ì „ë¬¸ ìƒë‹´ì„ ê³ ë ¤í•´ë³´ì„¸ìš”.
                            </div>
                        </div>
                    `;
                } else {
                    recommendations = `
                        <div class="recommendation-item">
                            <div class="recommendation-icon">ğŸŒ±</div>
                            <div><strong>ê·œì¹™ì ì¸ ìƒí™œ ë¦¬ë“¬ ìœ ì§€</strong></div>
                        </div>
                        <div class="recommendation-item">
                            <div class="recommendation-icon">ğŸƒ</div>
                            <div><strong>ì ì ˆí•œ ìš´ë™ê³¼ íœ´ì‹</strong></div>
                        </div>
                        <div class="recommendation-item">
                            <div class="recommendation-icon">ğŸ‘¥</div>
                            <div><strong>ì‚¬íšŒì  ì§€ì§€ì²´ê³„ í™œìš©</strong></div>
                        </div>
                        <div class="recommendation-item">
                            <div class="recommendation-icon">ğŸ’¬</div>
                            <div><strong>í•„ìš”ì‹œ ì „ë¬¸ê°€ ìƒë‹´</strong></div>
                        </div>
                    `;
                }

                return recommendations;
            }

            /**
             * ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ í™”ë©´ì— ì¶”ê°€
             */
            addUserMessage(message) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message user';
                messageDiv.innerHTML = `
                    <div class="avatar user-avatar">ğŸ‘¤</div>
                    <div class="message-bubble">${this.escapeHtml(message)}</div>
                `;
                this.chatContainer.appendChild(messageDiv);
                this.scrollToBottom();
            }

            /**
             * ë´‡ ë©”ì‹œì§€ë¥¼ í™”ë©´ì— ì¶”ê°€
             */
            addBotMessage(message, quickResponses = []) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message bot';
                
                let quickResponsesHtml = '';
                if (quickResponses.length > 0) {
                    quickResponsesHtml = `
                        <div class="quick-responses">
                            ${quickResponses.map(response => 
                                `<div class="quick-response" onclick="chatbot.selectQuickResponse('${response}')">${response}</div>`
                            ).join('')}
                        </div>
                    `;
                }

                messageDiv.innerHTML = `
                    <div class="avatar bot-avatar">ğŸ¤–</div>
                    <div class="message-bubble">
                        ${this.escapeHtml(message).replace(/\n/g, '<br>')}
                        ${quickResponsesHtml}
                    </div>
                `;
                this.chatContainer.appendChild(messageDiv);
                this.scrollToBottom();
            }

            /**
             * ì‹œìŠ¤í…œ ë©”ì‹œì§€ ì¶”ê°€
             */
            addSystemMessage(message) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message system';
                messageDiv.innerHTML = `
                    <div class="avatar system-avatar">ğŸ“¢</div>
                    <div class="message-bubble">${this.escapeHtml(message)}</div>
                `;
                this.chatContainer.appendChild(messageDiv);
                this.scrollToBottom();
            }

            /**
             * ë¹ ë¥¸ ì‘ë‹µ ì„ íƒ ì²˜ë¦¬
             */
            selectQuickResponse(response) {
                this.messageInput.value = response;
                this.sendMessage();
            }

            /**
             * íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° í‘œì‹œ
             */
            showTypingIndicator() {
                this.isTyping = true;
                const typingDiv = document.createElement('div');
                typingDiv.className = 'message bot typing-message';
                typingDiv.innerHTML = `
                    <div class="avatar bot-avatar">ğŸ¤–</div>
                    <div class="message-bubble">
                        <div class="typing-indicator">
                            <span>AI ìƒë‹´ì‚¬ê°€ ë¶„ì„ ì¤‘</span>
                            <div class="typing-dots">
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                            </div>
                        </div>
                    </div>
                `;
                this.chatContainer.appendChild(typingDiv);
                this.scrollToBottom();
            }

            /**
             * íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„° ì œê±°
             */
            removeTypingIndicator() {
                this.isTyping = false;
                const typingMessage = this.chatContainer.querySelector('.typing-message');
                if (typingMessage) {
                    typingMessage.remove();
                }
            }

            /**
             * ìƒë‹´ ì¢…ë£Œ ì²˜ë¦¬
             */
            endConversation() {
                this.addSystemMessage("ìƒë‹´ì„ ì¢…ë£Œí•©ë‹ˆë‹¤.");
                this.addBotMessage(
                    "ğŸ™ ìƒë‹´ì— ì°¸ì—¬í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.\n" +
                    "ğŸ”’ ëª¨ë“  ëŒ€í™” ê¸°ë¡ì´ ì•ˆì „í•˜ê²Œ ì‚­ì œë©ë‹ˆë‹¤.\n" +
                    "ğŸ’š ì–¸ì œë“  ë‹¤ì‹œ ë„ì›€ì´ í•„ìš”í•˜ì‹œë©´ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì„œ ìƒˆë¡œìš´ ìƒë‹´ì„ ì‹œì‘í•˜ì„¸ìš”."
                );
                
                this.messageInput.disabled = true;
                this.sendButton.disabled = true;
                
                setTimeout(() => {
                    this.session = null;
                    console.log('ì„¸ì…˜ ë°ì´í„°ê°€ ì•ˆì „í•˜ê²Œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                }, 2000);
            }

            /**
             * ì±„íŒ… ì»¨í…Œì´ë„ˆë¥¼ ë§¨ ì•„ë˜ë¡œ ìŠ¤í¬ë¡¤
             */
            scrollToBottom() {
                this.chatContainer.scrollTop = this.chatContainer.scrollHeight;
            }

            /**
             * HTML ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬ (XSS ë°©ì§€)
             */
            escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            /**
             * ë¹„ë™ê¸° ì§€ì—° í•¨ìˆ˜
             */
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        /**
         * ì „ì—­ ë³€ìˆ˜ ë° ì´ˆê¸°í™”
         */
        let chatbot;
        document.addEventListener('DOMContentLoaded', () => {
            chatbot = new EnhancedAICounselingChatbot();
        });
    </script>
</body>
</html>
